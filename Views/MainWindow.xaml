<Window x:Class="SalesforceDebugAnalyzer.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:helpers="clr-namespace:SalesforceDebugAnalyzer.Helpers"
        xmlns:viewmodels="clr-namespace:SalesforceDebugAnalyzer.ViewModels"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="Salesforce Debug Log Analyzer" 
        Height="900" 
        Width="1600"
        MinHeight="700"
        MinWidth="1200"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="CanResize"
        Background="{StaticResource BgPrimary}"
        TextElement.Foreground="{StaticResource TextPrimary}"
        FontFamily="Segoe UI, Arial"
        TextElement.FontSize="{StaticResource FontBaseline}">
    
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="48"
                      ResizeBorderThickness="5"
                      GlassFrameThickness="0"
                      CornerRadius="8"
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>
    
    <Window.Resources>
        <helpers:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <helpers:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <helpers:IntEqualsToVisibilityConverter x:Key="IntEqualsToVisibilityConverter"/>
        <helpers:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <helpers:DoubleGreaterThanConverter x:Key="DoubleGreaterThanConverter"/>
        <helpers:PercentToWidthConverter x:Key="PercentToWidthConverter"/>
        <helpers:PercentToSeverityConverter x:Key="PercentToSeverityConverter"/>
        <helpers:GreaterThanZeroConverter x:Key="GreaterThanZeroConverter"/>
        <helpers:GreaterThanZeroToVisibilityConverter x:Key="GreaterThanZeroToVisibilityConverter"/>
        <helpers:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <helpers:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <helpers:InverseNullToVisibilityConverter x:Key="InverseNullToVisibilityConverter"/>
        <helpers:ZeroToVisibilityConverter x:Key="ZeroToVisibilityConverter"/>
        <helpers:ArcPathConverter x:Key="ArcPathConverter"/>
        <helpers:HealthScoreToColorConverter x:Key="HealthScoreToColorConverter"/>
        
        <!-- Card Style — uses theme tokens so all cards inherit the palette automatically -->
        <Style x:Key="DiscordCard" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BgSecondary}"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderDefault}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <!-- Primary Button -->
        <Style x:Key="DiscordPrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentPrimary}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentHover}"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentActive}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Secondary Button -->
        <Style x:Key="DiscordSecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource BgInput}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource BgHover}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Pill CTA Button for links (e.g., open in VSCode) -->
        <Style x:Key="PillLinkButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Info}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="12" Padding="{TemplateBinding Padding}">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <ContentPresenter Margin="0,0,6,0"/>
                            </StackPanel>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentHover}"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentActive}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Discord CheckBox Style -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <Grid Background="Transparent">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Border x:Name="CheckBox" Width="18" Height="18" 
                                    Background="{StaticResource BgInput}" BorderBrush="{StaticResource BorderFocus}" 
                                    BorderThickness="2" CornerRadius="3" Margin="0,0,8,0">
                                <Path x:Name="CheckMark" 
                                      Data="M 2,5 L 7,10 L 14,2" 
                                      Stroke="{StaticResource AccentPrimary}" StrokeThickness="2"
                                      Visibility="Collapsed"/>
                            </Border>
                            <ContentPresenter Grid.Column="1" VerticalAlignment="Center"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="CheckBox" Property="Background" Value="{StaticResource AccentPrimary}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="CheckBox" Property="BorderBrush" Value="{StaticResource AccentHover}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid Background="{StaticResource BgPrimary}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="88"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="48"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Custom Title Bar (48px) -->
        <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" 
                BorderBrush="{StaticResource SidebarBorder}" BorderThickness="0,0,0,1">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#08080F" Offset="0"/>
                    <GradientStop Color="#13131E" Offset="0.5"/>
                    <GradientStop Color="#13131E" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="88"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- App Icon Area -->
                <Border Grid.Column="0" Background="{StaticResource SidebarBg}">
                    <materialDesign:PackIcon Kind="Spider" Width="26" Height="26" 
                                             VerticalAlignment="Center" HorizontalAlignment="Center"
                                             Foreground="{StaticResource Danger}">
                        <materialDesign:PackIcon.Effect>
                            <DropShadowEffect BlurRadius="12" Color="#F85149" Opacity="0.9" ShadowDepth="0"/>
                        </materialDesign:PackIcon.Effect>
                    </materialDesign:PackIcon>
                </Border>
                
                <!-- App Title -->
                <TextBlock Grid.Column="1" Text="Black Widow" 
                           FontSize="15" FontWeight="Bold" 
                           VerticalAlignment="Center"
                           Margin="16,0,0,0">
                    <TextBlock.Foreground>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#FFFFFF" Offset="0"/>
                            <GradientStop Color="#B8A8FF" Offset="1"/>
                        </LinearGradientBrush>
                    </TextBlock.Foreground>
                </TextBlock>
                
                <!-- VSCode Connection Status (next to title) -->
                <Border Grid.Column="1" HorizontalAlignment="Left" VerticalAlignment="Center"
                        Margin="120,0,0,0"
                        Background="{StaticResource BgHover}" CornerRadius="10" Padding="10,4"
                        ToolTip="VSCode Bridge: Click to install extension if not connected">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="6" Height="6" Margin="0,0,6,0">
                            <Ellipse.Style>
                                <Style TargetType="Ellipse">
                                    <Setter Property="Fill" Value="{StaticResource TextMuted}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsEditorConnected}" Value="True">
                                            <Setter Property="Fill" Value="{StaticResource Success}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>
                        <TextBlock FontSize="11" Foreground="{StaticResource TextSecondary}">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="VSCode"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsEditorConnected}" Value="True">
                                            <Setter Property="Text" Value="VSCode ?"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </Border>
                
                <!-- Streaming Status Badge (Center) -->
                <Border Grid.Column="2" HorizontalAlignment="Center" VerticalAlignment="Center"
                        Background="{StaticResource Danger}" CornerRadius="12" Padding="12,6"
                        Visibility="{Binding IsStreaming, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Fill="White" Margin="0,0,8,0">
                            <Ellipse.Style>
                                <Style TargetType="Ellipse">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                            <DataTrigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                         From="1" To="0.3" Duration="0:0:0.5"
                                                                         AutoReverse="True"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.EnterActions>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>
                        <TextBlock Text="{Binding StreamingStatus}" 
                                   Foreground="White" FontSize="12" FontWeight="SemiBold"/>
                    </StackPanel>
                </Border>
                
                <!-- Window Controls (Right) -->
                <StackPanel Grid.Column="3" Orientation="Horizontal" 
                            WindowChrome.IsHitTestVisibleInChrome="True">
                    <Button Click="MinimizeButton_Click" 
                            Width="48" Height="48"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                            Background="Transparent" BorderThickness="0">
                        <materialDesign:PackIcon Kind="WindowMinimize" 
                                                 Foreground="{StaticResource TextSecondary}" Width="16" Height="16"/>
                    </Button>
                    <Button Click="MaximizeButton_Click" 
                            Width="48" Height="48"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                            Background="Transparent" BorderThickness="0">
                        <materialDesign:PackIcon Kind="WindowMaximize" 
                                                 Foreground="{StaticResource TextSecondary}" Width="16" Height="16"/>
                    </Button>
                    <Button Click="CloseButton_Click" 
                            Width="48" Height="48"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                            Background="Transparent" BorderThickness="0">
                        <materialDesign:PackIcon Kind="Close" 
                                                 Foreground="{StaticResource TextSecondary}" Width="16" Height="16"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Left Sidebar (88px) -->
        <Border Grid.Row="1" Grid.Column="0" 
                Background="{StaticResource SidebarBg}" 
                BorderBrush="{StaticResource BorderSubtle}" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Navigation Buttons (Top) -->
                <StackPanel Grid.Row="0" Margin="0,8,0,0">
                    <!-- Home -->
                    <Button Width="84" Height="68"
                            Background="{StaticResource AccentPrimary}"
                            BorderThickness="0"
                            Margin="2,6,2,0"
                            Cursor="Hand"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="12"/>
                            </Style>
                        </Button.Resources>
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <materialDesign:PackIcon Kind="Home"
                                                     Foreground="White" Width="20" Height="20"
                                                     HorizontalAlignment="Center"/>
                            <TextBlock Text="Home" FontSize="9" FontWeight="SemiBold"
                                       Foreground="White" HorizontalAlignment="Center"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Manage Logs -->
                    <Button Width="84" Height="68"
                            Background="Transparent"
                            BorderThickness="0"
                            Margin="2,4,2,0"
                            Cursor="Hand"
                            Command="{Binding ManageDebugLogsCommand}"
                            ToolTip="Manage Trace Flags &amp; Debug Logs"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="12"/>
                            </Style>
                        </Button.Resources>
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <materialDesign:PackIcon Kind="FileDocument"
                                                     Foreground="{StaticResource TextSecondary}" Width="20" Height="20"
                                                     HorizontalAlignment="Center"/>
                            <TextBlock Text="Manage" FontSize="9" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Upload -->
                    <Button Width="84" Height="68"
                            Background="Transparent"
                            BorderThickness="0"
                            Margin="2,4,2,0"
                            Cursor="Hand"
                            Command="{Binding UploadLogCommand}"
                            ToolTip="Upload a .log file from disk"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="12"/>
                            </Style>
                        </Button.Resources>
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <materialDesign:PackIcon Kind="Upload"
                                                     Foreground="{StaticResource TextSecondary}" Width="20" Height="20"
                                                     HorizontalAlignment="Center"/>
                            <TextBlock Text="Upload" FontSize="9" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Stream Logs (Live) -->
                    <Button Width="84" Height="68"
                            BorderThickness="0"
                            Margin="2,4,2,0"
                            Cursor="Hand"
                            Command="{Binding ToggleStreamingCommand}"
                            ToolTip="Stream live logs from your connected Salesforce org">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="12"/>
                            </Style>
                        </Button.Resources>
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                                <Setter Property="Background" Value="Transparent"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                        <Setter Property="Background" Value="#9A1A1A"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <Grid>
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Grid HorizontalAlignment="Center">
                                    <materialDesign:PackIcon Kind="AccessPoint"
                                                             Width="20" Height="20"
                                                             HorizontalAlignment="Center">
                                        <materialDesign:PackIcon.Style>
                                            <Style TargetType="materialDesign:PackIcon">
                                                <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </materialDesign:PackIcon.Style>
                                    </materialDesign:PackIcon>
                                    <!-- Pulsing dot when streaming -->
                                    <Ellipse Width="7" Height="7" Fill="{StaticResource Danger}"
                                             HorizontalAlignment="Right" VerticalAlignment="Top"
                                             Margin="0,-2,-2,0"
                                             Visibility="{Binding IsStreaming, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                                        <DataTrigger.EnterActions>
                                                            <BeginStoryboard>
                                                                <Storyboard RepeatBehavior="Forever">
                                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                     From="1" To="0.3" Duration="0:0:0.5"
                                                                                     AutoReverse="True"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </DataTrigger.EnterActions>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                </Grid>
                                <TextBlock FontSize="9" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,4,0,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Live"/>
                                            <Setter Property="Foreground" Value="{StaticResource TextMuted}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                                    <Setter Property="Text" Value="● Live"/>
                                                    <Setter Property="Foreground" Value="White"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Grid>
                    </Button>
                </StackPanel>
                
                <!-- Bottom Actions -->
                <StackPanel Grid.Row="1" Margin="0,0,0,8">
                    <!-- Export Report -->
                    <Button Width="84" Height="68"
                            Background="Transparent"
                            BorderThickness="0"
                            Margin="2,4,2,0"
                            Cursor="Hand"
                            Command="{Binding ExportReportCommand}"
                            ToolTip="Export analysis report (PDF or JSON)"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="12"/>
                            </Style>
                        </Button.Resources>
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <materialDesign:PackIcon Kind="FileExport"
                                                     Foreground="{StaticResource TextSecondary}" Width="20" Height="20"
                                                     HorizontalAlignment="Center"/>
                            <TextBlock Text="Export" FontSize="9" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Settings -->
                    <Button Width="84" Height="68"
                            Background="Transparent"
                            BorderThickness="0"
                            Margin="2,4,2,0"
                            Cursor="Hand"
                            Command="{Binding OpenSettingsCommand}"
                            ToolTip="Settings — connections, preferences, license"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="12"/>
                            </Style>
                        </Button.Resources>
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <materialDesign:PackIcon Kind="Cog"
                                                     Foreground="{StaticResource TextSecondary}" Width="20" Height="20"
                                                     HorizontalAlignment="Center"/>
                            <TextBlock Text="Settings" FontSize="9" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Disconnect -->
                    <Button Width="84" Height="68"
                            Background="Transparent"
                            BorderThickness="0"
                            Margin="2,4,2,8"
                            Cursor="Hand"
                            Command="{Binding DisconnectCommand}"
                            ToolTip="Disconnect from Salesforce"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="12"/>
                            </Style>
                        </Button.Resources>
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <materialDesign:PackIcon Kind="Power"
                                                     Foreground="{StaticResource Danger}" Width="20" Height="20"
                                                     HorizontalAlignment="Center"/>
                            <TextBlock Text="Sign Out" FontSize="9" FontWeight="SemiBold"
                                       Foreground="{StaticResource Danger}" HorizontalAlignment="Center"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" Grid.Column="1" Background="Transparent" AllowDrop="True">
            <!-- Welcome/Connection View -->
            <ContentControl x:Name="ConnectionsViewContainer" Visibility="Visible"/>
            
            <!-- Main Dashboard View (when connected) -->
            <Grid x:Name="MainContentGrid" Visibility="Collapsed" Background="Transparent" AllowDrop="True">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="360" MinWidth="300" MaxWidth="450"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel - Logs & Filters -->
                <Border Grid.Column="0" CornerRadius="10" BorderBrush="{StaticResource BorderDefault}" BorderThickness="1">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                            <GradientStop Color="#13131E" Offset="0"/>
                            <GradientStop Color="#0D0D16" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>  <!-- 0: Header -->
                            <RowDefinition Height="Auto"/>  <!-- 1: Quick Actions (collapsed) -->
                            <RowDefinition Height="Auto"/>  <!-- 2: Search -->
                            <RowDefinition Height="Auto"/>  <!-- 3: Filters -->
                            <RowDefinition Height="*"/>     <!-- 4: Log List -->
                            <RowDefinition Height="Auto"/>  <!-- 5: Live Streaming -->
                        </Grid.RowDefinitions>

                        <!-- Header with action buttons -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Debug Logs" FontSize="18" FontWeight="Bold" 
                                           VerticalAlignment="Center">
                                    <TextBlock.Foreground>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                            <GradientStop Color="#FFFFFF" Offset="0"/>
                                            <GradientStop Color="#B8A8FF" Offset="1"/>
                                        </LinearGradientBrush>
                                    </TextBlock.Foreground>
                                </TextBlock>
                                <!-- Transaction grouping toggle -->
                                <Border CornerRadius="4" Padding="6,2" Margin="12,0,0,0" VerticalAlignment="Center"
                                        Background="{StaticResource AccentSubtle}"
                                        Visibility="{Binding LogGroups.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}"
                                        ToolTip="Transaction grouping enabled — logs from the same user action are grouped together">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="📦" FontSize="11" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                        <TextBlock FontSize="10" FontWeight="Bold" Foreground="{StaticResource AccentPrimary}" VerticalAlignment="Center">
                                            <Run Text="{Binding LogGroups.Count, Mode=OneWay}"/><Run Text=" groups"/>
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <!-- Group/Ungroup toggle -->
                                <ToggleButton IsChecked="{Binding ShowGroupedView}" Width="32" Height="32" Margin="0,0,8,0"
                                              Background="{StaticResource BgHover}" BorderThickness="0"
                                              Visibility="{Binding LogGroups.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                    <ToggleButton.Style>
                                        <Style TargetType="ToggleButton">
                                            <Setter Property="ToolTip" Value="Show grouped transactions"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsChecked" Value="True">
                                                    <Setter Property="ToolTip" Value="Show individual logs"/>
                                                    <Setter Property="Background" Value="{StaticResource AccentPrimary}"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ToggleButton.Style>
                                    <materialDesign:PackIcon Width="16" Height="16" Foreground="White">
                                        <materialDesign:PackIcon.Style>
                                            <Style TargetType="materialDesign:PackIcon">
                                                <Setter Property="Kind" Value="ViewList"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding ShowGroupedView}" Value="True">
                                                        <Setter Property="Kind" Value="ViewModule"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </materialDesign:PackIcon.Style>
                                    </materialDesign:PackIcon>
                                </ToggleButton>
                                <Button ToolTip="Open single log file" 
                                        Command="{Binding UploadLogCommand}"
                                        Width="32" Height="32" Padding="0" Margin="0,0,4,0"
                                        Background="{StaticResource BgHover}" BorderThickness="0">
                                    <materialDesign:PackIcon Kind="FileDocument" Width="16" Height="16" Foreground="White"/>
                                </Button>
                                <Button ToolTip="Load from folder" 
                                        Command="{Binding LoadLogFolderCommand}"
                                        Width="32" Height="32" Padding="0" Margin="0,0,4,0"
                                        Background="{StaticResource BgHover}" BorderThickness="0">
                                    <materialDesign:PackIcon Kind="FolderOpen" Width="16" Height="16" Foreground="White"/>
                                </Button>
                                <Button ToolTip="Download from org" 
                                        Command="{Binding LoadRecentLogsCommand}"
                                        Width="32" Height="32" Padding="0"
                                        Background="{StaticResource BgHover}" BorderThickness="0">
                                    <materialDesign:PackIcon Kind="CloudDownload" Width="16" Height="16" Foreground="White"/>
                                </Button>
                            </StackPanel>
                        </Grid>
                        
                        <!-- Quick Actions Bar (collapsed — sidebar buttons cover these actions) -->
                        <Border Grid.Row="1" Visibility="Collapsed" Background="{StaticResource BgInput}" CornerRadius="6" Padding="8" Margin="0,0,0,0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Button Command="{Binding UploadLogCommand}"
                                        Background="Transparent" Foreground="{StaticResource TextSecondary}" BorderThickness="0"
                                        HorizontalAlignment="Stretch" Padding="8,6" FontSize="12">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="FileUpload" Width="14" Height="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                        <TextBlock Text="Upload File" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button Grid.Column="1" Command="{Binding ToggleStreamingCommand}"
                                        Background="Transparent" BorderThickness="0"
                                        HorizontalAlignment="Stretch" Padding="8,6" FontSize="12">
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <materialDesign:PackIcon Kind="Broadcast" Width="14" Height="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                        <TextBlock Text="Stream Live" VerticalAlignment="Center"/>
                                    </StackPanel>
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                                    <Setter Property="Foreground" Value="{StaticResource Danger}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </Grid>
                        </Border>
                        
                        <!-- Search Box -->
                        <Border Background="{StaticResource BgInput}" CornerRadius="6" Grid.Row="2" Margin="0,0,0,12">
                            <Grid>
                                <TextBox x:Name="SearchBox" Background="Transparent" BorderThickness="0" 
                                         Foreground="{StaticResource TextPrimary}" Padding="10,8"
                                         FontSize="13"
                                         TextChanged="SearchBox_TextChanged"/>
                                <TextBlock Text="🔍 Search logs..." 
                                           Foreground="{StaticResource TextMuted}" Padding="10,8" FontSize="13"
                                           IsHitTestVisible="False">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Text, ElementName=SearchBox}" Value="">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Grid>
                        </Border>
                        
                        <!-- Log List - Virtualized ListBox for performance -->
                        <ListBox Grid.Row="4" ItemsSource="{Binding Logs}" 
                                 SelectedItem="{Binding SelectedLog}"
                                 Background="Transparent" BorderThickness="0" Margin="0,0,0,8"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 HorizontalContentAlignment="Stretch"
                                 Visibility="{Binding ShowGroupedView, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="0"/>
                                    <Setter Property="Margin" Value="0"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <Border x:Name="ItemBorder" CornerRadius="8" 
                                                        Margin="0,0,0,6" Cursor="Hand"
                                                        Background="{StaticResource BgSecondary}"
                                                        BorderBrush="{StaticResource BorderSubtle}" BorderThickness="1"
                                                        ClipToBounds="True">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="3"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <!-- Left accent bar — dims at rest, blazes on selection -->
                                                        <Border x:Name="AccentBar" CornerRadius="7,0,0,7"
                                                                Background="{StaticResource AccentPrimary}" Opacity="0.2"/>
                                                        <!-- Main content -->
                                                        <Grid Grid.Column="1" Margin="10,10,12,10">
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                                <RowDefinition Height="Auto"/>
                                                            </Grid.RowDefinitions>
                                                            <!-- Row 0: icon + name + truncated badge -->
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                            <TextBlock Grid.Column="0" Text="{Binding OperationIcon}" FontSize="16"
                                                                       VerticalAlignment="Center" Margin="0,0,6,0"/>
                                                            <TextBlock Grid.Column="1" Text="{Binding LogName}" FontSize="13"
                                                                       FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}"
                                                                       TextTrimming="CharacterEllipsis" VerticalAlignment="Center"
                                                                       ToolTip="{Binding LogName}"/>
                                                            <!-- Truncated log warning icon -->
                                                            <Border Grid.Column="2" CornerRadius="3" Padding="4,1" Margin="4,0,0,0"
                                                                    Background="{StaticResource WarningSubtle}" VerticalAlignment="Center"
                                                                    Visibility="{Binding IsLogTruncated, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                                    ToolTip="Log was truncated by Salesforce — data may be incomplete">
                                                                <TextBlock Text="⚠️" FontSize="9"/>
                                                            </Border>
                                                        </Grid>
                                                        <!-- Row 1: duration + lines + operation type -->
                                                        <TextBlock Grid.Row="1" FontSize="11"
                                                                   Foreground="{StaticResource TextMuted}" Margin="0,4,0,0">
                                                            <Run Text="{Binding DurationMs, StringFormat={}{0:N0}ms}"/>
                                                            <Run Text=" • "/>
                                                            <Run Text="{Binding LineCount}"/>
                                                            <Run Text=" lines • "/>
                                                            <Run Text="{Binding OperationType, Mode=OneWay}"/>
                                                        </TextBlock>
                                                        <!-- Row 2: status badge + ASYNC badge + BulkSafetyGrade pill -->
                                                        <WrapPanel Grid.Row="2" Orientation="Horizontal" Margin="0,6,0,0">
                                                            <!-- SUCCESS / ERROR badge -->
                                                            <Border CornerRadius="3" Padding="6,2" Margin="0,0,4,0">
                                                                <Border.Style>
                                                                    <Style TargetType="Border">
                                                                        <Setter Property="Background" Value="{StaticResource Success}"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                                <Setter Property="Background" Value="{StaticResource Danger}"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Border.Style>
                                                                <TextBlock FontSize="9" FontWeight="Bold" Foreground="White">
                                                                    <TextBlock.Style>
                                                                        <Style TargetType="TextBlock">
                                                                            <Setter Property="Text" Value="SUCCESS"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                                    <Setter Property="Text" Value="ERROR"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </TextBlock.Style>
                                                                </TextBlock>
                                                            </Border>
                                                            <!-- ASYNC badge -->
                                                            <Border CornerRadius="3" Padding="6,2" Margin="0,0,4,0"
                                                                    Background="{StaticResource InfoSubtle}"
                                                                    Visibility="{Binding IsAsyncExecution, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                <TextBlock Text="ASYNC" FontSize="9" FontWeight="Bold" Foreground="{StaticResource Info}"/>
                                                            </Border>
                                                            <!-- Bulk Safety Grade pill -->
                                                            <Border CornerRadius="3" Padding="6,2"
                                                                    Visibility="{Binding BulkSafetyGrade, Converter={StaticResource StringToVisibilityConverter}}">
                                                                <Border.Style>
                                                                    <Style TargetType="Border">
                                                                        <Setter Property="Background" Value="{StaticResource SuccessSubtle}"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="C">
                                                                                <Setter Property="Background" Value="{StaticResource WarningSubtle}"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="D">
                                                                                <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="F">
                                                                                <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Border.Style>
                                                                <TextBlock FontSize="9" FontWeight="Bold">
                                                                    <Run Text="Bulk "/>
                                                                    <Run Text="{Binding BulkSafetyGrade}"/>
                                                                    <TextBlock.Style>
                                                                        <Style TargetType="TextBlock">
                                                                            <Setter Property="Foreground" Value="{StaticResource Success}"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="C">
                                                                                    <Setter Property="Foreground" Value="{StaticResource Warning}"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="D">
                                                                                    <Setter Property="Foreground" Value="{StaticResource Danger}"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="F">
                                                                                    <Setter Property="Foreground" Value="{StaticResource Danger}"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </TextBlock.Style>
                                                                </TextBlock>
                                                            </Border>
                                                        </WrapPanel>
                                                    </Grid>
                                                </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter TargetName="ItemBorder" Property="Background" Value="#14103A"/>
                                                        <Setter TargetName="ItemBorder" Property="BorderBrush" Value="{StaticResource AccentPrimary}"/>
                                                        <Setter TargetName="AccentBar" Property="Opacity" Value="1"/>
                                                        <Setter TargetName="ItemBorder" Property="Effect">
                                                            <Setter.Value>
                                                                <DropShadowEffect BlurRadius="14" Color="#7C6AFF" Opacity="0.45" ShadowDepth="0"/>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Trigger>
                                                    <MultiTrigger>
                                                        <MultiTrigger.Conditions>
                                                            <Condition Property="IsMouseOver" Value="True"/>
                                                            <Condition Property="IsSelected" Value="False"/>
                                                        </MultiTrigger.Conditions>
                                                        <Setter TargetName="ItemBorder" Property="Background" Value="{StaticResource BgHover}"/>
                                                        <Setter TargetName="AccentBar" Property="Opacity" Value="0.6"/>
                                                    </MultiTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>
                        
                        <!-- Transaction Group List (shown when ShowGroupedView = true) -->
                        <ListBox Grid.Row="4" ItemsSource="{Binding LogGroups}" 
                                 SelectedItem="{Binding SelectedLogGroup}"
                                 Background="Transparent" BorderThickness="0" Margin="0,0,0,8"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 HorizontalContentAlignment="Stretch"
                                 Visibility="{Binding ShowGroupedView, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="0"/>
                                    <Setter Property="Margin" Value="0"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <Border x:Name="GroupBorder" CornerRadius="6" 
                                                        Padding="12" Margin="0,0,0,8" Cursor="Hand"
                                                        Background="{StaticResource BgInput}"
                                                        BorderBrush="{StaticResource BorderDefault}" BorderThickness="1">
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>
                                                        
                                                        <!-- Row 0: Header with user + log count -->
                                                        <Grid Grid.Row="0">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBlock Grid.Column="0" Text="📦" FontSize="16" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                                <TextBlock FontSize="13" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}"
                                                                           TextTrimming="CharacterEllipsis">
                                                                    <Run Text="{Binding UserName, Mode=OneWay}"/>
                                                                    <Run Text=" transaction" Foreground="{StaticResource TextMuted}"/>
                                                                </TextBlock>
                                                                <TextBlock FontSize="10" Foreground="{StaticResource TextMuted}" Margin="0,2,0,0">
                                                                    <Run Text="{Binding Logs.Count, Mode=OneWay}"/><Run Text=" logs • "/><Run Text="{Binding TotalDuration, StringFormat={}{0:N0}ms, Mode=OneWay}"/><Run Text=" total"/>
                                                                </TextBlock>
                                                            </StackPanel>
                                                            <Border Grid.Column="2" CornerRadius="3" Padding="6,2" Background="{StaticResource AccentSubtle}" VerticalAlignment="Center"
                                                                    Visibility="{Binding IsSingleLog, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                                                <TextBlock Text="GROUPED" FontSize="9" FontWeight="Bold" Foreground="{StaticResource AccentPrimary}"/>
                                                            </Border>
                                                        </Grid>
                                                        
                                                        <!-- Row 1: Phase breakdown (when phases detected) -->
                                                        <StackPanel Grid.Row="1" Margin="22,6,0,0"
                                                                    Visibility="{Binding Phases.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                            <ItemsControl ItemsSource="{Binding Phases}">
                                                                <ItemsControl.ItemTemplate>
                                                                    <DataTemplate>
                                                                        <Grid Margin="0,2">
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="Auto"/>
                                                                                <ColumnDefinition Width="*"/>
                                                                                <ColumnDefinition Width="Auto"/>
                                                                            </Grid.ColumnDefinitions>
                                                                            <Border Grid.Column="0" Width="4" Height="4" CornerRadius="2" Margin="0,0,6,0" VerticalAlignment="Center">
                                                                                <Border.Style>
                                                                                    <Style TargetType="Border">
                                                                                        <Setter Property="Background" Value="{StaticResource Info}"/>
                                                                                        <Style.Triggers>
                                                                                            <DataTrigger Binding="{Binding Type}" Value="Frontend">
                                                                                                <Setter Property="Background" Value="{StaticResource Success}"/>
                                                                                            </DataTrigger>
                                                                                        </Style.Triggers>
                                                                                    </Style>
                                                                                </Border.Style>
                                                                            </Border>
                                                                            <TextBlock Grid.Column="1" FontSize="10" Foreground="{StaticResource TextSecondary}">
                                                                                <Run Text="{Binding Name, Mode=OneWay}"/><Run Text=":"/>
                                                                            </TextBlock>
                                                                            <TextBlock Grid.Column="2" FontSize="10" Foreground="{StaticResource TextMuted}">
                                                                                <Run Text="{Binding DurationMs, StringFormat={}{0:N0}ms, Mode=OneWay}"/>
                                                                            </TextBlock>
                                                                        </Grid>
                                                                    </DataTemplate>
                                                                </ItemsControl.ItemTemplate>
                                                            </ItemsControl>
                                                        </StackPanel>
                                                        
                                                        <!-- Row 2: Recommendations count (when available) -->
                                                        <Border Grid.Row="2" CornerRadius="3" Padding="6,3" Margin="22,6,0,0" HorizontalAlignment="Left"
                                                                Background="{StaticResource WarningSubtle}"
                                                                Visibility="{Binding Recommendations.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="💡" FontSize="10" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                                                <TextBlock FontSize="9" FontWeight="Bold" Foreground="{StaticResource Warning}" VerticalAlignment="Center">
                                                                    <Run Text="{Binding Recommendations.Count, Mode=OneWay}"/><Run Text=" recommendation"/>
                                                                </TextBlock>
                                                            </StackPanel>
                                                        </Border>
                                                        
                                                        <!-- Row 3: Mixed context warning -->
                                                        <Border Grid.Row="3" CornerRadius="3" Padding="6,3" Margin="22,6,0,0" HorizontalAlignment="Left"
                                                                Background="{StaticResource DangerSubtle}"
                                                                Visibility="{Binding HasMixedContexts, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="⚠️" FontSize="10" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                                                <TextBlock Text="MIXED CONTEXTS" FontSize="9" FontWeight="Bold" Foreground="{StaticResource Danger}" VerticalAlignment="Center"/>
                                                            </StackPanel>
                                                        </Border>
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter TargetName="GroupBorder" Property="Background" Value="{StaticResource AccentPrimary}"/>
                                                        <Setter TargetName="GroupBorder" Property="BorderBrush" Value="{StaticResource AccentPrimary}"/>
                                                    </Trigger>
                                                    <MultiTrigger>
                                                        <MultiTrigger.Conditions>
                                                            <Condition Property="IsMouseOver" Value="True"/>
                                                            <Condition Property="IsSelected" Value="False"/>
                                                        </MultiTrigger.Conditions>
                                                        <Setter TargetName="GroupBorder" Property="Background" Value="{StaticResource BgHover}"/>
                                                    </MultiTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>
                        
                        <!-- Empty state when no logs loaded -->
                        <Border Grid.Row="4" Background="{StaticResource BgInput}" CornerRadius="8" Padding="20" Margin="0,0,0,8"
                                Visibility="{Binding Logs.Count, Converter={StaticResource ZeroToVisibilityConverter}}">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="📁" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBlock Text="No logs yet" FontSize="14" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextSecondary}" HorizontalAlignment="Center"/>
                                <TextBlock Text="Upload a .log file, load a folder, or stream live from your org" 
                                           FontSize="11" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" 
                                           TextWrapping="Wrap" TextAlignment="Center" Margin="0,4,0,12"/>
                                <Button Content="📤 Upload Log File" Command="{Binding UploadLogCommand}"
                                        Background="{StaticResource AccentPrimary}" Foreground="White" BorderThickness="0"
                                        Padding="16,8" FontSize="12" HorizontalAlignment="Center" Cursor="Hand"/>
                            </StackPanel>
                        </Border>

                        <Border Background="{StaticResource BgInput}" CornerRadius="6" 
                                Grid.Row="3" Padding="10,8" Margin="0,0,0,8"
                                Visibility="{Binding IsStreaming, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}">
                            <WrapPanel>
                                <CheckBox Content="Reads (SOQL)" IsChecked="{Binding ShowSoqlOperations}" Foreground="{StaticResource TextSecondary}" Margin="0,2,12,2" FontSize="11" ToolTip="Database read operations (SOQL queries)"/>
                                <CheckBox Content="Writes (DML)" IsChecked="{Binding ShowDmlOperations}" Foreground="{StaticResource TextSecondary}" Margin="0,2,12,2" FontSize="11" ToolTip="Database write operations (inserts, updates, deletes)"/>
                                <CheckBox Content="Errors" IsChecked="{Binding ShowErrorsOnly}" Foreground="{StaticResource TextSecondary}" Margin="0,2,12,2" FontSize="11"/>
                                <CheckBox Content="Debug" IsChecked="{Binding ShowDebugStatements}" Foreground="{StaticResource TextSecondary}" Margin="0,2,12,2" FontSize="11"/>
                            </WrapPanel>
                        </Border>
                        
                        <!-- Live Streaming Panel (shown when streaming) -->
                        <Border Background="{StaticResource BgTertiary}" CornerRadius="8" 
                                Grid.Row="5" Padding="12" Margin="0,8,0,0"
                                Visibility="{Binding IsStreaming, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Header -->
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <Ellipse Width="10" Height="10" Fill="{StaticResource Danger}" Margin="0,0,8,0">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                                        <DataTrigger.EnterActions>
                                                            <BeginStoryboard>
                                                                <Storyboard RepeatBehavior="Forever">
                                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                     From="1" To="0.3" Duration="0:0:0.5"
                                                                                     AutoReverse="True"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </DataTrigger.EnterActions>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                    <TextBlock Text="📡 Live Stream" FontSize="14" FontWeight="SemiBold" 
                                               Foreground="{StaticResource Danger}"/>
                                </StackPanel>
                                
                                <!-- Stream Output -->
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="200">
                                    <ItemsControl ItemsSource="{Binding StreamingLogs}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Margin="0,4" CornerRadius="4" Cursor="Hand">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="{StaticResource BgTertiary}"/>
                                                            <Setter Property="Padding" Value="8"/>
                                                            <Style.Triggers>
                                                                <!-- Log entries with Analysis (actual logs) -->
                                                                <DataTrigger Binding="{Binding Analysis, Converter={StaticResource NullToVisibilityConverter}}" Value="Visible">
                                                                    <Setter Property="Background" Value="{StaticResource BgHover}"/>
                                                                </DataTrigger>
                                                                <!-- Status messages (no Analysis) -->
                                                                <DataTrigger Binding="{Binding Analysis}" Value="{x:Null}">
                                                                    <Setter Property="Padding" Value="4,2"/>
                                                                    <Setter Property="Background" Value="Transparent"/>
                                                                </DataTrigger>
                                                                <!-- Error messages -->
                                                                <DataTrigger Binding="{Binding IsError}" Value="True">
                                                                    <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    
                                                    <Grid>
                                                        <!-- Rich Log Card (when Analysis exists) -->
                                                        <Grid Visibility="{Binding Analysis, Converter={StaticResource NullToVisibilityConverter}}">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            
                                                            <StackPanel>
                                                                <!-- Log ID and Timestamp -->
                                                                <Grid Margin="0,0,0,4">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Text="{Binding LogId}" FontWeight="SemiBold" 
                                                                               FontSize="11" Foreground="White"/>
                                                                    <TextBlock Grid.Column="1" FontSize="9" Foreground="{StaticResource TextMuted}" 
                                                                               HorizontalAlignment="Right" VerticalAlignment="Center">
                                                                        <Run Text="{Binding Timestamp, StringFormat=h:mm:ss tt}"/>
                                                                    </TextBlock>
                                                                </Grid>
                                                                
                                                                <!-- Operation Type and User -->
                                                                <TextBlock FontSize="10" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,2">
                                                                    <Run Text="{Binding OperationType, Mode=OneWay}" FontWeight="SemiBold"/>
                                                                    <Run Text=" by " Foreground="{StaticResource TextMuted}"/>
                                                                    <Run Text="{Binding User}" Foreground="{StaticResource AccentPrimary}"/>
                                                                </TextBlock>
                                                                
                                                                <!-- Plain English Insight (NEW!) -->
                                                                <TextBlock FontSize="10" Foreground="White" Margin="0,4,0,2" 
                                                                           FontWeight="SemiBold" TextWrapping="Wrap">
                                                                    <Run Text="{Binding InsightIcon}"/>
                                                                    <Run Text=" "/>
                                                                    <Run Text="{Binding Insight}"/>
                                                                </TextBlock>
                                                                
                                                                <!-- Duration and Lines -->
                                                                <TextBlock FontSize="9" Foreground="{StaticResource TextMuted}">
                                                                    <Run Text="{Binding Duration}"/>
                                                                    <Run Text=" � "/>
                                                                    <Run Text="{Binding LineCount}"/>
                                                                    <Run Text=" lines"/>
                                                                </TextBlock>
                                                            </StackPanel>
                                                            
                                                            <!-- Status Badge -->
                                                            <Border Grid.Column="1" CornerRadius="3" Padding="6,2" 
                                                                    VerticalAlignment="Top" Margin="8,0,0,0">
                                                                <Border.Style>
                                                                    <Style TargetType="Border">
                                                                        <Setter Property="Background" Value="{StaticResource Success}"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsError}" Value="True">
                                                                                <Setter Property="Background" Value="{StaticResource Danger}"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Border.Style>
                                                                <TextBlock Text="{Binding Status}" FontSize="9" 
                                                                           FontWeight="Bold" Foreground="White"/>
                                                            </Border>
                                                        </Grid>
                                                        
                                                        <!-- Simple Status Message (no Analysis) -->
                                                        <StackPanel Visibility="{Binding Analysis, Converter={StaticResource InverseNullToVisibilityConverter}}">
                                                            <TextBlock FontSize="10" Foreground="{StaticResource TextMuted}">
                                                                <Run Text="["/><Run Text="{Binding Timestamp, StringFormat=HH:mm:ss}"/><Run Text="]"/>
                                                            </TextBlock>
                                                            <TextBlock Text="{Binding Message}" TextWrapping="Wrap" FontSize="11">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsError}" Value="True">
                                                                                <Setter Property="Foreground" Value="{StaticResource Danger}"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>
                                                        </StackPanel>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                                
                                <!-- Recording/Stop Buttons -->
                                <Grid Grid.Row="2" Margin="0,12,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Start Recording Button (when not recording) -->
                                    <Button Grid.Column="0">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="RecordCircle" Width="16" Height="16" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                            <TextBlock Text="Record Interaction" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <!-- Stop Recording Button (when recording) -->
                                    <Button Grid.Column="0" 
                                            Command="{Binding StopRecordingAsyncCommand}"
                                            Style="{StaticResource DiscordPrimaryButton}"
                                            Background="{StaticResource Danger}"
                                            Visibility="{Binding IsRecording, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel Orientation="Horizontal">
                                            <Ellipse Width="8" Height="8" Fill="White" Margin="0,0,8,0">
                                                <Ellipse.Style>
                                                    <Style TargetType="Ellipse">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsRecording}" Value="True">
                                                                <DataTrigger.EnterActions>
                                                                    <BeginStoryboard>
                                                                        <Storyboard RepeatBehavior="Forever">
                                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                             From="1" To="0.3" Duration="0:0:0.5"
                                                                                             AutoReverse="True"/>
                                                                        </Storyboard>
                                                                    </BeginStoryboard>
                                                                </DataTrigger.EnterActions>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Ellipse.Style>
                                            </Ellipse>
                                            <TextBlock Text="? Stop Recording"/>
                                            <TextBlock Text="{Binding RecordingElapsedTime}" Margin="8,0,0,0" Opacity="0.8"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <!-- Stop Streaming Button -->
                                    <Button Grid.Column="2" Content="? Stop Streaming" 
                                            Command="{Binding ToggleStreamingCommand}"
                                            Style="{StaticResource DiscordSecondaryButton}"
                                            IsEnabled="{Binding IsRecording, Converter={StaticResource InverseBooleanConverter}}"/>
                                </Grid>
                                
                                <!-- Recorded Interactions List -->
                                <Border Grid.Row="3" Background="{StaticResource BgInput}" CornerRadius="6" 
                                        Margin="0,12,0,0" Padding="8"
                                        Visibility="{Binding Interactions.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        <TextBlock Text="📼 Recorded Interactions" FontSize="12" FontWeight="SemiBold" 
                                                   Foreground="{StaticResource TextSecondary}" Margin="0,0,0,8"/>
                                        <ScrollViewer Grid.Row="1" MaxHeight="150" VerticalScrollBarVisibility="Auto">
                                            <ItemsControl ItemsSource="{Binding Interactions}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="4" 
                                                                Padding="8" Margin="0,0,0,4" Cursor="Hand"
                                                                MouseLeftButtonUp="InteractionCard_Click">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                <StackPanel>
                                                                    <TextBlock Text="{Binding Name}" FontSize="12" 
                                                                               FontWeight="SemiBold" Foreground="White"/>
                                                                    <TextBlock Text="{Binding Summary}" FontSize="10" 
                                                                               Foreground="{StaticResource TextMuted}" Margin="0,2,0,0"/>
                                                                </StackPanel>
                                                                <Border Grid.Column="1" CornerRadius="3" Padding="6,2" 
                                                                        VerticalAlignment="Center">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="{StaticResource Success}"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                                    <Setter Property="Background" Value="{StaticResource Danger}"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock FontSize="9" FontWeight="Bold" Foreground="White">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Text" Value="OK"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                                        <Setter Property="Text" Value="ERROR"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>

                <!-- Spacer -->
                <Grid Grid.Column="1"/>

                <!-- Right Content - Analysis with Tabs -->
                <Border Grid.Column="2" Style="{StaticResource DiscordCard}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Tab Headers — VS Code underline style -->
                        <Border Grid.Row="0" BorderBrush="{StaticResource BorderDefault}" BorderThickness="0,0,0,1" Padding="4,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                    <GradientStop Color="#0D0D16" Offset="0"/>
                                    <GradientStop Color="#13131E" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                            <StackPanel Orientation="Horizontal">
                                <!-- Explain Tab -->
                                <Button Command="{Binding SelectTabCommand}" Cursor="Hand" BorderThickness="0" Padding="16,0" Height="44">
                                    <Button.CommandParameter><sys:Int32>4</sys:Int32></Button.CommandParameter>
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Grid>
                                                <Border x:Name="Bg" Background="Transparent" Padding="{TemplateBinding Padding}">
                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                        <materialDesign:PackIcon Kind="Lightbulb" Width="15" Height="15" VerticalAlignment="Center" Margin="0,0,6,0"
                                                                                 Foreground="{Binding SelectedTabIndex, Converter={StaticResource IntEqualsToVisibilityConverter}, ConverterParameter=4, RelativeSource={RelativeSource AncestorType=Window}}"/>
                                                        <TextBlock Text="Explain" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Foreground" Value="{StaticResource TextMuted}"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding SelectedTabIndex}" Value="4">
                                                                            <Setter Property="Foreground" Value="White"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Border>
                                                <!-- Underline indicator -->
                                                <Border x:Name="Underline" Height="2" VerticalAlignment="Bottom" CornerRadius="1,1,0,0"
                                                        Visibility="Collapsed">
                                                    <Border.Background>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                            <GradientStop Color="#7C6AFF" Offset="0"/>
                                                            <GradientStop Color="#A78BFA" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Border.Background>
                                                </Border>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <DataTrigger Binding="{Binding SelectedTabIndex}" Value="4">
                                                    <Setter TargetName="Underline" Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bg" Property="Background" Value="{StaticResource BgHover}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                                <!-- Summary Tab -->
                                <Button Command="{Binding SelectTabCommand}" Cursor="Hand" BorderThickness="0" Padding="16,0" Height="44">
                                    <Button.CommandParameter><sys:Int32>0</sys:Int32></Button.CommandParameter>
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Grid>
                                                <Border x:Name="Bg" Background="Transparent" Padding="{TemplateBinding Padding}">
                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                        <materialDesign:PackIcon Kind="ChartBox" Width="15" Height="15" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                                        <TextBlock Text="Summary" FontSize="13" VerticalAlignment="Center">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Foreground" Value="{StaticResource TextMuted}"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding SelectedTabIndex}" Value="0">
                                                                            <Setter Property="Foreground" Value="White"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Border>
                                                <Border x:Name="Underline" Height="2" VerticalAlignment="Bottom" CornerRadius="1,1,0,0" Visibility="Collapsed">
                                                    <Border.Background>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                            <GradientStop Color="#7C6AFF" Offset="0"/>
                                                            <GradientStop Color="#A78BFA" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Border.Background>
                                                </Border>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <DataTrigger Binding="{Binding SelectedTabIndex}" Value="0">
                                                    <Setter TargetName="Underline" Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bg" Property="Background" Value="{StaticResource BgHover}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                                <!-- Tree Tab -->
                                <Button Command="{Binding SelectTabCommand}" Cursor="Hand" BorderThickness="0" Padding="16,0" Height="44">
                                    <Button.CommandParameter><sys:Int32>1</sys:Int32></Button.CommandParameter>
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Grid>
                                                <Border x:Name="Bg" Background="Transparent" Padding="{TemplateBinding Padding}">
                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                        <materialDesign:PackIcon Kind="FileTree" Width="15" Height="15" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                                        <TextBlock Text="Tree" FontSize="13" VerticalAlignment="Center">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Foreground" Value="{StaticResource TextMuted}"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding SelectedTabIndex}" Value="1">
                                                                            <Setter Property="Foreground" Value="White"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Border>
                                                <Border x:Name="Underline" Height="2" VerticalAlignment="Bottom" CornerRadius="1,1,0,0" Visibility="Collapsed">
                                                    <Border.Background>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                            <GradientStop Color="#7C6AFF" Offset="0"/>
                                                            <GradientStop Color="#A78BFA" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Border.Background>
                                                </Border>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <DataTrigger Binding="{Binding SelectedTabIndex}" Value="1">
                                                    <Setter TargetName="Underline" Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bg" Property="Background" Value="{StaticResource BgHover}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                                <!-- Timeline Tab -->
                                <Button Command="{Binding SelectTabCommand}" Cursor="Hand" BorderThickness="0" Padding="16,0" Height="44">
                                    <Button.CommandParameter><sys:Int32>2</sys:Int32></Button.CommandParameter>
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Grid>
                                                <Border x:Name="Bg" Background="Transparent" Padding="{TemplateBinding Padding}">
                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                        <materialDesign:PackIcon Kind="Timeline" Width="15" Height="15" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                                        <TextBlock Text="Timeline" FontSize="13" VerticalAlignment="Center">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Foreground" Value="{StaticResource TextMuted}"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding SelectedTabIndex}" Value="2">
                                                                            <Setter Property="Foreground" Value="White"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Border>
                                                <Border x:Name="Underline" Height="2" VerticalAlignment="Bottom" CornerRadius="1,1,0,0" Visibility="Collapsed">
                                                    <Border.Background>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                            <GradientStop Color="#7C6AFF" Offset="0"/>
                                                            <GradientStop Color="#A78BFA" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Border.Background>
                                                </Border>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <DataTrigger Binding="{Binding SelectedTabIndex}" Value="2">
                                                    <Setter TargetName="Underline" Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bg" Property="Background" Value="{StaticResource BgHover}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                                <!-- Queries Tab -->
                                <Button Command="{Binding SelectTabCommand}" Cursor="Hand" BorderThickness="0" Padding="16,0" Height="44">
                                    <Button.CommandParameter><sys:Int32>3</sys:Int32></Button.CommandParameter>
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Grid>
                                                <Border x:Name="Bg" Background="Transparent" Padding="{TemplateBinding Padding}">
                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                        <materialDesign:PackIcon Kind="DatabaseSearch" Width="15" Height="15" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                                        <TextBlock Text="Queries" FontSize="13" VerticalAlignment="Center">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Foreground" Value="{StaticResource TextMuted}"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding SelectedTabIndex}" Value="3">
                                                                            <Setter Property="Foreground" Value="White"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Border>
                                                <Border x:Name="Underline" Height="2" VerticalAlignment="Bottom" CornerRadius="1,1,0,0" Visibility="Collapsed">
                                                    <Border.Background>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                            <GradientStop Color="#7C6AFF" Offset="0"/>
                                                            <GradientStop Color="#A78BFA" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Border.Background>
                                                </Border>
                                            </Grid>
                                            <ControlTemplate.Triggers>
                                                <DataTrigger Binding="{Binding SelectedTabIndex}" Value="3">
                                                    <Setter TargetName="Underline" Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Bg" Property="Background" Value="{StaticResource BgHover}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </StackPanel>
                            </ScrollViewer>
                        </Border>

                        <!-- Tab Content -->
                        <Grid Grid.Row="1">
                            <!-- "No log selected" empty state overlay -->
                            <Border Background="{StaticResource BgSecondary}" 
                                    Visibility="{Binding SelectedLog, Converter={StaticResource InverseNullToVisibilityConverter}}"
                                    Panel.ZIndex="10">
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="400">
                                    <TextBlock Text="📂" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                                    <TextBlock Text="Select a log to analyze" FontSize="18" FontWeight="Bold" 
                                               Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                    <TextBlock TextWrapping="Wrap" TextAlignment="Center" FontSize="13" 
                                               Foreground="{StaticResource TextMuted}" Margin="0,0,0,20">
                                        Upload a debug log file, load from a folder, or download from your Salesforce org. 
                                        Then click a log from the list to see the full analysis.
                                    </TextBlock>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button Content="📤 Upload File" Command="{Binding UploadLogCommand}"
                                                Background="{StaticResource AccentPrimary}" Foreground="White" BorderThickness="0"
                                                Padding="16,8" FontSize="12" Cursor="Hand" Margin="0,0,8,0"/>
                                        <Button Content="📁 Load Folder" Command="{Binding LoadLogFolderCommand}"
                                                Background="{StaticResource BgHover}" Foreground="{StaticResource TextSecondary}" BorderThickness="0"
                                                Padding="16,8" FontSize="12" Cursor="Hand"/>
                                    </StackPanel>
                                    <TextBlock Text="or drag &amp; drop a .log file anywhere" FontSize="11" 
                                               Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" Margin="0,12,0,0"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Summary Tab (Index 0) - VISUAL DASHBOARD -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,16"
                                          Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntEqualsToVisibilityConverter}, ConverterParameter=0}">
                                <StackPanel MaxWidth="900">
                                    
                                    <!-- ===== TRUNCATED LOG WARNING ===== -->
                                    <Border CornerRadius="8" Margin="0,0,0,12" Padding="14,10"
                                            Background="{StaticResource WarningSubtle}"
                                            BorderBrush="{StaticResource Warning}" BorderThickness="0,0,0,2"
                                            Visibility="{Binding IsLogTruncated, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="⚠️" FontSize="18" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="Log Truncated — Data May Be Incomplete" FontSize="13" FontWeight="Bold"
                                                           Foreground="{StaticResource Warning}"/>
                                                <TextBlock FontSize="11" Foreground="{StaticResource TextSecondary}" Margin="0,3,0,0" TextWrapping="Wrap"
                                                           Text="Salesforce cut this log short before it finished writing. Governor limit counters, timing totals, and issue counts may be understated. Raise your debug level retention or reduce log verbosity."/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- ===== TRANSACTION GROUP AGGREGATE METRICS ===== -->
                                    <!-- Only visible when viewing a grouped transaction (ShowGroupedView=true and SelectedLogGroup!=null) -->
                                    <Border CornerRadius="12" Margin="0,0,0,16" Padding="20" Background="{StaticResource AccentSubtle}"
                                            BorderBrush="{StaticResource AccentPrimary}" BorderThickness="0,0,0,3">
                                        <Border.Visibility>
                                            <MultiBinding Converter="{StaticResource MultiBooleanToVisibilityConverter}">
                                                <Binding Path="ShowGroupedView"/>
                                                <Binding Path="SelectedLogGroup" Converter="{StaticResource NullToBooleanConverter}"/>
                                            </MultiBinding>
                                        </Border.Visibility>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- Header -->
                                            <Grid Grid.Row="0" Margin="0,0,0,12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="📦" FontSize="24" VerticalAlignment="Center" Margin="0,0,12,0"/>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="Transaction Group Analysis" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                                    <TextBlock Text="{Binding GroupSummary}" FontSize="12" Foreground="{StaticResource TextSecondary}" Margin="0,2,0,0"/>
                                                </StackPanel>
                                            </Grid>
                                            
                                            <!-- Phase Breakdown -->
                                            <Border Grid.Row="1" Background="{StaticResource BgSecondary}" CornerRadius="8" Padding="14,10" Margin="0,0,0,10">
                                                <TextBlock Text="{Binding GroupPhaseBreakdown}" FontSize="11" FontFamily="Consolas"
                                                           Foreground="{StaticResource TextSecondary}" TextWrapping="Wrap"/>
                                            </Border>
                                            
                                            <!-- Aggregate Stats Row -->
                                            <Grid Grid.Row="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <!-- Total SOQL -->
                                                <Border Grid.Column="0" Background="{StaticResource BgSecondary}" CornerRadius="6" Padding="10,6" Margin="0,0,6,0">
                                                    <StackPanel>
                                                        <TextBlock Text="Total SOQL Queries" FontSize="9" Foreground="{StaticResource TextMuted}"/>
                                                        <TextBlock FontSize="16" FontWeight="Bold" Foreground="{StaticResource AccentPrimary}" Margin="0,2,0,0">
                                                            <Run Text="{Binding SelectedLogGroup.TotalSoqlQueries}"/>
                                                            <Run Text=" / 100" FontSize="10" Foreground="{StaticResource TextMuted}"/>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- Total DML -->
                                                <Border Grid.Column="1" Background="{StaticResource BgSecondary}" CornerRadius="6" Padding="10,6" Margin="0,0,6,0">
                                                    <StackPanel>
                                                        <TextBlock Text="Total DML Statements" FontSize="9" Foreground="{StaticResource TextMuted}"/>
                                                        <TextBlock FontSize="16" FontWeight="Bold" Foreground="{StaticResource AccentPrimary}" Margin="0,2,0,0">
                                                            <Run Text="{Binding SelectedLogGroup.TotalDmlStatements}"/>
                                                            <Run Text=" / 150" FontSize="10" Foreground="{StaticResource TextMuted}"/>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Border>
                                                
                                                <!-- Total CPU -->
                                                <Border Grid.Column="2" Background="{StaticResource BgSecondary}" CornerRadius="6" Padding="10,6">
                                                    <StackPanel>
                                                        <TextBlock Text="Total CPU Time" FontSize="9" Foreground="{StaticResource TextMuted}"/>
                                                        <TextBlock FontSize="16" FontWeight="Bold" Foreground="{StaticResource AccentPrimary}" Margin="0,2,0,0">
                                                            <Run Text="{Binding SelectedLogGroup.TotalCpuTime}"/>
                                                            <Run Text="ms" FontSize="10" Foreground="{StaticResource TextMuted}"/>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Border>
                                            </Grid>
                                        </Grid>
                                    </Border>

                                    <!-- ===== MIXED CONTEXT WARNING (Governance Education) ===== -->
                                    <!-- Only visible when ShowMixedContextWarning=true -->
                                    <Border CornerRadius="12" Margin="0,0,0,16" Padding="20,16" Background="#2A2520"
                                            BorderBrush="{StaticResource Warning}" BorderThickness="0,0,0,3"
                                            Visibility="{Binding ShowMixedContextWarning, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- Header -->
                                            <Grid Grid.Row="0" Margin="0,0,0,12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <TextBlock Grid.Column="0" Text="🔍" FontSize="28" VerticalAlignment="Center" Margin="0,0,12,0"/>
                                                
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="Governance Insight: Mixed Execution Contexts" FontSize="16" FontWeight="Bold" 
                                                               Foreground="{StaticResource Warning}"/>
                                                    <TextBlock Text="This can make debugging confusing. Here's what's happening..." 
                                                               FontSize="11" Foreground="{StaticResource TextMuted}" Margin="0,2,0,0"/>
                                                </StackPanel>
                                            </Grid>
                                            
                                            <!-- Friendly Explanation -->
                                            <Border Grid.Row="1" Background="{StaticResource BgSecondary}" CornerRadius="8" Padding="14,10" Margin="0,0,0,12">
                                                <TextBlock Text="{Binding MixedContextExplanation}" TextWrapping="Wrap" FontSize="12" 
                                                           Foreground="White" LineHeight="18"/>
                                            </Border>
                                            
                                            <!-- Context Breakdown -->
                                            <StackPanel Grid.Row="2" Margin="0,0,0,12">
                                                <TextBlock Text="What's in this transaction group:" FontSize="11" FontWeight="SemiBold" 
                                                           Foreground="{StaticResource TextSecondary}" Margin="0,0,0,6"/>
                                                <ItemsControl ItemsSource="{Binding ContextBreakdown}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Background="{StaticResource BgTertiary}" CornerRadius="6" Padding="10,6" Margin="0,0,0,4">
                                                                <TextBlock Text="{Binding}" FontSize="11" Foreground="{StaticResource TextSecondary}" FontFamily="Consolas"/>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                            
                                            <!-- Best Practice Recommendation -->
                                            <Border Grid.Row="3" Background="#1A2F1A" CornerRadius="8" Padding="14,10" BorderBrush="{StaticResource Success}" BorderThickness="1">
                                                <StackPanel>
                                                    <TextBlock FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource Success}" Margin="0,0,0,6">
                                                        <Run Text="💡"/>
                                                        <Run Text="Best Practice:"/>
                                                    </TextBlock>
                                                    <TextBlock TextWrapping="Wrap" FontSize="11" Foreground="{StaticResource TextSecondary}" LineHeight="16">
                                                        <Run Text="Create dedicated users for automation:"/>
                                                        <LineBreak/>
                                                        <Run Text="  • IntegrationUser for API calls (e.g., IntegrationUser-SAP)"/>
                                                        <LineBreak/>
                                                        <Run Text="  • BatchUser for scheduled jobs (e.g., BatchUser-NightlyCleanup)"/>
                                                        <LineBreak/>
                                                        <LineBreak/>
                                                        <Run Text="This keeps your debug logs clean and makes troubleshooting 10x easier!" FontStyle="Italic"/>
                                                    </TextBlock>
                                                </StackPanel>
                                            </Border>
                                        </Grid>
                                    </Border>

                                    <!-- ===== HERO STATUS BANNER (Modern) ===== -->
                                    <Border CornerRadius="12" Margin="0,0,0,16" Padding="20">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                            <GradientStop Color="#0D2137" Offset="0"/>
                                                            <GradientStop Color="#1A3A5C" Offset="0.55"/>
                                                            <GradientStop Color="#1E4A7A" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HeroStatus}" Value="FAILED">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                    <GradientStop Color="#DC2626" Offset="0"/>
                                                                    <GradientStop Color="#991B1B" Offset="0.6"/>
                                                                    <GradientStop Color="#7F1D1D" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding HeroStatus}" Value="SUCCESS">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                    <GradientStop Color="#0A3D24" Offset="0"/>
                                                                    <GradientStop Color="#064E3B" Offset="0.5"/>
                                                                    <GradientStop Color="#083D30" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding HeroStatus}" Value="WARNING">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                    <GradientStop Color="#4D2E00" Offset="0"/>
                                                                    <GradientStop Color="#7C4A00" Offset="0.6"/>
                                                                    <GradientStop Color="#5C3500" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Status Icon with glow -->
                                            <Border Grid.Column="0" Width="60" Height="60" CornerRadius="30" Background="#1A1A1A40" Margin="0,0,16,0">
                                                <TextBlock FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="?"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="WARNING">
                                                                    <Setter Property="Text" Value="?"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="FAILED">
                                                                    <Setter Property="Text" Value="?"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="TEST">
                                                                    <Setter Property="Text" Value="??"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Border>

                                            <!-- Status Text + Entry -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock FontSize="20" FontWeight="Bold" Foreground="White">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="Transaction Completed"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="WARNING">
                                                                    <Setter Property="Text" Value="Completed with Warnings"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="FAILED">
                                                                    <Setter Property="Text" Value="Transaction Failed"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="TEST">
                                                                    <Setter Property="Text" Value="Test Execution"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                                <TextBlock Text="{Binding HeroEntryPoint}" FontSize="13" Foreground="#FFFFFFCC"
                                                           Visibility="{Binding HeroEntryPoint, Converter={StaticResource StringToVisibilityConverter}}"/>
                                                <StackPanel Orientation="Horizontal">
                                                    <Border Background="#FFFFFF30" CornerRadius="10" Padding="10,4" Margin="0,0,8,0">
                                                        <TextBlock Text="Live Analysis" FontSize="11" Foreground="White"/>
                                                    </Border>
                                                    <Border Background="#00000030" CornerRadius="10" Padding="10,4" Margin="0,0,8,0">
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <TextBlock Text="?" FontSize="11"/>
                                                            <TextBlock Text="{Binding StatErrorCount}" FontSize="11" Foreground="White" Margin="6,0,0,0"/>
                                                            <TextBlock Text="errors" FontSize="11" Foreground="#FFFFFFCC"/>
                                                        </StackPanel>
                                                    </Border>
                                                    <Border Background="#00000030" CornerRadius="10" Padding="10,4">
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <TextBlock Text="??" FontSize="11"/>
                                                            <TextBlock Text="{Binding StatWarningCount}" FontSize="11" Foreground="White" Margin="6,0,0,0"/>
                                                            <TextBlock Text="warnings" FontSize="11" Foreground="#FFFFFFCC"/>
                                                        </StackPanel>
                                                    </Border>
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- Duration Badge -->
                                            <Border Grid.Column="2" Background="#1A1A1A55" CornerRadius="10" Padding="16,10" VerticalAlignment="Center">
                                                <StackPanel HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding HeroDuration}" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="Total Duration" FontSize="11" Foreground="#FFFFFFAA" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                        </Grid>
                                    </Border>
                                    
                                    <!-- ===== TIMELINE STRIP ===== -->
                                    <StackPanel Margin="0,0,0,16"
                                                Visibility="{Binding HasTimelineData, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Order of Execution" FontSize="18" FontWeight="SemiBold"/>
                                            <TextBlock Grid.Column="1" FontSize="12" Foreground="{StaticResource TextMuted}" VerticalAlignment="Center">
                                                <Run Text="Total "/>
                                                <Run Text="{Binding TimelineTotalDurationMs, StringFormat={}{0:N0}ms}"/>
                                            </TextBlock>
                                        </Grid>

                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="10" Padding="8" BorderBrush="{StaticResource BorderDefault}" BorderThickness="1">
                                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Hidden">
                                                <ItemsControl ItemsSource="{Binding TimelineSegments}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <StackPanel Orientation="Horizontal"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Margin="4,4,4,4" Padding="10,6" CornerRadius="8"
                                                                    Width="{Binding Percent, Converter={StaticResource PercentToWidthConverter}}"
                                                                    ToolTip="{Binding Name}" BorderThickness="1">
                                                                <Border.Style>
                                                                    <Style TargetType="Border">
                                                                        <Setter Property="Background" Value="{StaticResource AccentPrimary}"/>
                                                                        <Setter Property="BorderBrush" Value="{StaticResource BorderDefault}"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding Type}" Value="Trigger">
                                                                                <Setter Property="Background" Value="#8B5CF6"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding Type}" Value="Flow">
                                                                                <Setter Property="Background" Value="#22D3EE"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding Type}" Value="Validation">
                                                                                <Setter Property="Background" Value="#F59E0B"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding Type}" Value="DML">
                                                                                <Setter Property="Background" Value="#F97316"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding Type}" Value="Async">
                                                                                <Setter Property="Background" Value="#10B981"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding IsSlowest}" Value="True">
                                                                                <Setter Property="BorderBrush" Value="{StaticResource Warning}"/>
                                                                                <Setter Property="BorderThickness" Value="2"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Border.Style>
                                                                <StackPanel>
                                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                                        <TextBlock Text="{Binding Icon}" Margin="0,0,6,0"/>
                                                                        <TextBlock Text="{Binding Type}" FontWeight="SemiBold" FontSize="12"/>
                                                                        <TextBlock Text="{Binding DurationMs, StringFormat={}{0:N0}ms}" FontSize="12" Foreground="{StaticResource TextPrimary}" Margin="6,0,0,0"/>
                                                                    </StackPanel>
                                                                    <TextBlock Text="{Binding Name}" FontSize="11" Foreground="{StaticResource TextSecondary}" TextTrimming="CharacterEllipsis"/>
                                                                    <StackPanel Orientation="Horizontal" Visibility="{Binding IsRecursive, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                        <TextBlock Text="🔄 Recursive" FontSize="10" Foreground="{StaticResource Warning}"/>
                                                                    </StackPanel>
                                                                </StackPanel>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </ScrollViewer>
                                        </Border>

                                        <TextBlock Text="{Binding TimelineSummary}" FontSize="12" Foreground="{StaticResource TextMuted}" TextWrapping="Wrap" Margin="0,6,0,0"/>
                                        <TextBlock Text="{Binding TimelineSlowestLabel}" FontSize="12" Foreground="{StaticResource Warning}" Margin="0,2,0,0"
                                                   Visibility="{Binding TimelineSlowestLabel, Converter={StaticResource StringToVisibilityConverter}}"/>
                                    </StackPanel>
                                    
                                    <!-- ===== HEALTH SCORE DASHBOARD (Conic-like Arc) ===== -->
                                    <Border Style="{StaticResource DiscordCard}" Padding="20" Margin="0,0,0,16"
                                            Visibility="{Binding HasHealthData, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Health Score Arc -->
                                            <Grid Grid.Column="0" Width="140" Height="140" Margin="0,0,24,0">
                                                <!-- Background ring -->
                                                <Ellipse Width="140" Height="140" Stroke="{StaticResource BorderDefault}" StrokeThickness="10"/>

                                                <!-- Foreground arc -->
                                                <Path StrokeThickness="10" StrokeStartLineCap="Round" StrokeEndLineCap="Round"
                                                      Data="{Binding HealthScore, Converter={StaticResource ArcPathConverter}}"
                                                      Stroke="{Binding HealthScore, Converter={StaticResource HealthScoreToColorConverter}}">
                                                    <Path.Triggers>
                                                        <EventTrigger RoutedEvent="Loaded">
                                                            <BeginStoryboard>
                                                                <Storyboard RepeatBehavior="1x">
                                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.35"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </EventTrigger>
                                                    </Path.Triggers>
                                                </Path>

                                                <!-- Score text -->
                                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                                    <TextBlock FontSize="34" FontWeight="Bold" HorizontalAlignment="Center"
                                                             Foreground="{Binding HealthScore, Converter={StaticResource HealthScoreToColorConverter}}">
                                                        <Run Text="{Binding HealthScore, Mode=OneWay}"/><Run Text="/100" FontSize="16"/>
                                                    </TextBlock>
                                                    <TextBlock Text="{Binding HealthGrade}" FontSize="17" FontWeight="Bold" Foreground="{StaticResource TextSecondary}" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="{Binding HealthStatus}" FontSize="12" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>

                                            <!-- Health Info -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock FontSize="20" FontWeight="SemiBold" Margin="0,0,0,8">
                                                    <Run Text="{Binding HealthStatusIcon}"/>
                                                    <Run Text=" "/><Run Text="{Binding HealthStatus}"/>
                                                </TextBlock>
                                                <TextBlock Text="{Binding HealthReasoning}" FontSize="13" Foreground="{StaticResource TextSecondary}" TextWrapping="Wrap" LineHeight="20"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                                    <Border Background="{StaticResource DangerSubtle}" CornerRadius="4" Padding="12,6" Margin="0,0,8,0"
                                                            Visibility="{Binding CriticalIssues.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                        <TextBlock FontSize="12" FontWeight="SemiBold">
                                                            <Run Text="🚨" Foreground="{StaticResource Danger}"/>
                                                            <Run Text=" "/><Run Text="{Binding CriticalIssues.Count, Mode=OneWay}"/>
                                                            <Run Text=" Critical"/>
                                                        </TextBlock>
                                                    </Border>
                                                    <Border Background="{StaticResource WarningSubtle}" CornerRadius="4" Padding="12,6" Margin="0,0,8,0"
                                                            Visibility="{Binding HighPriorityIssues.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                        <TextBlock FontSize="12" FontWeight="SemiBold">
                                                            <Run Text="⚠️" Foreground="{StaticResource Warning}"/>
                                                            <Run Text=" "/><Run Text="{Binding HighPriorityIssues.Count, Mode=OneWay}"/>
                                                            <Run Text=" High"/>
                                                        </TextBlock>
                                                    </Border>
                                                    <Border Background="{StaticResource SuccessSubtle}" CornerRadius="4" Padding="12,6"
                                                            Visibility="{Binding QuickWins.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                        <TextBlock FontSize="12" FontWeight="SemiBold">
                                                            <Run Text="✅" Foreground="{StaticResource Success}"/>
                                                            <Run Text=" "/><Run Text="{Binding QuickWins.Count, Mode=OneWay}"/>
                                                            <Run Text=" Quick Wins"/>
                                                        </TextBlock>
                                                    </Border>
                                                    <TextBlock FontSize="12" Foreground="{StaticResource TextMuted}" Margin="16,0,0,0" VerticalAlignment="Center">
                                                        <Run Text="⏱️ "/><Run Text="{Binding TotalEstimatedMinutes, Mode=OneWay}"/><Run Text=" min to fix"/>
                                                    </TextBlock>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                    
                                    <!-- ===== FULL ANALYSIS SUMMARY ===== -->
                                    <Border Style="{StaticResource DiscordCard}" Padding="20" Margin="0,0,0,16"
                                            Visibility="{Binding FullSummaryText, Converter={StaticResource StringToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <TextBlock Text="📋" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Analysis Summary" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <TextBlock Text="{Binding FullSummaryText}" TextWrapping="Wrap" FontSize="13" Foreground="{StaticResource TextSecondary}" LineHeight="22"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ===== ACTIONABLE ISSUES ===== -->
                                    <StackPanel Visibility="{Binding HasHealthData, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        
                                        <!-- CRITICAL ISSUES -->
                                        <StackPanel Visibility="{Binding CriticalIssues.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}" Margin="0,0,0,16">
                                            <TextBlock Text="?? Critical Issues" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <ItemsControl ItemsSource="{Binding CriticalIssues}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Style="{StaticResource DiscordCard}" Padding="16" Margin="0,0,0,12" BorderBrush="{StaticResource Danger}" BorderThickness="2">
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                </Grid.RowDefinitions>
                                                                
                                                                <!-- Header -->
                                                                <Grid Grid.Row="0" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" FontSize="15" FontWeight="SemiBold">
                                                                        <Run Text="{Binding SeverityIcon, Mode=OneWay}"/>
                                                                        <Run Text=" "/><Run Text="{Binding Title, Mode=OneWay}"/>
                                                                    </TextBlock>
                                                                    <Border Grid.Column="1" Background="{StaticResource BgHover}" CornerRadius="4" Padding="8,4" Margin="0,0,6,0">
                                                                        <TextBlock Text="{Binding RoleBadge, Mode=OneWay}" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                                                    </Border>
                                                                    <Border Grid.Column="2" Background="{StaticResource BgHover}" CornerRadius="4" Padding="8,4">
                                                                        <TextBlock Text="{Binding DifficultyBadge, Mode=OneWay}" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                                                    </Border>
                                                                </Grid>
                                                                
                                                                <!-- Problem -->
                                                                <StackPanel Grid.Row="1" Margin="0,0,0,8">
                                                                    <TextBlock Text="Problem:" FontSize="12" Foreground="{StaticResource TextMuted}" FontWeight="SemiBold"/>
                                                                    <TextBlock Text="{Binding Problem}" FontSize="13" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap"/>
                                                                </StackPanel>
                                                                
                                                                <!-- Impact & Location -->
                                                                <Grid Grid.Row="2" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                                                        <TextBlock Text="?? Impact:" FontSize="12" Foreground="{StaticResource TextMuted}" FontWeight="SemiBold"/>
                                                                        <TextBlock Text="{Binding Impact}" FontSize="13" Foreground="{StaticResource Success}" TextWrapping="Wrap"/>
                                                                    </StackPanel>
                                                                    <StackPanel Grid.Column="1">
                                                                        <TextBlock Text="?? Location" FontSize="12" Foreground="{StaticResource TextMuted}" FontWeight="SemiBold"/>
                                                                        <Button Style="{StaticResource PillLinkButton}"
                                                                                Command="{Binding DataContext.OpenInEditorCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                                CommandParameter="{Binding Location}"
                                                                                ToolTip="Open in VSCode">
                                                                            <StackPanel Orientation="Horizontal">
                                                                                <TextBlock Text="??" FontSize="12"/>
                                                                                <TextBlock Text="{Binding Location}" FontSize="12" FontFamily="Consolas" Margin="6,0,0,0"/>
                                                                            </StackPanel>
                                                                        </Button>
                                                                    </StackPanel>
                                                                </Grid>
                                                                
                                                                <!-- Fix Recommendation -->
                                                                <Border Grid.Row="3" Background="{StaticResource BgHover}" CornerRadius="4" Padding="12">
                                                                    <StackPanel>
                                                                        <TextBlock Text="? How to Fix:" FontSize="12" Foreground="{StaticResource Success}" FontWeight="SemiBold" Margin="0,0,0,6"/>
                                                                        <TextBlock Text="{Binding Fix}" FontSize="13" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" LineHeight="20"/>
                                                                        <TextBlock Text="{Binding CodeExample}" FontSize="11" Foreground="{StaticResource Info}" FontFamily="Consolas" Margin="0,8,0,0" TextWrapping="Wrap"
                                                                                   Visibility="{Binding CodeExample, Converter={StaticResource StringToVisibilityConverter}}"/>
                                                                        <TextBlock FontSize="11" Foreground="{StaticResource TextMuted}" Margin="0,8,0,0">
                                                                            <Run Text="?? Estimated fix time: "/><Run Text="{Binding EstimatedFixTimeMinutes, Mode=OneWay}"/><Run Text=" minutes"/>
                                                                        </TextBlock>
                                                                    </StackPanel>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                        
                                        <!-- HIGH PRIORITY ISSUES -->
                                        <StackPanel Visibility="{Binding HighPriorityIssues.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}" Margin="0,0,0,16">
                                            <TextBlock Text="?? High Priority" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <ItemsControl ItemsSource="{Binding HighPriorityIssues}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Style="{StaticResource DiscordCard}" Padding="16" Margin="0,0,0,12" BorderBrush="{StaticResource Warning}" BorderThickness="2">
                                                            <!-- Same content as Critical Issues template -->
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                </Grid.RowDefinitions>
                                                                
                                                                <!-- Header -->
                                                                <Grid Grid.Row="0" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" FontSize="15" FontWeight="SemiBold">
                                                                        <Run Text="{Binding SeverityIcon, Mode=OneWay}"/>
                                                                        <Run Text=" "/><Run Text="{Binding Title, Mode=OneWay}"/>
                                                                    </TextBlock>
                                                                    <Border Grid.Column="1" Background="{StaticResource BgHover}" CornerRadius="4" Padding="8,4" Margin="0,0,6,0">
                                                                        <TextBlock Text="{Binding RoleBadge, Mode=OneWay}" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                                                    </Border>
                                                                    <Border Grid.Column="2" Background="{StaticResource BgHover}" CornerRadius="4" Padding="8,4">
                                                                        <TextBlock Text="{Binding DifficultyBadge, Mode=OneWay}" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                                                    </Border>
                                                                </Grid>
                                                                
                                                                <!-- Problem -->
                                                                <StackPanel Grid.Row="1" Margin="0,0,0,8">
                                                                    <TextBlock Text="Problem:" FontSize="12" Foreground="{StaticResource TextMuted}" FontWeight="SemiBold"/>
                                                                    <TextBlock Text="{Binding Problem}" FontSize="13" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap"/>
                                                                </StackPanel>
                                                                
                                                                <!-- Impact & Location -->
                                                                <Grid Grid.Row="2" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                                                        <TextBlock Text="?? Impact:" FontSize="12" Foreground="{StaticResource TextMuted}" FontWeight="SemiBold"/>
                                                                        <TextBlock Text="{Binding Impact}" FontSize="13" Foreground="{StaticResource Success}" TextWrapping="Wrap"/>
                                                                    </StackPanel>
                                                                    <StackPanel Grid.Column="1">
                                                                        <TextBlock Text="?? Location:" FontSize="12" Foreground="{StaticResource TextMuted}" FontWeight="SemiBold"/>
                                                                        <TextBlock Text="{Binding Location}" FontSize="13" Foreground="{StaticResource Info}" TextWrapping="Wrap" FontFamily="Consolas"/>
                                                                    </StackPanel>
                                                                </Grid>
                                                                
                                                                <!-- Fix Recommendation -->
                                                                <Border Grid.Row="3" Background="{StaticResource BgHover}" CornerRadius="4" Padding="12">
                                                                    <StackPanel>
                                                                        <TextBlock Text="? How to Fix:" FontSize="12" Foreground="{StaticResource Success}" FontWeight="SemiBold" Margin="0,0,0,6"/>
                                                                        <TextBlock Text="{Binding Fix}" FontSize="13" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" LineHeight="20"/>
                                                                        <TextBlock Text="{Binding CodeExample}" FontSize="11" Foreground="{StaticResource Info}" FontFamily="Consolas" Margin="0,8,0,0" TextWrapping="Wrap"
                                                                                   Visibility="{Binding CodeExample, Converter={StaticResource StringToVisibilityConverter}}"/>
                                                                        <TextBlock FontSize="11" Foreground="{StaticResource TextMuted}" Margin="0,8,0,0">
                                                                            <Run Text="?? Estimated fix time: "/><Run Text="{Binding EstimatedFixTimeMinutes, Mode=OneWay}"/><Run Text=" minutes"/>
                                                                        </TextBlock>
                                                                    </StackPanel>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                        
                                        <!-- QUICK WINS -->
                                        <StackPanel Visibility="{Binding QuickWins.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}" Margin="0,0,0,16">
                                            <TextBlock Text="?? Quick Wins (Easy Fixes)" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <ItemsControl ItemsSource="{Binding QuickWins}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Style="{StaticResource DiscordCard}" Padding="16" Margin="0,0,0,12" BorderBrush="{StaticResource Success}" BorderThickness="2">
                                                            <!-- Simplified template for quick wins -->
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                </Grid.RowDefinitions>
                                                                
                                                                <!-- Header -->
                                                                <Grid Grid.Row="0" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" FontSize="15" FontWeight="SemiBold">
                                                                        <Run Text="{Binding SeverityIcon, Mode=OneWay}"/>
                                                                        <Run Text=" "/><Run Text="{Binding Title, Mode=OneWay}"/>
                                                                    </TextBlock>
                                                                    <TextBlock Grid.Column="1" Text="{Binding RoleBadge, Mode=OneWay}" FontSize="11" Foreground="{StaticResource TextSecondary}" Margin="8,0,4,0" VerticalAlignment="Center"/>
                                                                    <TextBlock Grid.Column="2" FontSize="11" Foreground="{StaticResource Success}">
                                                                        <Run Text="?? "/><Run Text="{Binding EstimatedFixTimeMinutes, Mode=OneWay}"/><Run Text=" min"/>
                                                                    </TextBlock>
                                                                </Grid>
                                                                
                                                                <!-- Details -->
                                                                <StackPanel Grid.Row="1">
                                                                    <TextBlock FontSize="13" Foreground="{StaticResource TextPrimary}" TextWrapping="Wrap" Margin="0,0,0,6">
                                                                        <Run Text="{Binding Problem, Mode=OneWay}"/>
                                                                        <Run Text=" ? " Foreground="{StaticResource TextMuted}"/>
                                                                        <Run Text="{Binding Impact, Mode=OneWay}" Foreground="{StaticResource Success}"/>
                                                                    </TextBlock>
                                                                    <Button Style="{StaticResource PillLinkButton}" Margin="0,0,0,6"
                                                                            Command="{Binding DataContext.OpenInEditorCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                            CommandParameter="{Binding Location}"
                                                                            ToolTip="Open in VSCode">
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <TextBlock Text="??" FontSize="12"/>
                                                                            <TextBlock Text="{Binding Location}" FontSize="11" FontFamily="Consolas" Margin="6,0,0,0"/>
                                                                        </StackPanel>
                                                                    </Button>
                                                                    <TextBlock Text="{Binding Fix}" FontSize="12" Foreground="{StaticResource TextSecondary}" TextWrapping="Wrap"/>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <!-- ===== CLEAN BILL OF HEALTH (Congratulations Card) ===== -->
                                    <Border Background="{StaticResource SuccessSubtle}" CornerRadius="12" Padding="20" Margin="0,0,0,16" BorderBrush="{StaticResource Success}" BorderThickness="1"
                                            Visibility="{Binding IsCleanBillOfHealth, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="??" FontSize="36" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock Text="Clean Bill of Health!" FontSize="18" FontWeight="Bold" 
                                                       Foreground="{StaticResource Success}" HorizontalAlignment="Center" Margin="0,0,0,6"/>
                                            <TextBlock Text="No critical or high-priority issues found. This transaction looks great!" 
                                                       FontSize="13" Foreground="{StaticResource TextSecondary}" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center" Margin="0,0,0,4"/>
                                            <TextBlock FontSize="12" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center">
                                                <Run Text="Health Score: "/><Run Text="{Binding HealthScore}" Foreground="{StaticResource Success}" FontWeight="Bold"/><Run Text="/100"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ===== QUICK STATS ROW ===== -->
                                    <Grid Margin="0,0,0,16">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- SOQL Stat -->
                                        <Border Grid.Column="0" CornerRadius="8" Padding="14" Margin="0,0,8,0"
                                                BorderBrush="{StaticResource AccentPrimary}" BorderThickness="0,2,0,0">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                                    <GradientStop Color="#171730" Offset="0"/>
                                                    <GradientStop Color="#13131E" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <StackPanel HorizontalAlignment="Center">
                                                <TextBlock Text="??" FontSize="20" HorizontalAlignment="Center"/>
                                                <TextBlock FontSize="24" FontWeight="Bold" Foreground="{StaticResource AccentPrimary}" HorizontalAlignment="Center" Margin="0,2,0,0">
                                                    <Run Text="{Binding StatSoqlCount, Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="Reads (SOQL)" FontSize="11" Foreground="{StaticResource TextSecondary}" HorizontalAlignment="Center" Margin="0,2,0,0"
                                                           ToolTip="SOQL = Salesforce Object Query Language. These are database read operations."/>
                                                <!-- CMDT footnote: shown only when free CMDT queries were detected -->
                                                <TextBlock HorizontalAlignment="Center" Margin="0,4,0,0" FontSize="10"
                                                           Foreground="{StaticResource TextMuted}"
                                                           Visibility="{Binding CustomMetadataQueryCount, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}"
                                                           ToolTip="Custom Metadata Type queries don't consume your SOQL governor limit allocation.">
                                                    <Run Text="+"/><Run Text="{Binding CustomMetadataQueryCount, Mode=OneWay}"/><Run Text=" free CMDT"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- DML Stat -->
                                        <Border Grid.Column="1" CornerRadius="8" Padding="14" Margin="4,0"
                                                BorderBrush="{StaticResource Warning}" BorderThickness="0,2,0,0">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                                    <GradientStop Color="#1E1810" Offset="0"/>
                                                    <GradientStop Color="#13131E" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <StackPanel HorizontalAlignment="Center">
                                                <TextBlock Text="??" FontSize="20" HorizontalAlignment="Center"/>
                                                <TextBlock FontSize="24" FontWeight="Bold" Foreground="{StaticResource Warning}" HorizontalAlignment="Center" Margin="0,2,0,0">
                                                    <Run Text="{Binding StatDmlCount, Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="Writes (DML)" FontSize="11" Foreground="{StaticResource TextSecondary}" HorizontalAlignment="Center" Margin="0,2,0,0"
                                                           ToolTip="DML = Data Manipulation Language. These are database write operations (insert, update, delete)."/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- Errors Stat -->
                                        <Border Grid.Column="2" CornerRadius="8" Padding="14" Margin="4,0"
                                                BorderBrush="{StaticResource Danger}" BorderThickness="0,2,0,0">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                                    <GradientStop Color="#1E1010" Offset="0"/>
                                                    <GradientStop Color="#13131E" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <StackPanel HorizontalAlignment="Center">
                                                <TextBlock Text="?" FontSize="20" HorizontalAlignment="Center"/>
                                                <TextBlock FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,2,0,0">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="{StaticResource TextMuted}"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding StatErrorCount, Converter={StaticResource GreaterThanZeroConverter}}" Value="True">
                                                                    <Setter Property="Foreground" Value="{StaticResource Danger}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                    <Run Text="{Binding StatErrorCount, Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="Errors" FontSize="11" Foreground="{StaticResource TextSecondary}" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- Warnings Stat -->
                                        <Border Grid.Column="3" CornerRadius="8" Padding="14" Margin="8,0,0,0"
                                                BorderBrush="{StaticResource Warning}" BorderThickness="0,2,0,0">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                                    <GradientStop Color="#1A1608" Offset="0"/>
                                                    <GradientStop Color="#13131E" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <StackPanel HorizontalAlignment="Center">
                                                <TextBlock Text="??" FontSize="20" HorizontalAlignment="Center"/>
                                                <TextBlock FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,2,0,0">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="{StaticResource TextMuted}"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding StatWarningCount, Converter={StaticResource GreaterThanZeroConverter}}" Value="True">
                                                                    <Setter Property="Foreground" Value="{StaticResource Warning}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                    <Run Text="{Binding StatWarningCount, Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="Warnings" FontSize="11" Foreground="{StaticResource TextSecondary}" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                    
                                    <!-- ===== BULK SAFETY GRADE ===== -->
                                    <Border CornerRadius="8" Margin="0,0,0,16" Padding="16"
                                            Visibility="{Binding BulkSafetyGrade, Converter={StaticResource StringToVisibilityConverter}}">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="{StaticResource SuccessSubtle}"/>
                                                <Setter Property="BorderBrush" Value="{StaticResource Success}"/>
                                                <Setter Property="BorderThickness" Value="0,0,0,2"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="C">
                                                        <Setter Property="Background" Value="{StaticResource WarningSubtle}"/>
                                                        <Setter Property="BorderBrush" Value="{StaticResource Warning}"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="D">
                                                        <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                        <Setter Property="BorderBrush" Value="{StaticResource Danger}"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="F">
                                                        <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                        <Setter Property="BorderBrush" Value="{StaticResource Danger}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <!-- Grade badge -->
                                            <Border Grid.Column="0" Width="52" Height="52" CornerRadius="8" Margin="0,0,14,0" VerticalAlignment="Center">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Setter Property="Background" Value="{StaticResource Success}"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="C">
                                                                <Setter Property="Background" Value="{StaticResource Warning}"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="D">
                                                                <Setter Property="Background" Value="{StaticResource Danger}"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="F">
                                                                <Setter Property="Background" Value="{StaticResource Danger}"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <TextBlock Text="{Binding BulkSafetyGrade}" FontSize="26" FontWeight="Bold"
                                                           Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock FontSize="13" FontWeight="Bold">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="{StaticResource Success}"/>
                                                            <Setter Property="Text" Value="Bulk Safe"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="C">
                                                                    <Setter Property="Text" Value="Bulk Safety Concern"/>
                                                                    <Setter Property="Foreground" Value="{StaticResource Warning}"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="D">
                                                                    <Setter Property="Text" Value="Bulk Safety Risk"/>
                                                                    <Setter Property="Foreground" Value="{StaticResource Danger}"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding BulkSafetyGrade}" Value="F">
                                                                    <Setter Property="Text" Value="Not Bulk Safe"/>
                                                                    <Setter Property="Foreground" Value="{StaticResource Danger}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                                <TextBlock Text="{Binding BulkSafetyReason}" FontSize="11"
                                                           Foreground="{StaticResource TextSecondary}" Margin="0,3,0,0"
                                                           TextWrapping="Wrap"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- ===== GOVERNOR LIMITS PROGRESS BARS ===== -->
                                    <Border Background="{StaticResource BgInput}" CornerRadius="6" Padding="16" Margin="0,0,0,16">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <TextBlock Text="Resource Usage" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}"
                                                           VerticalAlignment="Center"
                                                           ToolTip="Salesforce limits how much each transaction can do (called 'Governor Limits'). These bars show how close you are to those limits."/>
                                                <!-- Async execution context badge — async transactions get 200 SOQL instead of 100 -->
                                                <Border CornerRadius="4" Padding="8,2" Margin="10,0,0,0" VerticalAlignment="Center"
                                                        Background="{StaticResource InfoSubtle}"
                                                        Visibility="{Binding IsAsyncExecution, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                        ToolTip="Async transactions (Batch, @future, Queueable, Scheduled) get higher governor limits — e.g. 200 SOQL instead of 100.">
                                                    <TextBlock Text="⚡ Async — Higher Limits" FontSize="10" FontWeight="Bold" Foreground="{StaticResource Info}"/>
                                                </Border>
                                            </StackPanel>
                                            
                                            <!-- SOQL Progress -->
                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="60"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="Reads" FontSize="12" Foreground="{StaticResource TextSecondary}" VerticalAlignment="Center" ToolTip="Database read operations (SOQL queries)"/>
                                                <Border Grid.Column="1" Background="{StaticResource BgSecondary}" CornerRadius="4" Height="20">
                                                    <Border CornerRadius="4" HorizontalAlignment="Left" 
                                                            Width="{Binding SoqlPercent, Converter={StaticResource PercentToWidthConverter}}">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="Background" Value="{StaticResource AccentPrimary}"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding SoqlPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Warning">
                                                                        <Setter Property="Background" Value="{StaticResource Warning}"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding SoqlPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Critical">
                                                                        <Setter Property="Background" Value="{StaticResource Danger}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                    </Border>
                                                </Border>
                                                <TextBlock Grid.Column="2" FontSize="11" Foreground="{StaticResource TextMuted}" VerticalAlignment="Center" HorizontalAlignment="Right">
                                                    <Run Text="{Binding StatSoqlCount, Mode=OneWay}"/><Run Text="/"/><Run Text="{Binding StatSoqlLimit, Mode=OneWay}"/>
                                                </TextBlock>
                                            </Grid>
                                            
                                            <!-- DML Progress -->
                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="60"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="Writes" FontSize="12" Foreground="{StaticResource TextSecondary}" VerticalAlignment="Center" ToolTip="Database write operations (DML - inserts, updates, deletes)"/>
                                                <Border Grid.Column="1" Background="{StaticResource BgSecondary}" CornerRadius="4" Height="20">
                                                    <Border CornerRadius="4" HorizontalAlignment="Left"
                                                            Width="{Binding DmlPercent, Converter={StaticResource PercentToWidthConverter}}">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="Background" Value="{StaticResource Warning}"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding DmlPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Warning">
                                                                        <Setter Property="Background" Value="{StaticResource Warning}"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding DmlPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Critical">
                                                                        <Setter Property="Background" Value="{StaticResource Danger}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                    </Border>
                                                </Border>
                                                <TextBlock Grid.Column="2" FontSize="11" Foreground="{StaticResource TextMuted}" VerticalAlignment="Center" HorizontalAlignment="Right">
                                                    <Run Text="{Binding StatDmlCount, Mode=OneWay}"/><Run Text="/"/><Run Text="{Binding StatDmlLimit, Mode=OneWay}"/>
                                                </TextBlock>
                                            </Grid>
                                            
                                            <!-- CPU Progress -->
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="80"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="CPU Time" FontSize="12" Foreground="{StaticResource TextSecondary}" VerticalAlignment="Center"/>
                                                <Border Grid.Column="1" Background="{StaticResource BgSecondary}" CornerRadius="4" Height="20">
                                                    <Border CornerRadius="4" HorizontalAlignment="Left"
                                                            Width="{Binding CpuPercent, Converter={StaticResource PercentToWidthConverter}}">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="Background" Value="{StaticResource Success}"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding CpuPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Warning">
                                                                        <Setter Property="Background" Value="{StaticResource Warning}"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding CpuPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Critical">
                                                                        <Setter Property="Background" Value="{StaticResource Danger}"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                    </Border>
                                                </Border>
                                                <TextBlock Grid.Column="2" FontSize="11" Foreground="{StaticResource TextMuted}" VerticalAlignment="Center" HorizontalAlignment="Right">
                                                    <Run Text="{Binding StatCpuTime, Mode=OneWay}"/><Run Text="ms / "/><Run Text="{Binding StatCpuLimit, Mode=OneWay}"/><Run Text="ms"/>
                                                </TextBlock>
                                            </Grid>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ===== TOP METHODS (always useful) ===== -->
                                    <Border Style="{StaticResource DiscordCard}" Padding="20" Margin="0,0,0,16"
                                            Visibility="{Binding HasTopMethods, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <TextBlock Text="?" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Where Time Was Spent" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                                <TextBlock Text="  (Top Methods)" FontSize="12" Foreground="{StaticResource TextMuted}" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <ItemsControl ItemsSource="{Binding TopMethods}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="6" Padding="12,10" Margin="0,0,0,6">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                
                                                                <!-- Method name -->
                                                                <TextBlock Grid.Column="0" Text="{Binding Name}" FontSize="13" FontFamily="Consolas" 
                                                                           Foreground="{StaticResource TextPrimary}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                                                
                                                                <!-- Call count badge -->
                                                                <Border Grid.Column="1" Background="{StaticResource BgHover}" CornerRadius="4" Padding="8,3" Margin="8,0">
                                                                    <TextBlock FontSize="11" Foreground="{StaticResource TextSecondary}" VerticalAlignment="Center">
                                                                        <Run Text="{Binding CallCount, Mode=OneWay}"/><Run Text="x calls"/>
                                                                    </TextBlock>
                                                                </Border>
                                                                
                                                                <!-- Avg time -->
                                                                <TextBlock Grid.Column="2" FontSize="11" Foreground="{StaticResource TextMuted}" VerticalAlignment="Center" Margin="0,0,12,0">
                                                                    <Run Text="avg "/><Run Text="{Binding AvgDisplay, Mode=OneWay}"/>
                                                                </TextBlock>
                                                                
                                                                <!-- Total time -->
                                                                <Border Grid.Column="3" CornerRadius="4" Padding="8,3" MinWidth="60" HorizontalAlignment="Right">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="{StaticResource AccentSubtle}"/>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock Text="{Binding TimeDisplay}" FontSize="12" FontWeight="SemiBold" 
                                                                               Foreground="{StaticResource AccentPrimary}" HorizontalAlignment="Center"/>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ===== TOP QUERIES (always useful) ===== -->
                                    <Border Style="{StaticResource DiscordCard}" Padding="20" Margin="0,0,0,16"
                                            Visibility="{Binding HasTopQueries, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <TextBlock Text="??" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Query Hotspots" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                                <TextBlock Text="  (Most Frequent Queries)" FontSize="12" Foreground="{StaticResource TextMuted}" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <ItemsControl ItemsSource="{Binding TopQueries}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="6" Padding="12,10" Margin="0,0,0,6">
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                </Grid.RowDefinitions>
                                                                
                                                                <!-- Header row: count + time + location -->
                                                                <Grid Grid.Row="0" Margin="0,0,0,6">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    
                                                                    <!-- Execution count badge -->
                                                                    <Border Grid.Column="0" CornerRadius="4" Padding="8,3" Margin="0,0,8,0">
                                                                        <Border.Style>
                                                                            <Style TargetType="Border">
                                                                                <Setter Property="Background" Value="{StaticResource AccentSubtle}"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding IsNPlusOne}" Value="True">
                                                                                        <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </Border.Style>
                                                                        <TextBlock FontSize="12" FontWeight="SemiBold">
                                                                            <TextBlock.Style>
                                                                                <Style TargetType="TextBlock">
                                                                                    <Setter Property="Foreground" Value="{StaticResource AccentPrimary}"/>
                                                                                    <Style.Triggers>
                                                                                        <DataTrigger Binding="{Binding IsNPlusOne}" Value="True">
                                                                                            <Setter Property="Foreground" Value="{StaticResource Danger}"/>
                                                                                        </DataTrigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </TextBlock.Style>
                                                                            <Run Text="{Binding CountBadge, Mode=OneWay}"/>
                                                                        </TextBlock>
                                                                    </Border>
                                                                    
                                                                    <!-- N+1 warning -->
                                                                    <TextBlock Grid.Column="1" Text="{Binding NPlusOneBadge}" FontSize="11" 
                                                                               Foreground="{StaticResource Danger}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                                    
                                                                    <!-- Location -->
                                                                    <TextBlock Grid.Column="2" Text="{Binding Location}" FontSize="11" 
                                                                               Foreground="{StaticResource TextMuted}" VerticalAlignment="Center" FontFamily="Consolas"/>
                                                                    
                                                                    <!-- Duration -->
                                                                    <TextBlock Grid.Column="3" Text="{Binding TimeDisplay}" FontSize="12" 
                                                                               Foreground="{StaticResource Warning}" VerticalAlignment="Center"/>
                                                                </Grid>
                                                                
                                                                <!-- Query text -->
                                                                <TextBlock Grid.Row="1" Text="{Binding Query}" FontSize="11" FontFamily="Consolas" 
                                                                           Foreground="{StaticResource TextMuted}" TextWrapping="Wrap" MaxHeight="40" TextTrimming="CharacterEllipsis"/>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ===== TIMING BREAKDOWN (when overhead is significant) ===== -->
                                    <Border Background="{StaticResource BgInput}" CornerRadius="6" Padding="16" Margin="0,0,0,16"
                                            Visibility="{Binding ShowTimingBreakdown, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <TextBlock Text="?? Timing Breakdown" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}" Margin="0,0,0,12"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding WallClockMs, StringFormat={}{0:N0}ms}" FontSize="18" FontWeight="Bold" Foreground="{StaticResource AccentPrimary}" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="Total Time" FontSize="10" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                                
                                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding CpuTimeMs, StringFormat={}{0:N0}ms}" FontSize="18" FontWeight="Bold" Foreground="{StaticResource Success}" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="Your Code (CPU)" FontSize="10" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                                
                                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding OverheadMs, StringFormat={}{0:N0}ms}" FontSize="18" FontWeight="Bold" Foreground="{StaticResource Warning}" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="SF Overhead" FontSize="10" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <!-- ===== RAW DETAILS (Collapsed by default - for advanced users) ===== -->
                                    <Expander IsExpanded="False" Margin="0,0,0,16"
                                              Visibility="{Binding Issues.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                        <Expander.Header>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="??" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Raw Technical Details" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextSecondary}" VerticalAlignment="Center"/>
                                                <TextBlock Text="(for developers)" FontSize="11" Foreground="{StaticResource TextMuted}" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                            </StackPanel>
                                        </Expander.Header>
                                        <StackPanel Margin="0,12,0,0">
                                            <!-- Issues -->
                                            <Border Background="{StaticResource BgInput}" CornerRadius="6" Padding="16" Margin="0,0,0,12">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                        <TextBlock Text="??" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                        <TextBlock Text="Issues Detected" FontSize="13" FontWeight="SemiBold" Foreground="{StaticResource Danger}" VerticalAlignment="Center"/>
                                                        <Border Background="{StaticResource Danger}" CornerRadius="10" Padding="8,2" Margin="8,0,0,0">
                                                            <TextBlock Text="{Binding Issues.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                        </Border>
                                                        <Button HorizontalAlignment="Right" 
                                                                Click="CopyIssues_Click"
                                                                Background="{StaticResource BgInput}" 
                                                                Foreground="{StaticResource TextSecondary}" 
                                                                BorderThickness="0" 
                                                                Padding="10,4" 
                                                                FontSize="12"
                                                                Cursor="Hand"
                                                                Margin="12,0,0,0"
                                                                ToolTip="Copy to clipboard">
                                                            <StackPanel Orientation="Horizontal">
                                                                <materialDesign:PackIcon Kind="ContentCopy" Width="14" Height="14" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                                                <TextBlock Text="Copy" VerticalAlignment="Center"/>
                                                            </StackPanel>
                                                        </Button>
                                                    </StackPanel>
                                                    <ItemsControl ItemsSource="{Binding Issues}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border CornerRadius="4" Padding="12" Margin="0,0,0,8">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="{StaticResource BgTertiary}"/>
                                                                            <Setter Property="BorderBrush" Value="{StaticResource BorderDefault}"/>
                                                                            <Setter Property="BorderThickness" Value="0,0,0,2"/>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock Text="{Binding}" TextWrapping="Wrap" FontSize="13" Foreground="{StaticResource TextSecondary}"/>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </Border>

                                            <!-- Recommendations -->
                                            <Border Background="{StaticResource BgInput}" CornerRadius="6" Padding="16"
                                                    Visibility="{Binding Recommendations.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                        <TextBlock Text="??" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                        <TextBlock Text="Recommendations" FontSize="13" FontWeight="SemiBold" Foreground="{StaticResource Success}" VerticalAlignment="Center"/>
                                                        <Border Background="{StaticResource Success}" CornerRadius="10" Padding="8,2" Margin="8,0,0,0">
                                                            <TextBlock Text="{Binding Recommendations.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                        </Border>
                                                        <Button Click="CopyRecommendations_Click"
                                                                Background="{StaticResource BgInput}" 
                                                                Foreground="{StaticResource TextSecondary}" 
                                                                BorderThickness="0" 
                                                                Padding="10,4" 
                                                                FontSize="12"
                                                                Cursor="Hand"
                                                                Margin="12,0,0,0"
                                                                ToolTip="Copy to clipboard">
                                                            <StackPanel Orientation="Horizontal">
                                                                <materialDesign:PackIcon Kind="ContentCopy" Width="14" Height="14" VerticalAlignment="Center" Margin="0,0,4,0"/>
                                                                <TextBlock Text="Copy" VerticalAlignment="Center"/>
                                                            </StackPanel>
                                                        </Button>
                                                    </StackPanel>
                                                    <ItemsControl ItemsSource="{Binding Recommendations}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border Background="{StaticResource BgSecondary}" CornerRadius="4" Padding="12" Margin="0,0,0,8"
                                                                        BorderBrush="{StaticResource SuccessSubtle}" BorderThickness="1">
                                                                    <TextBlock Text="{Binding}" TextWrapping="Wrap" FontSize="13" Foreground="{StaticResource TextSecondary}"/>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Expander>
                                    
                                </StackPanel>
                            </ScrollViewer>
                            
                            <!-- ===== EXPLAIN TAB (Index 4) — The Heart of Black Widow ===== -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,16"
                                          Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntEqualsToVisibilityConverter}, ConverterParameter=4}">
                                <StackPanel MaxWidth="900">
                                    
                                    <!-- SECTION 1: WHAT HAPPENED -->
                                    <Border CornerRadius="10" Padding="20" Margin="0,0,0,16"
                                            BorderThickness="0,2,0,0">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                <GradientStop Color="#1A1A2A" Offset="0"/>
                                                <GradientStop Color="#13131E" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                        <Border.BorderBrush>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                <GradientStop Color="#7C6AFF" Offset="0"/>
                                                <GradientStop Color="#7C6AFF40" Offset="0.5"/>
                                                <GradientStop Color="Transparent" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.BorderBrush>
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <TextBlock Text="📋" FontSize="20" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="What Happened" FontSize="18" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            
                                            <!-- Summary sentence -->
                                            <TextBlock Text="{Binding PlainEnglishSummary}" FontSize="14" Foreground="{StaticResource TextPrimary}" 
                                                       TextWrapping="Wrap" Margin="0,0,0,12" LineHeight="22"/>
                                            
                                            <!-- What Your Code Did (bullet list) -->
                                            <Border Background="{StaticResource BgPrimary}" CornerRadius="6" Padding="14" Margin="0,4,0,0"
                                                    Visibility="{Binding WhatYourCodeDid.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                <ItemsControl ItemsSource="{Binding WhatYourCodeDid}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <TextBlock Text="{Binding}" FontSize="13" Foreground="{StaticResource TextSecondary}" 
                                                                       TextWrapping="Wrap" Margin="0,3,0,3" LineHeight="20"/>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </Border>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- PERFORMANCE VERDICT -->
                                    <Border CornerRadius="10" Padding="16" Margin="0,0,0,16"
                                            BorderBrush="{StaticResource BorderDefault}" BorderThickness="1">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="{StaticResource BgTertiary}"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding CurrentExplanation.VerdictIcon}" Value="🔥">
                                                        <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                        <Setter Property="BorderBrush" Value="{StaticResource Danger}"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding CurrentExplanation.VerdictIcon}" Value="⚠️">
                                                        <Setter Property="Background" Value="{StaticResource WarningSubtle}"/>
                                                        <Setter Property="BorderBrush" Value="#F59E0B"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding CurrentExplanation.VerdictIcon}" Value="✅">
                                                        <Setter Property="Background" Value="{StaticResource SuccessSubtle}"/>
                                                        <Setter Property="BorderBrush" Value="{StaticResource Success}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="{Binding CurrentExplanation.VerdictIcon}" FontSize="20" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                            <TextBlock Text="{Binding CurrentExplanation.PerformanceVerdict}" FontSize="14" FontWeight="SemiBold" 
                                                       Foreground="White" TextWrapping="Wrap" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- SECTION 2: ISSUES FOUND (Deep explanations) -->
                                    <Border CornerRadius="10" Padding="20" Margin="0,0,0,16"
                                            BorderThickness="0,2,0,0"
                                            Visibility="{Binding HasDetailedIssues, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                <GradientStop Color="#1E1818" Offset="0"/>
                                                <GradientStop Color="#13131E" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                        <Border.BorderBrush>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                <GradientStop Color="#F85149" Offset="0"/>
                                                <GradientStop Color="#F8514940" Offset="0.5"/>
                                                <GradientStop Color="Transparent" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.BorderBrush>
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <TextBlock Text="🔍" FontSize="20" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Issues Found" FontSize="18" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                                                <Border Background="{StaticResource Danger}" CornerRadius="10" Padding="8,3" Margin="10,0,0,0" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding DetailedIssues.Count}" FontSize="11" FontWeight="Bold" Foreground="White"/>
                                                </Border>
                                            </StackPanel>
                                            
                                            <ItemsControl ItemsSource="{Binding DetailedIssues}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border CornerRadius="8" Padding="16" Margin="0,0,0,12"
                                                                BorderThickness="1,1,1,1">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Setter Property="Background" Value="{StaticResource BgPrimary}"/>
                                                                    <Setter Property="BorderBrush" Value="{StaticResource BorderDefault}"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Severity}" Value="Critical">
                                                                            <Setter Property="BorderBrush" Value="{StaticResource Danger}"/>
                                                                            <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Severity}" Value="High">
                                                                            <Setter Property="BorderBrush" Value="#F59E0B"/>
                                                                            <Setter Property="Background" Value="{StaticResource WarningSubtle}"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                            <StackPanel>
                                                                <!-- Issue title with severity badge -->
                                                                <Grid Margin="0,0,0,10">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Text="{Binding Icon}" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                                    <TextBlock Grid.Column="1" Text="{Binding Title}" FontSize="14" FontWeight="Bold" 
                                                                               Foreground="White" TextWrapping="Wrap" VerticalAlignment="Center"/>
                                                                    <Border Grid.Column="2" CornerRadius="4" Padding="8,3" VerticalAlignment="Center"
                                                                            Background="{Binding SeverityColor}">
                                                                        <TextBlock Text="{Binding Severity}" FontSize="10" FontWeight="Bold" Foreground="White"/>
                                                                    </Border>
                                                                </Grid>
                                                                
                                                                <!-- What this means -->
                                                                <TextBlock Text="{Binding WhatThisMeans}" FontSize="13" Foreground="{StaticResource TextSecondary}" 
                                                                           TextWrapping="Wrap" LineHeight="20" Margin="0,0,0,10"/>
                                                                
                                                                <!-- Analogy (the killer feature) -->
                                                                <Border Background="{StaticResource BgTertiary}" CornerRadius="6" Padding="12" Margin="0,0,0,10"
                                                                        BorderBrush="{StaticResource AccentSubtle}" BorderThickness="1,1,1,1">
                                                                    <StackPanel>
                                                                        <TextBlock Text="💡 Think of it this way:" FontSize="12" FontWeight="SemiBold" 
                                                                                   Foreground="{StaticResource AccentPrimary}" Margin="0,0,0,6"/>
                                                                        <TextBlock Text="{Binding Analogy}" FontSize="13" Foreground="{StaticResource TextPrimary}" 
                                                                                   TextWrapping="Wrap" LineHeight="20" FontStyle="Italic"/>
                                                                    </StackPanel>
                                                                </Border>
                                                                
                                                                <!-- Why it's bad -->
                                                                <TextBlock FontSize="12" Foreground="#F59E0B" TextWrapping="Wrap" LineHeight="20">
                                                                    <Run Text="⚠️ Impact: " FontWeight="SemiBold"/>
                                                                    <Run Text="{Binding WhyItsBad, Mode=OneWay}"/>
                                                                </TextBlock>
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ALL CLEAR (when no issues) -->
                                    <Border Background="{StaticResource SuccessSubtle}" CornerRadius="10" Padding="20" Margin="0,0,0,16"
                                            BorderBrush="{StaticResource Success}" BorderThickness="1"
                                            Visibility="{Binding IsAllClear, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="✅" FontSize="36" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock Text="Clean Bill of Health!" FontSize="18" FontWeight="Bold" 
                                                       Foreground="{StaticResource Success}" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock Text="No performance issues detected. Your code is efficient and well within Salesforce limits." 
                                                       FontSize="13" Foreground="{StaticResource TextSecondary}" TextWrapping="Wrap" TextAlignment="Center" MaxWidth="500"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- SECTION 3: RECOMMENDATIONS WITH CODE -->
                                    <Border Background="{StaticResource BgTertiary}" CornerRadius="10" Padding="20" Margin="0,0,0,16"
                                            BorderBrush="{StaticResource BorderDefault}" BorderThickness="1"
                                            Visibility="{Binding HasDetailedRecommendations, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <TextBlock Text="🛠️" FontSize="20" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="How To Fix It" FontSize="18" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            
                                            <ItemsControl ItemsSource="{Binding DetailedRecommendations}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgPrimary}" CornerRadius="8" Padding="16" Margin="0,0,0,16"
                                                                BorderBrush="{StaticResource SuccessSubtle}" BorderThickness="1">
                                                            <StackPanel>
                                                                <!-- Title and time estimate -->
                                                                <Grid Margin="0,0,0,10">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Text="{Binding Icon}" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                                    <TextBlock Grid.Column="1" Text="{Binding Title}" FontSize="14" FontWeight="Bold" 
                                                                               Foreground="White" TextWrapping="Wrap" VerticalAlignment="Center"/>
                                                                    <Border Grid.Column="2" Background="{StaticResource AccentPrimary}" CornerRadius="10" Padding="8,3" VerticalAlignment="Center">
                                                                        <TextBlock FontSize="10" Foreground="White" FontWeight="SemiBold">
                                                                            <Run Text="~"/>
                                                                            <Run Text="{Binding EstimatedMinutes, Mode=OneWay}"/>
                                                                            <Run Text="min"/>
                                                                        </TextBlock>
                                                                    </Border>
                                                                </Grid>
                                                                
                                                                <!-- Explanation -->
                                                                <TextBlock Text="{Binding Explanation}" FontSize="13" Foreground="{StaticResource TextSecondary}" 
                                                                           TextWrapping="Wrap" LineHeight="20" Margin="0,0,0,12"/>
                                                                
                                                                <!-- Before/After Code (side by side) -->
                                                                <Grid Margin="0,0,0,12" 
                                                                      Visibility="{Binding HasCodeExample, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="12"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    
                                                                    <!-- BEFORE -->
                                                                    <Border Grid.Column="0" Background="{StaticResource BgPrimary}" CornerRadius="6" 
                                                                            BorderBrush="{StaticResource DangerSubtle}" BorderThickness="1">
                                                                        <StackPanel>
                                                                            <Border Background="{StaticResource DangerSubtle}" CornerRadius="6,6,0,0" Padding="10,6">
                                                                                <TextBlock Text="{Binding CodeBeforeLabel}" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource Danger}"/>
                                                                            </Border>
                                                                            <TextBlock Text="{Binding CodeBefore}" FontSize="11" Foreground="{StaticResource TextSecondary}" 
                                                                                       FontFamily="Cascadia Code, Consolas, Courier New"
                                                                                       TextWrapping="Wrap" Padding="10,8" LineHeight="18"/>
                                                                        </StackPanel>
                                                                    </Border>
                                                                    
                                                                    <!-- AFTER -->
                                                                    <Border Grid.Column="2" Background="{StaticResource BgPrimary}" CornerRadius="6" 
                                                                            BorderBrush="{StaticResource SuccessSubtle}" BorderThickness="1">
                                                                        <StackPanel>
                                                                            <Border Background="{StaticResource SuccessSubtle}" CornerRadius="6,6,0,0" Padding="10,6">
                                                                                <TextBlock Text="{Binding CodeAfterLabel}" FontSize="11" FontWeight="SemiBold" Foreground="{StaticResource Success}"/>
                                                                            </Border>
                                                                            <TextBlock Text="{Binding CodeAfter}" FontSize="11" Foreground="{StaticResource TextSecondary}" 
                                                                                       FontFamily="Cascadia Code, Consolas, Courier New"
                                                                                       TextWrapping="Wrap" Padding="10,8" LineHeight="18"/>
                                                                        </StackPanel>
                                                                    </Border>
                                                                </Grid>
                                                                
                                                                <!-- Impact comparison -->
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <Border Background="{StaticResource DangerSubtle}" CornerRadius="6" Padding="10,8">
                                                                        <TextBlock Text="{Binding ImpactBefore}" FontSize="11" Foreground="{StaticResource Danger}" TextWrapping="Wrap" TextAlignment="Center"/>
                                                                    </Border>
                                                                    <TextBlock Grid.Column="1" Text="→" FontSize="18" Foreground="{StaticResource Success}" 
                                                                               VerticalAlignment="Center" Margin="8,0"/>
                                                                    <Border Grid.Column="2" Background="{StaticResource SuccessSubtle}" CornerRadius="6" Padding="10,8">
                                                                        <StackPanel HorizontalAlignment="Center">
                                                                            <TextBlock Text="{Binding ImpactAfter}" FontSize="11" Foreground="{StaticResource Success}" TextWrapping="Wrap" TextAlignment="Center"/>
                                                                            <TextBlock Text="{Binding SpeedImprovement}" FontSize="12" FontWeight="Bold" Foreground="{StaticResource Success}" 
                                                                                       TextAlignment="Center" Margin="0,2,0,0"/>
                                                                        </StackPanel>
                                                                    </Border>
                                                                </Grid>
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- SECTION 4: WHAT YOU LEARNED -->
                                    <Border Background="{StaticResource BgTertiary}" CornerRadius="10" Padding="20" Margin="0,0,0,16"
                                            BorderBrush="{StaticResource BorderDefault}" BorderThickness="1"
                                            Visibility="{Binding HasLearningItems, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <TextBlock Text="🎓" FontSize="20" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="What You Learned" FontSize="18" FontWeight="Bold" Foreground="White" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            
                                            <ItemsControl ItemsSource="{Binding LearningItems}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgPrimary}" CornerRadius="8" Padding="14" Margin="0,0,0,10"
                                                                BorderBrush="{StaticResource AccentSubtle}" BorderThickness="1">
                                                            <StackPanel>
                                                                <TextBlock Text="{Binding Concept}" FontSize="14" FontWeight="Bold" 
                                                                           Foreground="{StaticResource AccentPrimary}" Margin="0,0,0,6"/>
                                                                <TextBlock Text="{Binding Explanation}" FontSize="13" Foreground="{StaticResource TextSecondary}" 
                                                                           TextWrapping="Wrap" LineHeight="20" Margin="0,0,0,8"/>
                                                                <Button Background="Transparent" BorderThickness="0" Cursor="Hand" 
                                                                        HorizontalAlignment="Left" Padding="0"
                                                                        Visibility="{Binding ResourceUrl, Converter={StaticResource StringToVisibilityConverter}}">
                                                                    <TextBlock FontSize="12" Foreground="{StaticResource AccentPrimary}" TextDecorations="Underline">
                                                                        <Run Text="📚 "/>
                                                                        <Run Text="{Binding ResourceLabel, Mode=OneWay}"/>
                                                                    </TextBlock>
                                                                </Button>
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- OVERALL ASSESSMENT (bottom) -->
                                    <Border Background="{StaticResource BgTertiary}" CornerRadius="10" Padding="16" Margin="0,0,0,16"
                                            BorderBrush="{StaticResource BorderDefault}" BorderThickness="1"
                                            Visibility="{Binding HasExplanation, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <TextBlock Text="{Binding CurrentExplanation.OverallAssessment}" FontSize="13" Foreground="{StaticResource TextPrimary}" 
                                                       TextWrapping="Wrap" LineHeight="20" Margin="0,0,0,8"/>
                                            <StackPanel Orientation="Horizontal">
                                                <Border Background="{StaticResource AccentSubtle}" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                                                    <TextBlock Text="{Binding CurrentExplanation.Effort}" FontSize="11" Foreground="{StaticResource AccentPrimary}"/>
                                                </Border>
                                                <Border Background="{StaticResource SuccessSubtle}" CornerRadius="4" Padding="8,4">
                                                    <TextBlock Text="{Binding CurrentExplanation.ImpactSummary}" FontSize="11" Foreground="{StaticResource Success}"/>
                                                </Border>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                    
                                </StackPanel>
                            </ScrollViewer>
                            
                            <!-- Tree Tab (Index 1) -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,16"
                                          Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntEqualsToVisibilityConverter}, ConverterParameter=1}">
                                <StackPanel MaxWidth="900">
                                    <!-- Header -->
                                    <Border Background="{StaticResource BgInput}" BorderBrush="{StaticResource AccentPrimary}" BorderThickness="0,0,0,3" CornerRadius="6" Padding="16" Margin="0,0,0,12">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <TextBlock Text="??" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Execution Tree" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <TextBlock Text="Shows the hierarchy of code execution � what called what, and how long each piece took." 
                                                       FontSize="12" Foreground="{StaticResource TextMuted}" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- Tree Content -->
                                    <Border Visibility="{Binding HasExecutionTree, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <TreeView ItemsSource="{Binding ExecutionTreeNodes}" Background="Transparent" BorderThickness="0"
                                                  Foreground="{StaticResource TextPrimary}">
                                            <TreeView.Resources>
                                                <HierarchicalDataTemplate DataType="{x:Type viewmodels:TreeNodeViewModel}" 
                                                                          ItemsSource="{Binding Children}">
                                                    <Border Background="{StaticResource BgSecondary}" CornerRadius="4" Padding="10,6" Margin="0,2">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            
                                                            <!-- Type icon -->
                                                            <TextBlock Grid.Column="0" Text="{Binding TypeIcon}" FontSize="14" 
                                                                       VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                            
                                                            <!-- Name -->
                                                            <TextBlock Grid.Column="1" Text="{Binding Name}" FontSize="12" 
                                                                       Foreground="{StaticResource TextPrimary}" TextTrimming="CharacterEllipsis" 
                                                                       VerticalAlignment="Center" FontFamily="Consolas"/>
                                                            
                                                            <!-- Type badge -->
                                                            <Border Grid.Column="2" CornerRadius="3" Padding="6,2" Margin="8,0">
                                                                <Border.Style>
                                                                    <Style TargetType="Border">
                                                                        <Setter Property="Background" Value="{StaticResource BgHover}"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding TypeName}" Value="Soql">
                                                                                <Setter Property="Background" Value="{StaticResource AccentSubtle}"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding TypeName}" Value="Dml">
                                                                                <Setter Property="Background" Value="#F9731630"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding TypeName}" Value="Exception">
                                                                                <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Border.Style>
                                                                <TextBlock Text="{Binding TypeName}" FontSize="10" Foreground="{StaticResource TextSecondary}"/>
                                                            </Border>
                                                            
                                                            <!-- Duration -->
                                                            <TextBlock Grid.Column="3" Text="{Binding DurationDisplay}" FontSize="12" 
                                                                       FontWeight="SemiBold" VerticalAlignment="Center" MinWidth="50" TextAlignment="Right">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="Foreground" Value="{StaticResource TextMuted}"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding TypeName}" Value="Soql">
                                                                                <Setter Property="Foreground" Value="{StaticResource AccentPrimary}"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding TypeName}" Value="Dml">
                                                                                <Setter Property="Foreground" Value="{StaticResource Warning}"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>
                                                        </Grid>
                                                    </Border>
                                                </HierarchicalDataTemplate>
                                            </TreeView.Resources>
                                            <TreeView.ItemContainerStyle>
                                                <Style TargetType="TreeViewItem">
                                                    <Setter Property="IsExpanded" Value="{Binding IsExpanded}"/>
                                                    <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                                                    <Setter Property="FontSize" Value="12"/>
                                                </Style>
                                            </TreeView.ItemContainerStyle>
                                        </TreeView>
                                    </Border>
                                    
                                    <!-- Empty state -->
                                    <Border Background="{StaticResource BgInput}" CornerRadius="6" Padding="20" 
                                            Visibility="{Binding HasExecutionTree, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="??" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock Text="No execution tree data" FontSize="14" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center"/>
                                            <TextBlock Text="The log may be too short or didn't contain code unit events." 
                                                       FontSize="12" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                            
                            <!-- Timeline Tab (Index 2) -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,16"
                                          Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntEqualsToVisibilityConverter}, ConverterParameter=2}">
                                <StackPanel MaxWidth="900">
                                    <!-- Header -->
                                    <Border Background="{StaticResource BgInput}" BorderBrush="{StaticResource Warning}" BorderThickness="0,0,0,3" CornerRadius="6" Padding="16" Margin="0,0,0,12">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <TextBlock Text="??" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Execution Timeline" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <TextBlock Text="Every phase of execution in chronological order � triggers, flows, validations, DML, and async operations." 
                                                       FontSize="12" Foreground="{StaticResource TextMuted}" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- Timeline Content -->
                                    <Border Visibility="{Binding HasTimelineDetails, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <ItemsControl ItemsSource="{Binding TimelineDetails}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="{Binding IndentMargin}">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="4"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        
                                                        <!-- Colored timeline bar -->
                                                        <Border Grid.Column="0" CornerRadius="2" Margin="0,2">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Setter Property="Background" Value="{StaticResource AccentPrimary}"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Trigger">
                                                                            <Setter Property="Background" Value="#8B5CF6"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Flow">
                                                                            <Setter Property="Background" Value="#22D3EE"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Validation">
                                                                            <Setter Property="Background" Value="#F59E0B"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="DML">
                                                                            <Setter Property="Background" Value="#F97316"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Async">
                                                                            <Setter Property="Background" Value="#10B981"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                        </Border>
                                                        
                                                        <!-- Phase content -->
                                                        <Border Grid.Column="1" Background="{StaticResource BgSecondary}" CornerRadius="6" Padding="12,8" Margin="8,2,0,2">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>  <!-- Icon -->
                                                                    <ColumnDefinition Width="Auto"/>  <!-- Type badge -->
                                                                    <ColumnDefinition Width="Auto"/>  <!-- OOE badge -->
                                                                    <ColumnDefinition Width="*"/>     <!-- Name -->
                                                                    <ColumnDefinition Width="Auto"/>  <!-- Recursive -->
                                                                    <ColumnDefinition Width="Auto"/>  <!-- Duration -->
                                                                </Grid.ColumnDefinitions>
                                                                
                                                                <!-- Icon -->
                                                                <TextBlock Grid.Column="0" Text="{Binding Icon}" FontSize="14" 
                                                                           VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                                
                                                                <!-- Type badge -->
                                                                <Border Grid.Column="1" CornerRadius="3" Padding="6,2" Margin="0,0,8,0">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="{StaticResource BgHover}"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding Type}" Value="Trigger">
                                                                                    <Setter Property="Background" Value="#8B5CF630"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding Type}" Value="Flow">
                                                                                    <Setter Property="Background" Value="#22D3EE30"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding Type}" Value="Validation">
                                                                                    <Setter Property="Background" Value="#F59E0B30"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding Type}" Value="DML">
                                                                                    <Setter Property="Background" Value="#F9731630"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock Text="{Binding Type}" FontSize="10" FontWeight="SemiBold" Foreground="{StaticResource TextSecondary}"/>
                                                                </Border>

                                                                <!-- OOE Phase badge (only when phase is determinable) -->
                                                                <Border Grid.Column="2" CornerRadius="3" Padding="6,2" Margin="0,0,8,0"
                                                                        Background="{StaticResource AccentSubtle}"
                                                                        Visibility="{Binding HasOoePhaseLabel, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                    <TextBlock Text="{Binding OoePhaseLabel}" FontSize="9" FontWeight="Bold"
                                                                               Foreground="{StaticResource AccentPrimary}"/>
                                                                </Border>

                                                                <!-- Name -->
                                                                <TextBlock Grid.Column="3" Text="{Binding Name}" FontSize="12" 
                                                                           Foreground="{StaticResource TextPrimary}" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                                                
                                                                <!-- Recursive flag -->
                                                                <TextBlock Grid.Column="4" Text="?? Recursive" FontSize="10" Foreground="{StaticResource Warning}" 
                                                                           VerticalAlignment="Center" Margin="8,0"
                                                                           Visibility="{Binding IsRecursive, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                                
                                                                <!-- Duration + percent -->
                                                                <StackPanel Grid.Column="5" Orientation="Horizontal" VerticalAlignment="Center">
                                                                    <TextBlock Text="{Binding PercentDisplay}" FontSize="11" Foreground="{StaticResource TextMuted}" Margin="0,0,8,0"/>
                                                                    <Border Background="{StaticResource AccentSubtle}" CornerRadius="4" Padding="8,3" MinWidth="55">
                                                                        <TextBlock Text="{Binding DurationDisplay}" FontSize="12" FontWeight="SemiBold" 
                                                                                   Foreground="{StaticResource AccentPrimary}" HorizontalAlignment="Center"/>
                                                                    </Border>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Border>
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Border>
                                    
                                    <!-- Timeline legend -->
                                    <Border Background="{StaticResource BgInput}" CornerRadius="6" Padding="12" Margin="0,12,0,0"
                                            Visibility="{Binding HasTimelineDetails, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <WrapPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#8B5CF6" Margin="0,0,6,0"/>
                                                <TextBlock Text="Trigger" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#22D3EE" Margin="0,0,6,0"/>
                                                <TextBlock Text="Flow" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#F59E0B" Margin="0,0,6,0"/>
                                                <TextBlock Text="Validation" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#F97316" Margin="0,0,6,0"/>
                                                <TextBlock Text="DML" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#10B981" Margin="0,0,6,0"/>
                                                <TextBlock Text="Async" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="{StaticResource AccentPrimary}" Margin="0,0,6,0"/>
                                                <TextBlock Text="Other" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                            </StackPanel>
                                        </WrapPanel>
                                    </Border>
                                    
                                    <!-- Empty state -->
                                    <Border Background="{StaticResource BgInput}" CornerRadius="6" Padding="20" 
                                            Visibility="{Binding HasTimelineDetails, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="??" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock Text="No timeline data" FontSize="14" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center"/>
                                            <TextBlock Text="The log didn't contain enough execution phases to build a timeline." 
                                                       FontSize="12" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                            
                            <!-- Queries Tab (Index 3) -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,16"
                                          Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntEqualsToVisibilityConverter}, ConverterParameter=3}">
                                <StackPanel MaxWidth="800">
                                    <!-- Empty state when no database operations -->
                                    <Border Background="{StaticResource BgInput}" CornerRadius="6" Padding="20" Margin="0,0,0,12"
                                            Visibility="{Binding DatabaseOperations.Count, Converter={StaticResource ZeroToVisibilityConverter}}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="??" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock Text="No database operations" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextSecondary}" HorizontalAlignment="Center"/>
                                            <TextBlock Text="This log didn't contain any database reads (SOQL) or writes (DML)." 
                                                       FontSize="12" Foreground="{StaticResource TextMuted}" HorizontalAlignment="Center" Margin="0,4,0,0"
                                                       TextWrapping="Wrap" TextAlignment="Center"/>
                                            <TextBlock Text="That's actually great � it means this transaction is lightweight!" 
                                                       FontSize="11" Foreground="{StaticResource Success}" HorizontalAlignment="Center" Margin="0,8,0,0"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <Border Background="{StaticResource BgInput}" BorderBrush="{StaticResource Success}" BorderThickness="0,0,0,3" CornerRadius="6" Padding="16" Margin="0,0,0,12"
                                            Visibility="{Binding DatabaseOperations.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <TextBlock Text="??" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Database Operations" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                                <Border Background="{StaticResource AccentPrimary}" CornerRadius="10" Padding="8,2" Margin="12,0,0,0">
                                                    <TextBlock Text="{Binding DatabaseOperations.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                </Border>
                                            </StackPanel>
                                            <ItemsControl ItemsSource="{Binding DatabaseOperations}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="4" Padding="12" Margin="0,0,0,8">
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/><!-- Explain plan -->
                                                                </Grid.RowDefinitions>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                
                                                                <!-- Operation type badge -->
                                                                <Border Grid.Column="0" CornerRadius="3" Padding="6,2" Margin="0,0,8,0">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="{StaticResource AccentPrimary}"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding OperationType, Mode=OneWay}" Value="DML">
                                                                                    <Setter Property="Background" Value="{StaticResource Warning}"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock Text="{Binding OperationType, Mode=OneWay}" FontSize="10" FontWeight="Bold" Foreground="White"/>
                                                                </Border>
                                                                
                                                                <!-- Object name -->
                                                                <TextBlock Grid.Column="1" Text="{Binding ObjectType}" FontSize="13" FontWeight="SemiBold" Foreground="White"/>
                                                                
                                                                <!-- Duration -->
                                                                <TextBlock Grid.Column="2" FontSize="11" Foreground="{StaticResource TextMuted}">
                                                                    <Run Text="{Binding DurationMs, StringFormat={}{0:N0}}"/><Run Text="ms"/>
                                                                </TextBlock>
                                                                
                                                                <!-- Query/Statement -->
                                                                <TextBlock Grid.Row="1" Grid.ColumnSpan="3" Text="{Binding Query}" 
                                                                           TextWrapping="Wrap" FontSize="11" Foreground="{StaticResource TextSecondary}" 
                                                                           FontFamily="Consolas" Margin="0,6,0,0"
                                                                           MaxHeight="60" TextTrimming="CharacterEllipsis"/>
                                                                
                                                                <!-- Row count -->
                                                                <TextBlock Grid.Row="2" Grid.ColumnSpan="3" FontSize="10" Foreground="{StaticResource TextMuted}" Margin="0,4,0,0">
                                                                    <Run Text="{Binding RowsAffected}"/><Run Text=" rows"/>
                                                                </TextBlock>

                                                                <!-- SOQL Explain Plan (Row 3) — hidden when no plan available -->
                                                                <Grid Grid.Row="3" Grid.ColumnSpan="3" Margin="0,6,0,0"
                                                                      Visibility="{Binding ExecutionPlan, Converter={StaticResource StringToVisibilityConverter}}">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" FontSize="10" FontFamily="Consolas"
                                                                               Foreground="{StaticResource TextMuted}"
                                                                               TextTrimming="CharacterEllipsis">
                                                                        <Run Text="💡 " FontFamily="Segoe UI Emoji"/><Run Text="{Binding ExecutionPlan, Mode=OneWay}"/>
                                                                    </TextBlock>
                                                                    <!-- RelativeCost badge: red > 1.0, yellow 0.5-1.0, green below -->
                                                                    <Border Grid.Column="1" CornerRadius="3" Padding="6,2" Margin="8,0,0,0">
                                                                        <Border.Style>
                                                                            <Style TargetType="Border">
                                                                                <Setter Property="Background" Value="{StaticResource SuccessSubtle}"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding RelativeCost, Converter={StaticResource DoubleGreaterThanConverter}, ConverterParameter=1.0}" Value="True">
                                                                                        <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                                                    </DataTrigger>
                                                                                    <DataTrigger Binding="{Binding RelativeCost, Converter={StaticResource DoubleGreaterThanConverter}, ConverterParameter=0.5}" Value="True">
                                                                                        <Setter Property="Background" Value="{StaticResource WarningSubtle}"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </Border.Style>
                                                                        <TextBlock FontSize="10" FontWeight="SemiBold">
                                                                            <TextBlock.Style>
                                                                                <Style TargetType="TextBlock">
                                                                                    <Setter Property="Foreground" Value="{StaticResource Success}"/>
                                                                                    <Style.Triggers>
                                                                                        <DataTrigger Binding="{Binding RelativeCost, Converter={StaticResource DoubleGreaterThanConverter}, ConverterParameter=1.0}" Value="True">
                                                                                            <Setter Property="Foreground" Value="{StaticResource Danger}"/>
                                                                                        </DataTrigger>
                                                                                        <DataTrigger Binding="{Binding RelativeCost, Converter={StaticResource DoubleGreaterThanConverter}, ConverterParameter=0.5}" Value="True">
                                                                                            <Setter Property="Foreground" Value="{StaticResource Warning}"/>
                                                                                        </DataTrigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </TextBlock.Style>
                                                                            <Run Text="Cost: "/><Run Text="{Binding RelativeCost, StringFormat={}{0:N2}, Mode=OneWay}"/>
                                                                        </TextBlock>
                                                                    </Border>
                                                                </Grid>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>

                                    <!-- ===== ITEM 4: NAMESPACE COST CARDS ===== -->
                                    <Border Background="{StaticResource BgInput}" BorderBrush="{StaticResource BorderDefault}" BorderThickness="0,0,0,2"
                                            CornerRadius="6" Padding="16" Margin="0,0,0,12"
                                            Visibility="{Binding HasNamespaceLimits, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <TextBlock Text="📦" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Namespace Limit Usage" FontSize="15" FontWeight="SemiBold"
                                                           Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                                <Border Background="{StaticResource BgHover}" CornerRadius="10" Padding="8,2" Margin="10,0,0,0">
                                                    <TextBlock Text="{Binding NamespaceLimitItems.Count}" FontSize="11" Foreground="{StaticResource TextSecondary}" FontWeight="Bold"/>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="Managed packages (namespaces) each have their own governor limit bucket." 
                                                       FontSize="11" Foreground="{StaticResource TextMuted}" Margin="0,0,0,10" TextWrapping="Wrap"/>
                                            <ItemsControl ItemsSource="{Binding NamespaceLimitItems}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="6" Padding="12" Margin="0,0,0,8">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                <!-- Namespace name -->
                                                                <TextBlock Grid.Column="0" Text="{Binding Namespace}" FontSize="13" FontWeight="SemiBold"
                                                                           Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                                                <!-- SOQL pill -->
                                                                <Border Grid.Column="1" Background="{StaticResource AccentSubtle}" CornerRadius="4" Padding="8,3" Margin="8,0,0,0">
                                                                    <TextBlock FontSize="11" Foreground="{StaticResource AccentPrimary}" FontWeight="SemiBold">
                                                                        <Run Text="SOQL "/>
                                                                        <Run Text="{Binding SoqlQueries, Mode=OneWay}"/>
                                                                        <Run Text="/"/>
                                                                        <Run Text="{Binding SoqlQueriesLimit, Mode=OneWay}"/>
                                                                    </TextBlock>
                                                                </Border>
                                                                <!-- DML pill -->
                                                                <Border Grid.Column="2" Background="{StaticResource WarningSubtle}" CornerRadius="4" Padding="8,3" Margin="6,0,0,0">
                                                                    <TextBlock FontSize="11" Foreground="{StaticResource Warning}" FontWeight="SemiBold">
                                                                        <Run Text="DML "/>
                                                                        <Run Text="{Binding DmlStatements, Mode=OneWay}"/>
                                                                        <Run Text="/"/>
                                                                        <Run Text="{Binding DmlStatementsLimit, Mode=OneWay}"/>
                                                                    </TextBlock>
                                                                </Border>
                                                                <!-- CPU pill -->
                                                                <Border Grid.Column="3" Background="{StaticResource SuccessSubtle}" CornerRadius="4" Padding="8,3" Margin="6,0,0,0">
                                                                    <TextBlock FontSize="11" Foreground="{StaticResource Success}" FontWeight="SemiBold">
                                                                        <Run Text="CPU "/>
                                                                        <Run Text="{Binding CpuTime, Mode=OneWay}"/>
                                                                        <Run Text="ms"/>
                                                                    </TextBlock>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>

                                    <!-- ===== ITEM 5: FLOW FAULT RED-FLAG ALERT ===== -->
                                    <Border Background="{StaticResource DangerSubtle}" BorderBrush="{StaticResource Danger}" BorderThickness="0,0,0,3"
                                            CornerRadius="6" Padding="16" Margin="0,0,0,12"
                                            Visibility="{Binding HasFlowFaults, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <TextBlock Text="🔴" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Flow Fault Detected" FontSize="15" FontWeight="Bold"
                                                           Foreground="{StaticResource Danger}" VerticalAlignment="Center"/>
                                                <Border Background="{StaticResource Danger}" CornerRadius="10" Padding="8,2" Margin="10,0,0,0">
                                                    <TextBlock Text="{Binding FaultedFlows.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="One or more flows hit a FLOW_ELEMENT_FAULT — an unhandled error in the flow's fault path. This often means the flow has no fault connector configured."
                                                       FontSize="12" Foreground="{StaticResource Danger}" TextWrapping="Wrap" Margin="0,0,0,10"/>
                                            <ItemsControl ItemsSource="{Binding FaultedFlows}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="4" Padding="12" Margin="0,0,0,6">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                <StackPanel Grid.Column="0">
                                                                    <TextBlock Text="{Binding FlowName}" FontSize="13" FontWeight="SemiBold"
                                                                               Foreground="{StaticResource TextPrimary}"/>
                                                                    <TextBlock Text="{Binding FaultMessage}" FontSize="11" FontFamily="Consolas"
                                                                               Foreground="{StaticResource Danger}" TextWrapping="Wrap" Margin="0,4,0,0"/>
                                                                </StackPanel>
                                                                <Border Grid.Column="1" Background="{StaticResource Danger}" CornerRadius="4" Padding="8,3" VerticalAlignment="Top">
                                                                    <TextBlock Text="FAULT" FontSize="10" FontWeight="Bold" Foreground="White"/>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>

                                    <!-- ===== ITEM 2: PLATFORM EVENTS SECTION ===== -->
                                    <Border Background="{StaticResource BgInput}" BorderBrush="{StaticResource Info}" BorderThickness="0,0,0,2"
                                            CornerRadius="6" Padding="16" Margin="0,0,0,12"
                                            Visibility="{Binding HasPlatformEvents, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <TextBlock Text="📡" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Platform Events Published" FontSize="15" FontWeight="SemiBold"
                                                           Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                                <Border Background="{StaticResource Info}" CornerRadius="10" Padding="8,2" Margin="10,0,0,0">
                                                    <TextBlock Text="{Binding PlatformEventPublishes.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="EventBus.publish() calls captured during this transaction. Each event will trigger subscriber flows/Apex asynchronously."
                                                       FontSize="11" Foreground="{StaticResource TextMuted}" Margin="0,0,0,10" TextWrapping="Wrap"/>
                                            <ItemsControl ItemsSource="{Binding PlatformEventPublishes}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="4" Padding="12" Margin="0,0,0,6">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                <TextBlock Grid.Column="0" Text="📡" FontSize="14" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                                <TextBlock Grid.Column="1" Text="{Binding DisplayName}" FontSize="13" FontWeight="SemiBold"
                                                                           Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                                                <Border Grid.Column="2" CornerRadius="3" Padding="6,2" Margin="8,0,0,0"
                                                                        Background="{StaticResource SuccessSubtle}"
                                                                        Visibility="{Binding Completed, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                    <TextBlock Text="Sent" FontSize="10" FontWeight="Bold" Foreground="{StaticResource Success}"/>
                                                                </Border>
                                                                <Border Grid.Column="3" CornerRadius="3" Padding="6,2" Margin="6,0,0,0"
                                                                        Background="{StaticResource BgHover}">
                                                                    <TextBlock FontSize="10" Foreground="{StaticResource TextMuted}">
                                                                        <Run Text="{Binding DurationMs, StringFormat={}{0:N0}, Mode=OneWay}"/><Run Text="ms"/>
                                                                    </TextBlock>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>

                                    <!-- ===== ITEM 6: HTTP CALLOUTS ===== -->
                                    <Border Background="{StaticResource BgInput}" BorderBrush="{StaticResource AccentPrimary}" BorderThickness="0,0,0,2"
                                            CornerRadius="6" Padding="16" Margin="0,0,0,12"
                                            Visibility="{Binding HasCallouts, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <TextBlock Text="🌐" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="HTTP Callouts" FontSize="15" FontWeight="SemiBold"
                                                           Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                                <Border Background="{StaticResource AccentPrimary}" CornerRadius="10" Padding="8,2" Margin="10,0,0,0">
                                                    <TextBlock Text="{Binding Callouts.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="Outbound HTTP requests made during this transaction. Each callout consumes one of your 100 callout limit slots."
                                                       FontSize="11" Foreground="{StaticResource TextMuted}" Margin="0,0,0,10" TextWrapping="Wrap"/>
                                            <ItemsControl ItemsSource="{Binding Callouts}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="4" Padding="12" Margin="0,0,0,6">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                <!-- HTTP Method badge -->
                                                                <Border Grid.Column="0" CornerRadius="3" Padding="6,2" Margin="0,0,8,0"
                                                                        Background="{StaticResource BgHover}" VerticalAlignment="Center">
                                                                    <TextBlock Text="{Binding HttpMethod}" FontSize="10" FontWeight="Bold"
                                                                               Foreground="{StaticResource AccentPrimary}"/>
                                                                </Border>
                                                                <!-- Named Credential badge -->
                                                                <Border Grid.Column="1" CornerRadius="3" Padding="6,2" Margin="0,0,8,0"
                                                                        Background="{StaticResource SuccessSubtle}" VerticalAlignment="Center"
                                                                        Visibility="{Binding UsesNamedCredential, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                                        ToolTip="This callout uses a Named Credential — best practice for security.">
                                                                    <TextBlock Text="🔑 NC" FontSize="9" FontWeight="Bold" Foreground="{StaticResource Success}"/>
                                                                </Border>
                                                                <!-- Endpoint -->
                                                                <TextBlock Grid.Column="2" VerticalAlignment="Center"
                                                                           FontSize="12" Foreground="{StaticResource TextPrimary}"
                                                                           TextTrimming="CharacterEllipsis"
                                                                           ToolTip="{Binding Endpoint}">
                                                                    <Run Text="{Binding NamedCredentialName, Mode=OneWay}"/>
                                                                    <Run Text="{Binding Endpoint, Mode=OneWay}"/>
                                                                </TextBlock>
                                                                <!-- Status badge -->
                                                                <Border Grid.Column="3" CornerRadius="3" Padding="6,2" Margin="8,0,0,0" VerticalAlignment="Center">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="{StaticResource SuccessSubtle}"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding IsError}" Value="True">
                                                                                    <Setter Property="Background" Value="{StaticResource DangerSubtle}"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock FontSize="10" FontWeight="Bold">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Foreground" Value="{StaticResource Success}"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding IsError}" Value="True">
                                                                                        <Setter Property="Foreground" Value="{StaticResource Danger}"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                        <Run Text="{Binding StatusCode, Mode=OneWay}"/>
                                                                    </TextBlock>
                                                                </Border>
                                                                <!-- Duration -->
                                                                <Border Grid.Column="4" CornerRadius="3" Padding="6,2" Margin="6,0,0,0"
                                                                        Background="{StaticResource BgHover}" VerticalAlignment="Center">
                                                                    <TextBlock FontSize="10" Foreground="{StaticResource TextMuted}">
                                                                        <Run Text="{Binding DurationMs, StringFormat={}{0:N0}, Mode=OneWay}"/><Run Text="ms"/>
                                                                    </TextBlock>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>

                                    <!-- ===== ITEM 7: DUPLICATE QUERIES (N+1 PATTERNS) ===== -->
                                    <Border Background="{StaticResource BgInput}" BorderBrush="{StaticResource Warning}" BorderThickness="0,0,0,2"
                                            CornerRadius="6" Padding="16" Margin="0,0,0,12"
                                            Visibility="{Binding HasDuplicateQueries, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <TextBlock Text="🔁" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Duplicate SOQL Queries" FontSize="15" FontWeight="SemiBold"
                                                           Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                                <Border Background="{StaticResource Warning}" CornerRadius="10" Padding="8,2" Margin="10,0,0,0">
                                                    <TextBlock Text="{Binding DuplicateQueries.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="The same SOQL query ran more than once. This is often caused by an N+1 loop — each iteration queries individually instead of querying all records up front."
                                                       FontSize="11" Foreground="{StaticResource TextMuted}" Margin="0,0,0,10" TextWrapping="Wrap"/>
                                            <ItemsControl ItemsSource="{Binding DuplicateQueries}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="4" Padding="12" Margin="0,0,0,6">
                                                            <StackPanel>
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" Text="{Binding ExampleQuery}" FontSize="12"
                                                                               Foreground="{StaticResource TextPrimary}" TextTrimming="CharacterEllipsis"
                                                                               ToolTip="{Binding ExampleQuery}" VerticalAlignment="Center" FontFamily="Consolas"/>
                                                                    <!-- N+1 badge for high-frequency duplicates -->
                                                                    <Border Grid.Column="1" CornerRadius="3" Padding="6,2" Margin="8,0,0,0"
                                                                            Background="{StaticResource DangerSubtle}" VerticalAlignment="Center"
                                                                            Visibility="{Binding ExecutionCount, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}"
                                                                            ToolTip="This query ran many times — classic N+1 loop pattern.">
                                                                        <TextBlock Text="N+1" FontSize="9" FontWeight="Bold" Foreground="{StaticResource Danger}"/>
                                                                    </Border>
                                                                    <!-- Execution count -->
                                                                    <Border Grid.Column="2" CornerRadius="3" Padding="6,2" Margin="6,0,0,0"
                                                                            Background="{StaticResource WarningSubtle}" VerticalAlignment="Center">
                                                                        <TextBlock FontSize="10" FontWeight="Bold" Foreground="{StaticResource Warning}">
                                                                            <Run Text="×"/><Run Text="{Binding ExecutionCount, Mode=OneWay}"/>
                                                                        </TextBlock>
                                                                    </Border>
                                                                </Grid>
                                                                <TextBlock FontSize="10" Foreground="{StaticResource TextMuted}" Margin="0,4,0,0">
                                                                    <Run Text="{Binding TotalRows, Mode=OneWay}"/><Run Text=" total rows returned"/>
                                                                </TextBlock>
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>

                                    <!-- ===== ITEM 8: WORKFLOW RULES ===== -->
                                    <Border Background="{StaticResource BgInput}" BorderBrush="{StaticResource TextMuted}" BorderThickness="0,0,0,2"
                                            CornerRadius="6" Padding="16" Margin="0,0,0,12"
                                            Visibility="{Binding HasWorkflowRules, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <TextBlock Text="📋" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Workflow Rules Evaluated" FontSize="15" FontWeight="SemiBold"
                                                           Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center"/>
                                                <Border Background="{StaticResource BgHover}" CornerRadius="10" Padding="8,2" Margin="10,0,0,0">
                                                    <TextBlock Text="{Binding WorkflowRules.Count}" FontSize="11" Foreground="{StaticResource TextSecondary}" FontWeight="Bold"/>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="Classic Workflow Rules evaluated during this transaction. Note: Salesforce is retiring Workflow Rules — consider migrating to Flow."
                                                       FontSize="11" Foreground="{StaticResource TextMuted}" Margin="0,0,0,10" TextWrapping="Wrap"/>
                                            <ItemsControl ItemsSource="{Binding WorkflowRules}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="4" Padding="10,8" Margin="0,0,0,4">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                <TextBlock Grid.Column="0" Text="📋" FontSize="13" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                                    <TextBlock Text="{Binding RuleName}" FontSize="12" FontWeight="SemiBold"
                                                                               Foreground="{StaticResource TextPrimary}" TextTrimming="CharacterEllipsis"/>
                                                                    <TextBlock Text="{Binding ObjectType}" FontSize="10"
                                                                               Foreground="{StaticResource TextMuted}" Margin="0,2,0,0"/>
                                                                </StackPanel>
                                                                <!-- Matched badge -->
                                                                <Border Grid.Column="2" CornerRadius="3" Padding="6,2" Margin="8,0,0,0" VerticalAlignment="Center"
                                                                        Background="{StaticResource SuccessSubtle}"
                                                                        Visibility="{Binding Matched, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                    <TextBlock Text="Fired" FontSize="9" FontWeight="Bold" Foreground="{StaticResource Success}"/>
                                                                </Border>
                                                                <Border Grid.Column="3" CornerRadius="3" Padding="6,2" Margin="6,0,0,0" VerticalAlignment="Center"
                                                                        Background="{StaticResource BgHover}"
                                                                        Visibility="{Binding Matched, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                                                    <TextBlock Text="Skipped" FontSize="9" Foreground="{StaticResource TextMuted}"/>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>

                                    <!-- ===== ITEM 9: FLOW ERRORS (DML/VALIDATION FAILURES INSIDE FLOWS) ===== -->
                                    <Border Background="{StaticResource DangerSubtle}" BorderBrush="{StaticResource Danger}" BorderThickness="0,0,0,2"
                                            CornerRadius="6" Padding="16" Margin="0,0,0,12"
                                            Visibility="{Binding HasFlowErrors, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <TextBlock Text="💥" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Flow Errors" FontSize="15" FontWeight="Bold"
                                                           Foreground="{StaticResource Danger}" VerticalAlignment="Center"/>
                                                <Border Background="{StaticResource Danger}" CornerRadius="10" Padding="8,2" Margin="10,0,0,0">
                                                    <TextBlock Text="{Binding FlowErrors.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="DML or validation errors that occurred inside a Flow element. These cause the entire transaction to roll back unless the Flow has fault-path handling."
                                                       FontSize="11" Foreground="{StaticResource TextSecondary}" Margin="0,0,0,10" TextWrapping="Wrap"/>
                                            <ItemsControl ItemsSource="{Binding FlowErrors}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="{StaticResource BgSecondary}" CornerRadius="4" Padding="12" Margin="0,0,0,6">
                                                            <StackPanel>
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <StackPanel Grid.Column="0">
                                                                        <TextBlock FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource TextPrimary}">
                                                                            <Run Text="{Binding FlowName, Mode=OneWay}"/>
                                                                            <Run Text=" → "/><Run Text="{Binding ElementName, Mode=OneWay}"/>
                                                                        </TextBlock>
                                                                    </StackPanel>
                                                                    <Border Grid.Column="1" CornerRadius="3" Padding="6,2" Margin="8,0,0,0"
                                                                            Background="{StaticResource DangerSubtle}" VerticalAlignment="Center">
                                                                        <TextBlock Text="{Binding ErrorCode}" FontSize="9" FontWeight="Bold"
                                                                                   Foreground="{StaticResource Danger}" FontFamily="Consolas"/>
                                                                    </Border>
                                                                </Grid>
                                                                <TextBlock Text="{Binding ErrorMessage}" FontSize="11"
                                                                           Foreground="{StaticResource TextSecondary}" Margin="0,6,0,0"
                                                                           TextWrapping="Wrap"/>
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>

                                </StackPanel>
                            </ScrollViewer>
                        </Grid>
                    </Grid>

                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>

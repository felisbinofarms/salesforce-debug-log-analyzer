<Window x:Class="SalesforceDebugAnalyzer.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:helpers="clr-namespace:SalesforceDebugAnalyzer.Helpers"
        xmlns:viewmodels="clr-namespace:SalesforceDebugAnalyzer.ViewModels"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="Salesforce Debug Log Analyzer" 
        Height="900" 
        Width="1600"
        MinHeight="700"
        MinWidth="1200"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        WindowStyle="None"
        AllowsTransparency="False"
        ResizeMode="CanResize"
        Background="#313338"
        TextElement.Foreground="#DBDEE1"
        FontFamily="Segoe UI, Arial">
    
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="48"
                      ResizeBorderThickness="5"
                      GlassFrameThickness="0"
                      CornerRadius="8"
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>
    
    <Window.Resources>
        <helpers:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <helpers:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <helpers:IntEqualsToVisibilityConverter x:Key="IntEqualsToVisibilityConverter"/>
        <helpers:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <helpers:PercentToWidthConverter x:Key="PercentToWidthConverter"/>
        <helpers:PercentToSeverityConverter x:Key="PercentToSeverityConverter"/>
        <helpers:GreaterThanZeroConverter x:Key="GreaterThanZeroConverter"/>
        <helpers:GreaterThanZeroToVisibilityConverter x:Key="GreaterThanZeroToVisibilityConverter"/>
        <helpers:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
        <helpers:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <helpers:InverseNullToVisibilityConverter x:Key="InverseNullToVisibilityConverter"/>
        <helpers:ZeroToVisibilityConverter x:Key="ZeroToVisibilityConverter"/>
        <helpers:ArcPathConverter x:Key="ArcPathConverter"/>
        <helpers:HealthScoreToColorConverter x:Key="HealthScoreToColorConverter"/>
        
        <!-- Discord Card Style -->
        <Style x:Key="DiscordCard" TargetType="Border">
            <Setter Property="Background" Value="#2B2D31"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BorderBrush" Value="#3F4147"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <!-- Discord Primary Button -->
        <Style x:Key="DiscordPrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#5865F2"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4752C4"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#3C45A5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Discord Secondary Button -->
        <Style x:Key="DiscordSecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="#4E5058"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#5D5F67"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Pill CTA Button for links (e.g., open in VSCode) -->
        <Style x:Key="PillLinkButton" TargetType="Button">
            <Setter Property="Background" Value="#EB459E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="12" Padding="{TemplateBinding Padding}">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <ContentPresenter Margin="0,0,6,0"/>
                            </StackPanel>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF5EB8"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#D13F8A"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Discord CheckBox Style -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="#DBDEE1"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <Grid Background="Transparent">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Border x:Name="CheckBox" Width="18" Height="18" 
                                    Background="#383A40" BorderBrush="#5865F2" 
                                    BorderThickness="2" CornerRadius="3" Margin="0,0,8,0">
                                <Path x:Name="CheckMark" 
                                      Data="M 2,5 L 7,10 L 14,2" 
                                      Stroke="#5865F2" StrokeThickness="2"
                                      Visibility="Collapsed"/>
                            </Border>
                            <ContentPresenter Grid.Column="1" VerticalAlignment="Center"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="CheckBox" Property="Background" Value="#5865F2"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="CheckBox" Property="BorderBrush" Value="#4752C4"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid Background="#313338">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="72"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="48"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Custom Title Bar (48px) -->
        <Border Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" 
                Background="#2B2D31" 
                BorderBrush="#1E1F22" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="72"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- App Icon Area -->
                <Border Grid.Column="0" Background="#1E1F22">
                    <materialDesign:PackIcon Kind="Spider" Width="24" Height="24" 
                                             VerticalAlignment="Center" HorizontalAlignment="Center"
                                             Foreground="#ED4245"/>
                </Border>
                
                <!-- App Title -->
                <TextBlock Grid.Column="1" Text="Black Widow" 
                           FontSize="14" FontWeight="SemiBold" 
                           Foreground="#DBDEE1"
                           VerticalAlignment="Center"
                           Margin="16,0,0,0"/>
                
                <!-- VSCode Connection Status (next to title) -->
                <Border Grid.Column="1" HorizontalAlignment="Left" VerticalAlignment="Center"
                        Margin="120,0,0,0"
                        Background="#2B2D3130" CornerRadius="10" Padding="10,4"
                        ToolTip="VSCode Bridge: Click to install extension if not connected">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="6" Height="6" Margin="0,0,6,0">
                            <Ellipse.Style>
                                <Style TargetType="Ellipse">
                                    <Setter Property="Fill" Value="#72767D"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsEditorConnected}" Value="True">
                                            <Setter Property="Fill" Value="#57F287"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>
                        <TextBlock FontSize="11" Foreground="#B5BAC1">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="VSCode"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsEditorConnected}" Value="True">
                                            <Setter Property="Text" Value="VSCode ✓"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </StackPanel>
                </Border>
                
                <!-- Streaming Status Badge (Center) -->
                <Border Grid.Column="2" HorizontalAlignment="Center" VerticalAlignment="Center"
                        Background="#ED4245" CornerRadius="12" Padding="12,6"
                        Visibility="{Binding IsStreaming, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <Ellipse Width="8" Height="8" Fill="White" Margin="0,0,8,0">
                            <Ellipse.Style>
                                <Style TargetType="Ellipse">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                            <DataTrigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                         From="1" To="0.3" Duration="0:0:0.5"
                                                                         AutoReverse="True"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.EnterActions>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Ellipse.Style>
                        </Ellipse>
                        <TextBlock Text="{Binding StreamingStatus}" 
                                   Foreground="White" FontSize="12" FontWeight="SemiBold"/>
                    </StackPanel>
                </Border>
                
                <!-- Window Controls (Right) -->
                <StackPanel Grid.Column="3" Orientation="Horizontal" 
                            WindowChrome.IsHitTestVisibleInChrome="True">
                    <Button Click="MinimizeButton_Click" 
                            Width="48" Height="48"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                            Background="Transparent" BorderThickness="0">
                        <materialDesign:PackIcon Kind="WindowMinimize" 
                                                 Foreground="#B5BAC1" Width="16" Height="16"/>
                    </Button>
                    <Button Click="MaximizeButton_Click" 
                            Width="48" Height="48"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                            Background="Transparent" BorderThickness="0">
                        <materialDesign:PackIcon Kind="WindowMaximize" 
                                                 Foreground="#B5BAC1" Width="16" Height="16"/>
                    </Button>
                    <Button Click="CloseButton_Click" 
                            Width="48" Height="48"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                            Background="Transparent" BorderThickness="0">
                        <materialDesign:PackIcon Kind="Close" 
                                                 Foreground="#B5BAC1" Width="16" Height="16"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Left Sidebar (72px) -->
        <Border Grid.Row="1" Grid.Column="0" 
                Background="#1E1F22" 
                BorderBrush="#3F4147" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Navigation Buttons (Top) -->
                <StackPanel Grid.Row="0" Margin="0,8,0,0">
                    <!-- Home (Active) -->
                    <Button Width="56" Height="56" 
                            Background="#5865F2" 
                            BorderThickness="0"
                            Margin="8"
                            Cursor="Hand"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="16"/>
                            </Style>
                        </Button.Resources>
                        <materialDesign:PackIcon Kind="Home" 
                                                 Foreground="White" Width="24" Height="24"/>
                    </Button>
                    
                    <!-- Logs -->
                    <Button Width="56" Height="56" 
                            Background="#404249" 
                            BorderThickness="0"
                            Margin="8"
                            Cursor="Hand"
                            Command="{Binding ManageDebugLogsCommand}"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="16"/>
                            </Style>
                        </Button.Resources>
                        <materialDesign:PackIcon Kind="FileDocument" 
                                                 Foreground="#B5BAC1" Width="24" Height="24"/>
                    </Button>
                    
                    <!-- Upload -->
                    <Button Width="56" Height="56" 
                            Background="#404249" 
                            BorderThickness="0"
                            Margin="8"
                            Cursor="Hand"
                            Command="{Binding UploadLogCommand}"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"
                            ToolTip="Upload Log File">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="16"/>
                            </Style>
                        </Button.Resources>
                        <materialDesign:PackIcon Kind="Upload" 
                                                 Foreground="#B5BAC1" Width="24" Height="24"/>
                    </Button>
                    
                    <!-- Stream Logs (Live) -->
                    <Button Width="56" Height="56" 
                            BorderThickness="0"
                            Margin="8"
                            Cursor="Hand"
                            Command="{Binding ToggleStreamingCommand}"
                            ToolTip="Stream Live Logs">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="16"/>
                            </Style>
                        </Button.Resources>
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                                <Setter Property="Background" Value="#404249"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                        <Setter Property="Background" Value="#ED4245"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <Grid>
                            <materialDesign:PackIcon Kind="AccessPoint" 
                                                     Foreground="#B5BAC1" Width="24" Height="24">
                                <materialDesign:PackIcon.Style>
                                    <Style TargetType="materialDesign:PackIcon">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                                <Setter Property="Foreground" Value="White"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </materialDesign:PackIcon.Style>
                            </materialDesign:PackIcon>
                            <!-- Pulsing dot when streaming -->
                            <Ellipse Width="8" Height="8" Fill="#ED4245" 
                                     HorizontalAlignment="Right" VerticalAlignment="Top"
                                     Margin="0,-2,-2,0"
                                     Visibility="{Binding IsStreaming, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <Ellipse.Style>
                                    <Style TargetType="Ellipse">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                                <DataTrigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard RepeatBehavior="Forever">
                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                             From="1" To="0.3" Duration="0:0:0.5"
                                                                             AutoReverse="True"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </DataTrigger.EnterActions>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Ellipse.Style>
                            </Ellipse>
                        </Grid>
                    </Button>
                </StackPanel>
                
                <!-- Bottom Actions -->
                <StackPanel Grid.Row="1" Margin="0,0,0,8">
                    <!-- Export Report -->
                    <Button Width="56" Height="56" 
                            Background="#404249" 
                            BorderThickness="0"
                            Margin="8,4"
                            Cursor="Hand"
                            Command="{Binding ExportReportCommand}"
                            ToolTip="Export Report (PDF/JSON)"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="16"/>
                            </Style>
                        </Button.Resources>
                        <materialDesign:PackIcon Kind="FileExport" 
                                                 Foreground="#B5BAC1" Width="24" Height="24"/>
                    </Button>
                    
                    <!-- Settings -->
                    <Button Width="56" Height="56" 
                            Background="#404249" 
                            BorderThickness="0"
                            Margin="8,4"
                            Cursor="Hand"
                            Command="{Binding OpenSettingsCommand}"
                            ToolTip="Settings"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="16"/>
                            </Style>
                        </Button.Resources>
                        <materialDesign:PackIcon Kind="Cog" 
                                                 Foreground="#B5BAC1" Width="24" Height="24"/>
                    </Button>
                    
                    <!-- Disconnect -->
                    <Button Width="56" Height="56" 
                            Background="Transparent" 
                            BorderThickness="0"
                            Margin="8,4"
                            Cursor="Hand"
                            Command="{Binding DisconnectCommand}"
                            ToolTip="Disconnect"
                            Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="16"/>
                            </Style>
                        </Button.Resources>
                        <materialDesign:PackIcon Kind="Power" 
                                                 Foreground="#ED4245" Width="24" Height="24"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" Grid.Column="1" Background="Transparent" AllowDrop="True">
            <!-- Welcome/Connection View -->
            <ContentControl x:Name="ConnectionsViewContainer" Visibility="Visible"/>
            
            <!-- Main Dashboard View (when connected) -->
            <Grid x:Name="MainContentGrid" Visibility="Collapsed" Background="Transparent" AllowDrop="True">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="360" MinWidth="300" MaxWidth="450"/>
                    <ColumnDefinition Width="16"/>
                    <ColumnDefinition Width="*" MaxWidth="900"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel - Logs & Filters -->
                <Border Grid.Column="0" Style="{StaticResource DiscordCard}">
                    <Grid Margin="16">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header with action buttons -->
                        <Grid Grid.Row="0" Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Debug Logs" FontSize="18" FontWeight="Bold" 
                                       Foreground="White" VerticalAlignment="Center"/>
                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                <Button ToolTip="Open single log file" 
                                        Command="{Binding UploadLogCommand}"
                                        Width="32" Height="32" Padding="0" Margin="0,0,4,0"
                                        Background="#404249" BorderThickness="0">
                                    <materialDesign:PackIcon Kind="FileDocument" Width="16" Height="16" Foreground="White"/>
                                </Button>
                                <Button ToolTip="Load from folder" 
                                        Command="{Binding LoadLogFolderCommand}"
                                        Width="32" Height="32" Padding="0" Margin="0,0,4,0"
                                        Background="#404249" BorderThickness="0">
                                    <materialDesign:PackIcon Kind="FolderOpen" Width="16" Height="16" Foreground="White"/>
                                </Button>
                                <Button ToolTip="Download from org" 
                                        Command="{Binding LoadRecentLogsCommand}"
                                        Width="32" Height="32" Padding="0"
                                        Background="#404249" BorderThickness="0">
                                    <materialDesign:PackIcon Kind="CloudDownload" Width="16" Height="16" Foreground="White"/>
                                </Button>
                            </StackPanel>
                        </Grid>
                        
                        <!-- Quick Actions Bar -->
                        <Border Grid.Row="1" Background="#383A40" CornerRadius="6" Padding="8" Margin="0,0,0,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Button Content="📄 Upload File" Command="{Binding UploadLogCommand}"
                                        Background="Transparent" Foreground="#B5BAC1" BorderThickness="0"
                                        HorizontalAlignment="Stretch" Padding="8,6" FontSize="12"/>
                                <Button Grid.Column="1" Content="🔴 Stream Live" Command="{Binding ToggleStreamingCommand}"
                                        Background="Transparent" BorderThickness="0"
                                        HorizontalAlignment="Stretch" Padding="8,6" FontSize="12">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Foreground" Value="#B5BAC1"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                                    <Setter Property="Foreground" Value="#ED4245"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </Grid>
                        </Border>
                        
                        <!-- Search Box -->
                        <Border Background="#383A40" CornerRadius="6" Grid.Row="2" Margin="0,0,0,12">
                            <Grid>
                                <TextBox x:Name="SearchBox" Background="Transparent" BorderThickness="0" 
                                         Foreground="#DBDEE1" Padding="10,8"
                                         FontSize="13"
                                         TextChanged="SearchBox_TextChanged"/>
                                <TextBlock Text="🔍 Search logs..." 
                                           Foreground="#72767D" Padding="10,8" FontSize="13"
                                           IsHitTestVisible="False">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Text, ElementName=SearchBox}" Value="">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Grid>
                        </Border>
                        
                        <!-- Log List - Virtualized ListBox for performance -->
                        <ListBox Grid.Row="3" ItemsSource="{Binding Logs}" 
                                 SelectedItem="{Binding SelectedLog}"
                                 Background="Transparent" BorderThickness="0" Margin="0,0,0,8"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 VirtualizingStackPanel.VirtualizationMode="Recycling"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 HorizontalContentAlignment="Stretch">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="0"/>
                                    <Setter Property="Margin" Value="0"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <Border x:Name="ItemBorder" CornerRadius="6" 
                                                        Padding="12" Margin="0,0,0,8" Cursor="Hand"
                                                        Background="#383A40">
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                            <RowDefinition Height="Auto"/>
                                                        </Grid.RowDefinitions>
                                                        <TextBlock Text="{Binding LogName}" FontSize="13" 
                                                                   FontWeight="SemiBold" Foreground="White"
                                                                   TextTrimming="CharacterEllipsis"/>
                                                        <TextBlock Grid.Row="1" FontSize="11" 
                                                                   Foreground="#72767D" Margin="0,4,0,0">
                                                            <Run Text="{Binding DurationMs, StringFormat={}{0:N0}ms}"/>
                                                            <Run Text=" • "/>
                                                            <Run Text="{Binding LineCount}"/>
                                                            <Run Text=" lines"/>
                                                        </TextBlock>
                                                        <Border Grid.Row="2" CornerRadius="3" Padding="6,2" 
                                                                HorizontalAlignment="Left" Margin="0,6,0,0">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Setter Property="Background" Value="#3BA55D"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                            <Setter Property="Background" Value="#ED4245"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                            <TextBlock FontSize="9" FontWeight="Bold" Foreground="White">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="Text" Value="SUCCESS"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                                <Setter Property="Text" Value="ERROR"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>
                                                        </Border>
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter TargetName="ItemBorder" Property="Background" Value="#5865F2"/>
                                                    </Trigger>
                                                    <MultiTrigger>
                                                        <MultiTrigger.Conditions>
                                                            <Condition Property="IsMouseOver" Value="True"/>
                                                            <Condition Property="IsSelected" Value="False"/>
                                                        </MultiTrigger.Conditions>
                                                        <Setter TargetName="ItemBorder" Property="Background" Value="#404249"/>
                                                    </MultiTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>
                        
                        <!-- Empty state when no logs loaded -->
                        <Border Grid.Row="3" Background="#383A40" CornerRadius="8" Padding="20" Margin="0,0,0,8"
                                Visibility="{Binding Logs.Count, Converter={StaticResource ZeroToVisibilityConverter}}">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="📂" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                <TextBlock Text="No logs yet" FontSize="14" FontWeight="SemiBold" 
                                           Foreground="#B5BAC1" HorizontalAlignment="Center"/>
                                <TextBlock Text="Upload a .log file, load a folder, or stream live from your org" 
                                           FontSize="11" Foreground="#72767D" HorizontalAlignment="Center" 
                                           TextWrapping="Wrap" TextAlignment="Center" Margin="0,4,0,12"/>
                                <Button Content="📄 Upload Log File" Command="{Binding UploadLogCommand}"
                                        Background="#5865F2" Foreground="White" BorderThickness="0"
                                        Padding="16,8" FontSize="12" HorizontalAlignment="Center" Cursor="Hand"/>
                            </StackPanel>
                        </Border>

                        <Border Background="#383A40" CornerRadius="8" 
                                Grid.Row="4" Padding="12" Margin="0,8,0,0"
                                Visibility="{Binding IsStreaming, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}">
                            <StackPanel>
                                <TextBlock Text="🎯 Filters" FontSize="13" FontWeight="SemiBold" 
                                           Foreground="White" Margin="0,0,0,8"/>
                                <WrapPanel>
                                    <CheckBox Content="Reads (SOQL)" IsChecked="{Binding ShowSoqlOperations}" Foreground="#B5BAC1" Margin="0,2,12,2" FontSize="11" ToolTip="Database read operations (SOQL queries)"/>
                                    <CheckBox Content="Writes (DML)" IsChecked="{Binding ShowDmlOperations}" Foreground="#B5BAC1" Margin="0,2,12,2" FontSize="11" ToolTip="Database write operations (inserts, updates, deletes)"/>
                                    <CheckBox Content="Errors" IsChecked="{Binding ShowErrorsOnly}" Foreground="#B5BAC1" Margin="0,2,12,2" FontSize="11"/>
                                    <CheckBox Content="Debug" IsChecked="{Binding ShowDebugStatements}" Foreground="#B5BAC1" Margin="0,2,12,2" FontSize="11"/>
                                </WrapPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Live Streaming Panel (shown when streaming) -->
                        <Border Background="#1E1F22" CornerRadius="8" 
                                Grid.Row="4" Padding="12" Margin="0,8,0,0"
                                Visibility="{Binding IsStreaming, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Header -->
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                    <Ellipse Width="10" Height="10" Fill="#ED4245" Margin="0,0,8,0">
                                        <Ellipse.Style>
                                            <Style TargetType="Ellipse">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                                        <DataTrigger.EnterActions>
                                                            <BeginStoryboard>
                                                                <Storyboard RepeatBehavior="Forever">
                                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                     From="1" To="0.3" Duration="0:0:0.5"
                                                                                     AutoReverse="True"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </DataTrigger.EnterActions>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Ellipse.Style>
                                    </Ellipse>
                                    <TextBlock Text="🕷️ Live Stream" FontSize="14" FontWeight="SemiBold" 
                                               Foreground="#ED4245"/>
                                </StackPanel>
                                
                                <!-- Stream Output -->
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" MaxHeight="200">
                                    <ItemsControl ItemsSource="{Binding StreamingLogs}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Margin="0,4" CornerRadius="4" Cursor="Hand">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Background" Value="#2B2D31"/>
                                                            <Setter Property="Padding" Value="8"/>
                                                            <Style.Triggers>
                                                                <!-- Log entries with Analysis (actual logs) -->
                                                                <DataTrigger Binding="{Binding Analysis, Converter={StaticResource NullToVisibilityConverter}}" Value="Visible">
                                                                    <Setter Property="Background" Value="#383A40"/>
                                                                </DataTrigger>
                                                                <!-- Status messages (no Analysis) -->
                                                                <DataTrigger Binding="{Binding Analysis}" Value="{x:Null}">
                                                                    <Setter Property="Padding" Value="4,2"/>
                                                                    <Setter Property="Background" Value="Transparent"/>
                                                                </DataTrigger>
                                                                <!-- Error messages -->
                                                                <DataTrigger Binding="{Binding IsError}" Value="True">
                                                                    <Setter Property="Background" Value="#3D2527"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    
                                                    <Grid>
                                                        <!-- Rich Log Card (when Analysis exists) -->
                                                        <Grid Visibility="{Binding Analysis, Converter={StaticResource NullToVisibilityConverter}}">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            
                                                            <StackPanel>
                                                                <!-- Log ID and Timestamp -->
                                                                <Grid Margin="0,0,0,4">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Text="{Binding LogId}" FontWeight="SemiBold" 
                                                                               FontSize="11" Foreground="White"/>
                                                                    <TextBlock Grid.Column="1" FontSize="9" Foreground="#72767D" 
                                                                               HorizontalAlignment="Right" VerticalAlignment="Center">
                                                                        <Run Text="{Binding Timestamp, StringFormat=h:mm:ss tt}"/>
                                                                    </TextBlock>
                                                                </Grid>
                                                                
                                                                <!-- Operation Type and User -->
                                                                <TextBlock FontSize="10" Foreground="#B5BAC1" Margin="0,0,0,2">
                                                                    <Run Text="{Binding OperationType}" FontWeight="SemiBold"/>
                                                                    <Run Text=" by " Foreground="#72767D"/>
                                                                    <Run Text="{Binding User}" Foreground="#5865F2"/>
                                                                </TextBlock>
                                                                
                                                                <!-- Plain English Insight (NEW!) -->
                                                                <TextBlock FontSize="10" Foreground="White" Margin="0,4,0,2" 
                                                                           FontWeight="SemiBold" TextWrapping="Wrap">
                                                                    <Run Text="{Binding InsightIcon}"/>
                                                                    <Run Text=" "/>
                                                                    <Run Text="{Binding Insight}"/>
                                                                </TextBlock>
                                                                
                                                                <!-- Duration and Lines -->
                                                                <TextBlock FontSize="9" Foreground="#72767D">
                                                                    <Run Text="{Binding Duration}"/>
                                                                    <Run Text=" • "/>
                                                                    <Run Text="{Binding LineCount}"/>
                                                                    <Run Text=" lines"/>
                                                                </TextBlock>
                                                            </StackPanel>
                                                            
                                                            <!-- Status Badge -->
                                                            <Border Grid.Column="1" CornerRadius="3" Padding="6,2" 
                                                                    VerticalAlignment="Top" Margin="8,0,0,0">
                                                                <Border.Style>
                                                                    <Style TargetType="Border">
                                                                        <Setter Property="Background" Value="#3BA55D"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsError}" Value="True">
                                                                                <Setter Property="Background" Value="#ED4245"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Border.Style>
                                                                <TextBlock Text="{Binding Status}" FontSize="9" 
                                                                           FontWeight="Bold" Foreground="White"/>
                                                            </Border>
                                                        </Grid>
                                                        
                                                        <!-- Simple Status Message (no Analysis) -->
                                                        <StackPanel Visibility="{Binding Analysis, Converter={StaticResource InverseNullToVisibilityConverter}}">
                                                            <TextBlock FontSize="10" Foreground="#72767D">
                                                                <Run Text="["/><Run Text="{Binding Timestamp, StringFormat=HH:mm:ss}"/><Run Text="]"/>
                                                            </TextBlock>
                                                            <TextBlock Text="{Binding Message}" TextWrapping="Wrap" FontSize="11">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="Foreground" Value="#B5BAC1"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding IsError}" Value="True">
                                                                                <Setter Property="Foreground" Value="#ED4245"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>
                                                        </StackPanel>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                                
                                <!-- Recording/Stop Buttons -->
                                <Grid Grid.Row="2" Margin="0,12,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Start Recording Button (when not recording) -->
                                    <Button Grid.Column="0" Content="🔴 Record Interaction" 
                                            Command="{Binding StartRecordingCommand}"
                                            Style="{StaticResource DiscordPrimaryButton}"
                                            Visibility="{Binding IsRecording, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                                    
                                    <!-- Stop Recording Button (when recording) -->
                                    <Button Grid.Column="0" 
                                            Command="{Binding StopRecordingAsyncCommand}"
                                            Style="{StaticResource DiscordPrimaryButton}"
                                            Background="#ED4245"
                                            Visibility="{Binding IsRecording, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel Orientation="Horizontal">
                                            <Ellipse Width="8" Height="8" Fill="White" Margin="0,0,8,0">
                                                <Ellipse.Style>
                                                    <Style TargetType="Ellipse">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsRecording}" Value="True">
                                                                <DataTrigger.EnterActions>
                                                                    <BeginStoryboard>
                                                                        <Storyboard RepeatBehavior="Forever">
                                                                            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                                             From="1" To="0.3" Duration="0:0:0.5"
                                                                                             AutoReverse="True"/>
                                                                        </Storyboard>
                                                                    </BeginStoryboard>
                                                                </DataTrigger.EnterActions>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Ellipse.Style>
                                            </Ellipse>
                                            <TextBlock Text="⏹ Stop Recording"/>
                                            <TextBlock Text="{Binding RecordingElapsedTime}" Margin="8,0,0,0" Opacity="0.8"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <!-- Stop Streaming Button -->
                                    <Button Grid.Column="2" Content="⏹ Stop Streaming" 
                                            Command="{Binding ToggleStreamingCommand}"
                                            Style="{StaticResource DiscordSecondaryButton}"
                                            IsEnabled="{Binding IsRecording, Converter={StaticResource InverseBooleanConverter}}"/>
                                </Grid>
                                
                                <!-- Recorded Interactions List -->
                                <Border Grid.Row="3" Background="#383A40" CornerRadius="6" 
                                        Margin="0,12,0,0" Padding="8"
                                        Visibility="{Binding Interactions.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        <TextBlock Text="🎬 Recorded Interactions" FontSize="12" FontWeight="SemiBold" 
                                                   Foreground="#B5BAC1" Margin="0,0,0,8"/>
                                        <ScrollViewer Grid.Row="1" MaxHeight="150" VerticalScrollBarVisibility="Auto">
                                            <ItemsControl ItemsSource="{Binding Interactions}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="#2B2D31" CornerRadius="4" 
                                                                Padding="8" Margin="0,0,0,4" Cursor="Hand"
                                                                MouseLeftButtonUp="InteractionCard_Click">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                <StackPanel>
                                                                    <TextBlock Text="{Binding Name}" FontSize="12" 
                                                                               FontWeight="SemiBold" Foreground="White"/>
                                                                    <TextBlock Text="{Binding Summary}" FontSize="10" 
                                                                               Foreground="#72767D" Margin="0,2,0,0"/>
                                                                </StackPanel>
                                                                <Border Grid.Column="1" CornerRadius="3" Padding="6,2" 
                                                                        VerticalAlignment="Center">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="#3BA55D"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                                    <Setter Property="Background" Value="#ED4245"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock FontSize="9" FontWeight="Bold" Foreground="White">
                                                                        <TextBlock.Style>
                                                                            <Style TargetType="TextBlock">
                                                                                <Setter Property="Text" Value="OK"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding HasErrors}" Value="True">
                                                                                        <Setter Property="Text" Value="ERROR"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </TextBlock.Style>
                                                                    </TextBlock>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>

                <!-- Spacer -->
                <Grid Grid.Column="1"/>

                <!-- Right Content - Analysis with Tabs -->
                <Border Grid.Column="2" Style="{StaticResource DiscordCard}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Tab Headers -->
                        <Border Grid.Row="0" Background="{StaticResource BgSecondary}" BorderBrush="{StaticResource SidebarBorder}" BorderThickness="0,0,0,1" Padding="16,12">
                            <WrapPanel>
                                <Button Content="📝 Summary" Padding="12,8" Margin="0,0,6,0" 
                                        Command="{Binding SelectTabCommand}"
                                        Foreground="{StaticResource TextPrimary}" BorderThickness="0" FontSize="{StaticResource FontBaseline}" FontWeight="SemiBold" Cursor="Hand">
                                    <Button.CommandParameter>
                                        <sys:Int32>0</sys:Int32>
                                    </Button.CommandParameter>
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource DiscordPrimaryButton}">
                                            <Setter Property="Background" Value="{StaticResource BgTertiary}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding SelectedTabIndex}" Value="0">
                                                    <Setter Property="Background" Value="{StaticResource AccentPrimary}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                <Button Content="🌳 Tree" Padding="12,8" Margin="0,0,6,0" 
                                        Command="{Binding SelectTabCommand}"
                                        Foreground="{StaticResource TextSecondary}" BorderThickness="0" FontSize="{StaticResource FontBaseline}" Cursor="Hand">
                                    <Button.CommandParameter>
                                        <sys:Int32>1</sys:Int32>
                                    </Button.CommandParameter>
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource DiscordSecondaryButton}">
                                            <Setter Property="Background" Value="{StaticResource BgTertiary}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding SelectedTabIndex}" Value="1">
                                                    <Setter Property="Background" Value="{StaticResource AccentPrimary}"/>
                                                    <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                <Button Content="⏱️ Timeline" Padding="12,8" Margin="0,0,6,0" 
                                        Command="{Binding SelectTabCommand}"
                                        Foreground="{StaticResource TextSecondary}" BorderThickness="0" FontSize="{StaticResource FontBaseline}" Cursor="Hand">
                                    <Button.CommandParameter>
                                        <sys:Int32>2</sys:Int32>
                                    </Button.CommandParameter>
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource DiscordSecondaryButton}">
                                            <Setter Property="Background" Value="{StaticResource BgTertiary}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding SelectedTabIndex}" Value="2">
                                                    <Setter Property="Background" Value="{StaticResource AccentPrimary}"/>
                                                    <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                <Button Content="💾 Queries" Padding="12,8" Margin="0,0,6,0" 
                                        Command="{Binding SelectTabCommand}"
                                        Foreground="{StaticResource TextSecondary}" BorderThickness="0" FontSize="{StaticResource FontBaseline}" Cursor="Hand">
                                    <Button.CommandParameter>
                                        <sys:Int32>3</sys:Int32>
                                    </Button.CommandParameter>
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource DiscordSecondaryButton}">
                                            <Setter Property="Background" Value="{StaticResource BgTertiary}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding SelectedTabIndex}" Value="3">
                                                    <Setter Property="Background" Value="{StaticResource AccentPrimary}"/>
                                                    <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </WrapPanel>
                        </Border>
                        
                        <!-- Tab Content -->
                        <Grid Grid.Row="1">
                            <!-- "No log selected" empty state overlay -->
                            <Border Background="{StaticResource BgSecondary}" 
                                    Visibility="{Binding SelectedLog, Converter={StaticResource InverseNullToVisibilityConverter}}"
                                    Panel.ZIndex="10">
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" MaxWidth="400">
                                    <TextBlock Text="🕷️" FontSize="48" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                                    <TextBlock Text="Select a log to analyze" FontSize="18" FontWeight="Bold" 
                                               Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                    <TextBlock TextWrapping="Wrap" TextAlignment="Center" FontSize="13" 
                                               Foreground="#72767D" Margin="0,0,0,20">
                                        Upload a debug log file, load from a folder, or download from your Salesforce org. 
                                        Then click a log from the list to see the full analysis.
                                    </TextBlock>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <Button Content="📄 Upload File" Command="{Binding UploadLogCommand}"
                                                Background="#5865F2" Foreground="White" BorderThickness="0"
                                                Padding="16,8" FontSize="12" Cursor="Hand" Margin="0,0,8,0"/>
                                        <Button Content="📁 Load Folder" Command="{Binding LoadLogFolderCommand}"
                                                Background="#404249" Foreground="#B5BAC1" BorderThickness="0"
                                                Padding="16,8" FontSize="12" Cursor="Hand"/>
                                    </StackPanel>
                                    <TextBlock Text="or drag &amp; drop a .log file anywhere" FontSize="11" 
                                               Foreground="#4E5058" HorizontalAlignment="Center" Margin="0,12,0,0"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Summary Tab (Index 0) - VISUAL DASHBOARD -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,16"
                                          Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntEqualsToVisibilityConverter}, ConverterParameter=0}">
                                <StackPanel MaxWidth="900">
                                    
                                    <!-- ===== HERO STATUS BANNER (Modern) ===== -->
                                    <Border CornerRadius="12" Margin="0,0,0,16" Padding="20">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                            <GradientStop Color="#6E5AE6" Offset="0"/>
                                                            <GradientStop Color="#EA3C7E" Offset="0.6"/>
                                                            <GradientStop Color="#F59E0B" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HeroStatus}" Value="FAILED">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                    <GradientStop Color="#DC2626" Offset="0"/>
                                                                    <GradientStop Color="#991B1B" Offset="0.6"/>
                                                                    <GradientStop Color="#7F1D1D" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding HeroStatus}" Value="SUCCESS">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                    <GradientStop Color="#059669" Offset="0"/>
                                                                    <GradientStop Color="#047857" Offset="0.5"/>
                                                                    <GradientStop Color="#065F46" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding HeroStatus}" Value="WARNING">
                                                        <Setter Property="Background">
                                                            <Setter.Value>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                    <GradientStop Color="#D97706" Offset="0"/>
                                                                    <GradientStop Color="#B45309" Offset="0.6"/>
                                                                    <GradientStop Color="#92400E" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Status Icon with glow -->
                                            <Border Grid.Column="0" Width="60" Height="60" CornerRadius="30" Background="#1A1A1A40" Margin="0,0,16,0">
                                                <TextBlock FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="✓"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="WARNING">
                                                                    <Setter Property="Text" Value="⚠"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="FAILED">
                                                                    <Setter Property="Text" Value="✗"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="TEST">
                                                                    <Setter Property="Text" Value="🧪"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Border>

                                            <!-- Status Text + Entry -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock FontSize="20" FontWeight="Bold" Foreground="White">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="Transaction Completed"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="WARNING">
                                                                    <Setter Property="Text" Value="Completed with Warnings"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="FAILED">
                                                                    <Setter Property="Text" Value="Transaction Failed"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding HeroStatus}" Value="TEST">
                                                                    <Setter Property="Text" Value="Test Execution"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                                <TextBlock Text="{Binding HeroEntryPoint}" FontSize="13" Foreground="#FFFFFFCC"
                                                           Visibility="{Binding HeroEntryPoint, Converter={StaticResource StringToVisibilityConverter}}"/>
                                                <StackPanel Orientation="Horizontal">
                                                    <Border Background="#FFFFFF30" CornerRadius="10" Padding="10,4" Margin="0,0,8,0">
                                                        <TextBlock Text="Live Analysis" FontSize="11" Foreground="White"/>
                                                    </Border>
                                                    <Border Background="#00000030" CornerRadius="10" Padding="10,4" Margin="0,0,8,0">
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <TextBlock Text="❌" FontSize="11"/>
                                                            <TextBlock Text="{Binding StatErrorCount}" FontSize="11" Foreground="White" Margin="6,0,0,0"/>
                                                            <TextBlock Text="errors" FontSize="11" Foreground="#FFFFFFCC"/>
                                                        </StackPanel>
                                                    </Border>
                                                    <Border Background="#00000030" CornerRadius="10" Padding="10,4">
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                            <TextBlock Text="⚠️" FontSize="11"/>
                                                            <TextBlock Text="{Binding StatWarningCount}" FontSize="11" Foreground="White" Margin="6,0,0,0"/>
                                                            <TextBlock Text="warnings" FontSize="11" Foreground="#FFFFFFCC"/>
                                                        </StackPanel>
                                                    </Border>
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- Duration Badge -->
                                            <Border Grid.Column="2" Background="#1A1A1A55" CornerRadius="10" Padding="16,10" VerticalAlignment="Center">
                                                <StackPanel HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding HeroDuration}" FontSize="26" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="Total Duration" FontSize="11" Foreground="#FFFFFFAA" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Border>
                                        </Grid>
                                    </Border>
                                    
                                    <!-- ===== TIMELINE STRIP ===== -->
                                    <StackPanel Margin="0,0,0,16"
                                                Visibility="{Binding HasTimelineData, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Order of Execution" FontSize="18" FontWeight="SemiBold"/>
                                            <TextBlock Grid.Column="1" FontSize="12" Foreground="#80848E" VerticalAlignment="Center">
                                                <Run Text="Total "/>
                                                <Run Text="{Binding TimelineTotalDurationMs, StringFormat={}{0:N0}ms}"/>
                                            </TextBlock>
                                        </Grid>

                                        <Border Background="#2B2D31" CornerRadius="10" Padding="8" BorderBrush="#3F4147" BorderThickness="1">
                                            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Hidden">
                                                <ItemsControl ItemsSource="{Binding TimelineSegments}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <StackPanel Orientation="Horizontal"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Margin="4,4,4,4" Padding="10,6" CornerRadius="8"
                                                                    Width="{Binding Percent, Converter={StaticResource PercentToWidthConverter}}"
                                                                    ToolTip="{Binding Name}" BorderThickness="1">
                                                                <Border.Style>
                                                                    <Style TargetType="Border">
                                                                        <Setter Property="Background" Value="#5865F2"/>
                                                                        <Setter Property="BorderBrush" Value="#3F4147"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding Type}" Value="Trigger">
                                                                                <Setter Property="Background" Value="#8B5CF6"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding Type}" Value="Flow">
                                                                                <Setter Property="Background" Value="#22D3EE"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding Type}" Value="Validation">
                                                                                <Setter Property="Background" Value="#F59E0B"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding Type}" Value="DML">
                                                                                <Setter Property="Background" Value="#F97316"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding Type}" Value="Async">
                                                                                <Setter Property="Background" Value="#10B981"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding IsSlowest}" Value="True">
                                                                                <Setter Property="BorderBrush" Value="#FBBF24"/>
                                                                                <Setter Property="BorderThickness" Value="2"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Border.Style>
                                                                <StackPanel>
                                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                                        <TextBlock Text="{Binding Icon}" Margin="0,0,6,0"/>
                                                                        <TextBlock Text="{Binding Type}" FontWeight="SemiBold" FontSize="12"/>
                                                                        <TextBlock Text="{Binding DurationMs, StringFormat={}{0:N0}ms}" FontSize="12" Foreground="#DBDEE1" Margin="6,0,0,0"/>
                                                                    </StackPanel>
                                                                    <TextBlock Text="{Binding Name}" FontSize="11" Foreground="#B5BAC1" TextTrimming="CharacterEllipsis"/>
                                                                    <StackPanel Orientation="Horizontal" Visibility="{Binding IsRecursive, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                        <TextBlock Text="⚠️ Recursive" FontSize="10" Foreground="#FEE75C"/>
                                                                    </StackPanel>
                                                                </StackPanel>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </ScrollViewer>
                                        </Border>

                                        <TextBlock Text="{Binding TimelineSummary}" FontSize="12" Foreground="#80848E" TextWrapping="Wrap" Margin="0,6,0,0"/>
                                        <TextBlock Text="{Binding TimelineSlowestLabel}" FontSize="12" Foreground="#FBBF24" Margin="0,2,0,0"
                                                   Visibility="{Binding TimelineSlowestLabel, Converter={StaticResource StringToVisibilityConverter}}"/>
                                    </StackPanel>
                                    
                                    <!-- ===== HEALTH SCORE DASHBOARD (Conic-like Arc) ===== -->
                                    <Border Style="{StaticResource DiscordCard}" Padding="20" Margin="0,0,0,16"
                                            Visibility="{Binding HasHealthData, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Health Score Arc -->
                                            <Grid Grid.Column="0" Width="140" Height="140" Margin="0,0,24,0">
                                                <!-- Background ring -->
                                                <Ellipse Width="140" Height="140" Stroke="#3F4147" StrokeThickness="10"/>

                                                <!-- Foreground arc -->
                                                <Path StrokeThickness="10" StrokeStartLineCap="Round" StrokeEndLineCap="Round"
                                                      Data="{Binding HealthScore, Converter={StaticResource ArcPathConverter}}"
                                                      Stroke="{Binding HealthScore, Converter={StaticResource HealthScoreToColorConverter}}">
                                                    <Path.Triggers>
                                                        <EventTrigger RoutedEvent="Loaded">
                                                            <BeginStoryboard>
                                                                <Storyboard RepeatBehavior="1x">
                                                                    <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.35"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </EventTrigger>
                                                    </Path.Triggers>
                                                </Path>

                                                <!-- Score text -->
                                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                                    <TextBlock FontSize="34" FontWeight="Bold" HorizontalAlignment="Center"
                                                             Foreground="{Binding HealthScore, Converter={StaticResource HealthScoreToColorConverter}}">
                                                        <Run Text="{Binding HealthScore, Mode=OneWay}"/><Run Text="/100" FontSize="16"/>
                                                    </TextBlock>
                                                    <TextBlock Text="{Binding HealthGrade}" FontSize="17" FontWeight="Bold" Foreground="#B5BAC1" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="{Binding HealthStatus}" FontSize="12" Foreground="#80848E" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>

                                            <!-- Health Info -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock FontSize="20" FontWeight="SemiBold" Margin="0,0,0,8">
                                                    <Run Text="{Binding HealthStatusIcon}"/>
                                                    <Run Text=" "/><Run Text="{Binding HealthStatus}"/>
                                                </TextBlock>
                                                <TextBlock Text="{Binding HealthReasoning}" FontSize="13" Foreground="#B5BAC1" TextWrapping="Wrap" LineHeight="20"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                                    <Border Background="#ED424530" CornerRadius="4" Padding="12,6" Margin="0,0,8,0"
                                                            Visibility="{Binding CriticalIssues.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                        <TextBlock FontSize="12" FontWeight="SemiBold">
                                                            <Run Text="🔴" Foreground="#ED4245"/>
                                                            <Run Text=" "/><Run Text="{Binding CriticalIssues.Count, Mode=OneWay}"/>
                                                            <Run Text=" Critical"/>
                                                        </TextBlock>
                                                    </Border>
                                                    <Border Background="#FEE75C30" CornerRadius="4" Padding="12,6" Margin="0,0,8,0"
                                                            Visibility="{Binding HighPriorityIssues.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                        <TextBlock FontSize="12" FontWeight="SemiBold">
                                                            <Run Text="🟠" Foreground="#FEE75C"/>
                                                            <Run Text=" "/><Run Text="{Binding HighPriorityIssues.Count, Mode=OneWay}"/>
                                                            <Run Text=" High"/>
                                                        </TextBlock>
                                                    </Border>
                                                    <Border Background="#57F28730" CornerRadius="4" Padding="12,6"
                                                            Visibility="{Binding QuickWins.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                        <TextBlock FontSize="12" FontWeight="SemiBold">
                                                            <Run Text="🟢" Foreground="#57F287"/>
                                                            <Run Text=" "/><Run Text="{Binding QuickWins.Count, Mode=OneWay}"/>
                                                            <Run Text=" Quick Wins"/>
                                                        </TextBlock>
                                                    </Border>
                                                    <TextBlock FontSize="12" Foreground="#80848E" Margin="16,0,0,0" VerticalAlignment="Center">
                                                        <Run Text="⏱️ "/><Run Text="{Binding TotalEstimatedMinutes, Mode=OneWay}"/><Run Text=" min to fix"/>
                                                    </TextBlock>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                    
                                    <!-- ===== FULL ANALYSIS SUMMARY ===== -->
                                    <Border Style="{StaticResource DiscordCard}" Padding="20" Margin="0,0,0,16"
                                            Visibility="{Binding FullSummaryText, Converter={StaticResource StringToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <TextBlock Text="📋" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Analysis Summary" FontSize="16" FontWeight="SemiBold" Foreground="#DBDEE1" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <TextBlock Text="{Binding FullSummaryText}" TextWrapping="Wrap" FontSize="13" Foreground="#B5BAC1" LineHeight="22"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ===== ACTIONABLE ISSUES ===== -->
                                    <StackPanel Visibility="{Binding HasHealthData, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        
                                        <!-- CRITICAL ISSUES -->
                                        <StackPanel Visibility="{Binding CriticalIssues.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}" Margin="0,0,0,16">
                                            <TextBlock Text="🔴 Critical Issues" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <ItemsControl ItemsSource="{Binding CriticalIssues}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Style="{StaticResource DiscordCard}" Padding="16" Margin="0,0,0,12" BorderBrush="#ED4245" BorderThickness="2">
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                </Grid.RowDefinitions>
                                                                
                                                                <!-- Header -->
                                                                <Grid Grid.Row="0" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" FontSize="15" FontWeight="SemiBold">
                                                                        <Run Text="{Binding SeverityIcon}"/>
                                                                        <Run Text=" "/><Run Text="{Binding Title}"/>
                                                                    </TextBlock>
                                                                    <Border Grid.Column="1" Background="#3F414730" CornerRadius="4" Padding="8,4" Margin="0,0,6,0">
                                                                        <TextBlock Text="{Binding RoleBadge}" FontSize="11" Foreground="#B5BAC1"/>
                                                                    </Border>
                                                                    <Border Grid.Column="2" Background="#3F414730" CornerRadius="4" Padding="8,4">
                                                                        <TextBlock Text="{Binding DifficultyBadge}" FontSize="11" Foreground="#B5BAC1"/>
                                                                    </Border>
                                                                </Grid>
                                                                
                                                                <!-- Problem -->
                                                                <StackPanel Grid.Row="1" Margin="0,0,0,8">
                                                                    <TextBlock Text="Problem:" FontSize="12" Foreground="#80848E" FontWeight="SemiBold"/>
                                                                    <TextBlock Text="{Binding Problem}" FontSize="13" Foreground="#DBDEE1" TextWrapping="Wrap"/>
                                                                </StackPanel>
                                                                
                                                                <!-- Impact & Location -->
                                                                <Grid Grid.Row="2" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                                                        <TextBlock Text="💥 Impact:" FontSize="12" Foreground="#80848E" FontWeight="SemiBold"/>
                                                                        <TextBlock Text="{Binding Impact}" FontSize="13" Foreground="#57F287" TextWrapping="Wrap"/>
                                                                    </StackPanel>
                                                                    <StackPanel Grid.Column="1">
                                                                        <TextBlock Text="📍 Location" FontSize="12" Foreground="#80848E" FontWeight="SemiBold"/>
                                                                        <Button Style="{StaticResource PillLinkButton}"
                                                                                Command="{Binding DataContext.OpenInEditorCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                                CommandParameter="{Binding Location}"
                                                                                ToolTip="Open in VSCode">
                                                                            <StackPanel Orientation="Horizontal">
                                                                                <TextBlock Text="🡥" FontSize="12"/>
                                                                                <TextBlock Text="{Binding Location}" FontSize="12" FontFamily="Consolas" Margin="6,0,0,0"/>
                                                                            </StackPanel>
                                                                        </Button>
                                                                    </StackPanel>
                                                                </Grid>
                                                                
                                                                <!-- Fix Recommendation -->
                                                                <Border Grid.Row="3" Background="#3F414730" CornerRadius="4" Padding="12">
                                                                    <StackPanel>
                                                                        <TextBlock Text="✅ How to Fix:" FontSize="12" Foreground="#57F287" FontWeight="SemiBold" Margin="0,0,0,6"/>
                                                                        <TextBlock Text="{Binding Fix}" FontSize="13" Foreground="#DBDEE1" TextWrapping="Wrap" LineHeight="20"/>
                                                                        <TextBlock Text="{Binding CodeExample}" FontSize="11" Foreground="#EB459E" FontFamily="Consolas" Margin="0,8,0,0" TextWrapping="Wrap"
                                                                                   Visibility="{Binding CodeExample, Converter={StaticResource StringToVisibilityConverter}}"/>
                                                                        <TextBlock FontSize="11" Foreground="#80848E" Margin="0,8,0,0">
                                                                            <Run Text="⏱️ Estimated fix time: "/><Run Text="{Binding EstimatedFixTimeMinutes}"/><Run Text=" minutes"/>
                                                                        </TextBlock>
                                                                    </StackPanel>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                        
                                        <!-- HIGH PRIORITY ISSUES -->
                                        <StackPanel Visibility="{Binding HighPriorityIssues.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}" Margin="0,0,0,16">
                                            <TextBlock Text="🟠 High Priority" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <ItemsControl ItemsSource="{Binding HighPriorityIssues}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Style="{StaticResource DiscordCard}" Padding="16" Margin="0,0,0,12" BorderBrush="#FEE75C" BorderThickness="2">
                                                            <!-- Same content as Critical Issues template -->
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                </Grid.RowDefinitions>
                                                                
                                                                <!-- Header -->
                                                                <Grid Grid.Row="0" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" FontSize="15" FontWeight="SemiBold">
                                                                        <Run Text="{Binding SeverityIcon}"/>
                                                                        <Run Text=" "/><Run Text="{Binding Title}"/>
                                                                    </TextBlock>
                                                                    <Border Grid.Column="1" Background="#3F414730" CornerRadius="4" Padding="8,4" Margin="0,0,6,0">
                                                                        <TextBlock Text="{Binding RoleBadge}" FontSize="11" Foreground="#B5BAC1"/>
                                                                    </Border>
                                                                    <Border Grid.Column="2" Background="#3F414730" CornerRadius="4" Padding="8,4">
                                                                        <TextBlock Text="{Binding DifficultyBadge}" FontSize="11" Foreground="#B5BAC1"/>
                                                                    </Border>
                                                                </Grid>
                                                                
                                                                <!-- Problem -->
                                                                <StackPanel Grid.Row="1" Margin="0,0,0,8">
                                                                    <TextBlock Text="Problem:" FontSize="12" Foreground="#80848E" FontWeight="SemiBold"/>
                                                                    <TextBlock Text="{Binding Problem}" FontSize="13" Foreground="#DBDEE1" TextWrapping="Wrap"/>
                                                                </StackPanel>
                                                                
                                                                <!-- Impact & Location -->
                                                                <Grid Grid.Row="2" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                                                        <TextBlock Text="💥 Impact:" FontSize="12" Foreground="#80848E" FontWeight="SemiBold"/>
                                                                        <TextBlock Text="{Binding Impact}" FontSize="13" Foreground="#57F287" TextWrapping="Wrap"/>
                                                                    </StackPanel>
                                                                    <StackPanel Grid.Column="1">
                                                                        <TextBlock Text="📍 Location:" FontSize="12" Foreground="#80848E" FontWeight="SemiBold"/>
                                                                        <TextBlock Text="{Binding Location}" FontSize="13" Foreground="#EB459E" TextWrapping="Wrap" FontFamily="Consolas"/>
                                                                    </StackPanel>
                                                                </Grid>
                                                                
                                                                <!-- Fix Recommendation -->
                                                                <Border Grid.Row="3" Background="#3F414730" CornerRadius="4" Padding="12">
                                                                    <StackPanel>
                                                                        <TextBlock Text="✅ How to Fix:" FontSize="12" Foreground="#57F287" FontWeight="SemiBold" Margin="0,0,0,6"/>
                                                                        <TextBlock Text="{Binding Fix}" FontSize="13" Foreground="#DBDEE1" TextWrapping="Wrap" LineHeight="20"/>
                                                                        <TextBlock Text="{Binding CodeExample}" FontSize="11" Foreground="#EB459E" FontFamily="Consolas" Margin="0,8,0,0" TextWrapping="Wrap"
                                                                                   Visibility="{Binding CodeExample, Converter={StaticResource StringToVisibilityConverter}}"/>
                                                                        <TextBlock FontSize="11" Foreground="#80848E" Margin="0,8,0,0">
                                                                            <Run Text="⏱️ Estimated fix time: "/><Run Text="{Binding EstimatedFixTimeMinutes}"/><Run Text=" minutes"/>
                                                                        </TextBlock>
                                                                    </StackPanel>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                        
                                        <!-- QUICK WINS -->
                                        <StackPanel Visibility="{Binding QuickWins.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}" Margin="0,0,0,16">
                                            <TextBlock Text="🟢 Quick Wins (Easy Fixes)" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,12"/>
                                            <ItemsControl ItemsSource="{Binding QuickWins}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Style="{StaticResource DiscordCard}" Padding="16" Margin="0,0,0,12" BorderBrush="#57F287" BorderThickness="2">
                                                            <!-- Simplified template for quick wins -->
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                </Grid.RowDefinitions>
                                                                
                                                                <!-- Header -->
                                                                <Grid Grid.Row="0" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <TextBlock Grid.Column="0" FontSize="15" FontWeight="SemiBold">
                                                                        <Run Text="{Binding SeverityIcon}"/>
                                                                        <Run Text=" "/><Run Text="{Binding Title}"/>
                                                                    </TextBlock>
                                                                    <TextBlock Grid.Column="1" Text="{Binding RoleBadge}" FontSize="11" Foreground="#B5BAC1" Margin="8,0,4,0" VerticalAlignment="Center"/>
                                                                    <TextBlock Grid.Column="2" FontSize="11" Foreground="#57F287">
                                                                        <Run Text="⏱️ "/><Run Text="{Binding EstimatedFixTimeMinutes}"/><Run Text=" min"/>
                                                                    </TextBlock>
                                                                </Grid>
                                                                
                                                                <!-- Details -->
                                                                <StackPanel Grid.Row="1">
                                                                    <TextBlock FontSize="13" Foreground="#DBDEE1" TextWrapping="Wrap" Margin="0,0,0,6">
                                                                        <Run Text="{Binding Problem}"/>
                                                                        <Run Text=" → " Foreground="#80848E"/>
                                                                        <Run Text="{Binding Impact}" Foreground="#57F287"/>
                                                                    </TextBlock>
                                                                    <Button Style="{StaticResource PillLinkButton}" Margin="0,0,0,6"
                                                                            Command="{Binding DataContext.OpenInEditorCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                            CommandParameter="{Binding Location}"
                                                                            ToolTip="Open in VSCode">
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <TextBlock Text="🡥" FontSize="12"/>
                                                                            <TextBlock Text="{Binding Location}" FontSize="11" FontFamily="Consolas" Margin="6,0,0,0"/>
                                                                        </StackPanel>
                                                                    </Button>
                                                                    <TextBlock Text="{Binding Fix}" FontSize="12" Foreground="#B5BAC1" TextWrapping="Wrap"/>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </StackPanel>
                                    
                                    <!-- ===== CLEAN BILL OF HEALTH (Congratulations Card) ===== -->
                                    <Border Background="#1E3A29" CornerRadius="12" Padding="20" Margin="0,0,0,16" BorderBrush="#3BA55D" BorderThickness="1"
                                            Visibility="{Binding IsCleanBillOfHealth, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="🎉" FontSize="36" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock Text="Clean Bill of Health!" FontSize="18" FontWeight="Bold" 
                                                       Foreground="#57F287" HorizontalAlignment="Center" Margin="0,0,0,6"/>
                                            <TextBlock Text="No critical or high-priority issues found. This transaction looks great!" 
                                                       FontSize="13" Foreground="#B5BAC1" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center" Margin="0,0,0,4"/>
                                            <TextBlock FontSize="12" Foreground="#72767D" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center">
                                                <Run Text="Health Score: "/><Run Text="{Binding HealthScore}" Foreground="#57F287" FontWeight="Bold"/><Run Text="/100"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ===== QUICK STATS ROW ===== -->
                                    <Grid Margin="0,0,0,16">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- SOQL Stat -->
                                        <Border Grid.Column="0" Background="#383A40" CornerRadius="8" Padding="14" Margin="0,0,8,0">
                                            <StackPanel HorizontalAlignment="Center">
                                                <TextBlock Text="💾" FontSize="20" HorizontalAlignment="Center"/>
                                                <TextBlock FontSize="24" FontWeight="Bold" Foreground="#7B83FF" HorizontalAlignment="Center" Margin="0,2,0,0">
                                                    <Run Text="{Binding StatSoqlCount, Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="Reads (SOQL)" FontSize="11" Foreground="#B5BAC1" HorizontalAlignment="Center" Margin="0,2,0,0"
                                                           ToolTip="SOQL = Salesforce Object Query Language. These are database read operations."/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- DML Stat -->
                                        <Border Grid.Column="1" Background="#383A40" CornerRadius="8" Padding="14" Margin="4,0">
                                            <StackPanel HorizontalAlignment="Center">
                                                <TextBlock Text="📝" FontSize="20" HorizontalAlignment="Center"/>
                                                <TextBlock FontSize="24" FontWeight="Bold" Foreground="#FBBF24" HorizontalAlignment="Center" Margin="0,2,0,0">
                                                    <Run Text="{Binding StatDmlCount, Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="Writes (DML)" FontSize="11" Foreground="#B5BAC1" HorizontalAlignment="Center" Margin="0,2,0,0"
                                                           ToolTip="DML = Data Manipulation Language. These are database write operations (insert, update, delete)."/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- Errors Stat -->
                                        <Border Grid.Column="2" Background="#383A40" CornerRadius="8" Padding="14" Margin="4,0">
                                            <StackPanel HorizontalAlignment="Center">
                                                <TextBlock Text="❌" FontSize="20" HorizontalAlignment="Center"/>
                                                <TextBlock FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,2,0,0">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="#72767D"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding StatErrorCount, Converter={StaticResource GreaterThanZeroConverter}}" Value="True">
                                                                    <Setter Property="Foreground" Value="#F87171"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                    <Run Text="{Binding StatErrorCount, Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="Errors" FontSize="11" Foreground="#B5BAC1" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- Warnings Stat -->
                                        <Border Grid.Column="3" Background="#383A40" CornerRadius="8" Padding="14" Margin="8,0,0,0">
                                            <StackPanel HorizontalAlignment="Center">
                                                <TextBlock Text="⚠️" FontSize="20" HorizontalAlignment="Center"/>
                                                <TextBlock FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,2,0,0">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="#72767D"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding StatWarningCount, Converter={StaticResource GreaterThanZeroConverter}}" Value="True">
                                                                    <Setter Property="Foreground" Value="#FBBF24"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                    <Run Text="{Binding StatWarningCount, Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Text="Warnings" FontSize="11" Foreground="#B5BAC1" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                    
                                    <!-- ===== GOVERNOR LIMITS PROGRESS BARS ===== -->
                                    <Border Background="#383A40" CornerRadius="6" Padding="16" Margin="0,0,0,16">
                                        <StackPanel>
                                            <TextBlock Text="Resource Usage" FontSize="14" FontWeight="SemiBold" Foreground="#DBDEE1" Margin="0,0,0,12"
                                                       ToolTip="Salesforce limits how much each transaction can do (called 'Governor Limits'). These bars show how close you are to those limits."/>
                                            
                                            <!-- SOQL Progress -->
                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="60"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="Reads" FontSize="12" Foreground="#B5BAC1" VerticalAlignment="Center" ToolTip="Database read operations (SOQL queries)"/>
                                                <Border Grid.Column="1" Background="#2B2D31" CornerRadius="4" Height="20">
                                                    <Border CornerRadius="4" HorizontalAlignment="Left" 
                                                            Width="{Binding SoqlPercent, Converter={StaticResource PercentToWidthConverter}}">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="Background" Value="#5865F2"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding SoqlPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Warning">
                                                                        <Setter Property="Background" Value="#FAA61A"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding SoqlPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Critical">
                                                                        <Setter Property="Background" Value="#ED4245"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                    </Border>
                                                </Border>
                                                <TextBlock Grid.Column="2" FontSize="11" Foreground="#72767D" VerticalAlignment="Center" HorizontalAlignment="Right">
                                                    <Run Text="{Binding StatSoqlCount, Mode=OneWay}"/><Run Text="/"/><Run Text="{Binding StatSoqlLimit, Mode=OneWay}"/>
                                                </TextBlock>
                                            </Grid>
                                            
                                            <!-- DML Progress -->
                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="60"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="Writes" FontSize="12" Foreground="#B5BAC1" VerticalAlignment="Center" ToolTip="Database write operations (DML - inserts, updates, deletes)"/>
                                                <Border Grid.Column="1" Background="#2B2D31" CornerRadius="4" Height="20">
                                                    <Border CornerRadius="4" HorizontalAlignment="Left"
                                                            Width="{Binding DmlPercent, Converter={StaticResource PercentToWidthConverter}}">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="Background" Value="#FAA61A"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding DmlPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Warning">
                                                                        <Setter Property="Background" Value="#FAA61A"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding DmlPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Critical">
                                                                        <Setter Property="Background" Value="#ED4245"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                    </Border>
                                                </Border>
                                                <TextBlock Grid.Column="2" FontSize="11" Foreground="#72767D" VerticalAlignment="Center" HorizontalAlignment="Right">
                                                    <Run Text="{Binding StatDmlCount, Mode=OneWay}"/><Run Text="/"/><Run Text="{Binding StatDmlLimit, Mode=OneWay}"/>
                                                </TextBlock>
                                            </Grid>
                                            
                                            <!-- CPU Progress -->
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="80"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="CPU Time" FontSize="12" Foreground="#B5BAC1" VerticalAlignment="Center"/>
                                                <Border Grid.Column="1" Background="#2B2D31" CornerRadius="4" Height="20">
                                                    <Border CornerRadius="4" HorizontalAlignment="Left"
                                                            Width="{Binding CpuPercent, Converter={StaticResource PercentToWidthConverter}}">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="Background" Value="#3BA55D"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding CpuPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Warning">
                                                                        <Setter Property="Background" Value="#FAA61A"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding CpuPercent, Converter={StaticResource PercentToSeverityConverter}}" Value="Critical">
                                                                        <Setter Property="Background" Value="#ED4245"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>
                                                    </Border>
                                                </Border>
                                                <TextBlock Grid.Column="2" FontSize="11" Foreground="#72767D" VerticalAlignment="Center" HorizontalAlignment="Right">
                                                    <Run Text="{Binding StatCpuTime, Mode=OneWay}"/><Run Text="ms / "/><Run Text="{Binding StatCpuLimit, Mode=OneWay}"/><Run Text="ms"/>
                                                </TextBlock>
                                            </Grid>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ===== TOP METHODS (always useful) ===== -->
                                    <Border Style="{StaticResource DiscordCard}" Padding="20" Margin="0,0,0,16"
                                            Visibility="{Binding HasTopMethods, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <TextBlock Text="⚡" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Where Time Was Spent" FontSize="16" FontWeight="SemiBold" Foreground="#DBDEE1" VerticalAlignment="Center"/>
                                                <TextBlock Text="  (Top Methods)" FontSize="12" Foreground="#72767D" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <ItemsControl ItemsSource="{Binding TopMethods}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="#2B2D31" CornerRadius="6" Padding="12,10" Margin="0,0,0,6">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                
                                                                <!-- Method name -->
                                                                <TextBlock Grid.Column="0" Text="{Binding Name}" FontSize="13" FontFamily="Consolas" 
                                                                           Foreground="#DBDEE1" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                                                
                                                                <!-- Call count badge -->
                                                                <Border Grid.Column="1" Background="#4E505830" CornerRadius="4" Padding="8,3" Margin="8,0">
                                                                    <TextBlock FontSize="11" Foreground="#B5BAC1" VerticalAlignment="Center">
                                                                        <Run Text="{Binding CallCount, Mode=OneWay}"/><Run Text="x calls"/>
                                                                    </TextBlock>
                                                                </Border>
                                                                
                                                                <!-- Avg time -->
                                                                <TextBlock Grid.Column="2" FontSize="11" Foreground="#72767D" VerticalAlignment="Center" Margin="0,0,12,0">
                                                                    <Run Text="avg "/><Run Text="{Binding AvgDisplay, Mode=OneWay}"/>
                                                                </TextBlock>
                                                                
                                                                <!-- Total time -->
                                                                <Border Grid.Column="3" CornerRadius="4" Padding="8,3" MinWidth="60" HorizontalAlignment="Right">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="#5865F230"/>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock Text="{Binding TimeDisplay}" FontSize="12" FontWeight="SemiBold" 
                                                                               Foreground="#7B83FF" HorizontalAlignment="Center"/>
                                                                </Border>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ===== TOP QUERIES (always useful) ===== -->
                                    <Border Style="{StaticResource DiscordCard}" Padding="20" Margin="0,0,0,16"
                                            Visibility="{Binding HasTopQueries, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                <TextBlock Text="💾" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Query Hotspots" FontSize="16" FontWeight="SemiBold" Foreground="#DBDEE1" VerticalAlignment="Center"/>
                                                <TextBlock Text="  (Most Frequent Queries)" FontSize="12" Foreground="#72767D" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <ItemsControl ItemsSource="{Binding TopQueries}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="#2B2D31" CornerRadius="6" Padding="12,10" Margin="0,0,0,6">
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                </Grid.RowDefinitions>
                                                                
                                                                <!-- Header row: count + time + location -->
                                                                <Grid Grid.Row="0" Margin="0,0,0,6">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    
                                                                    <!-- Execution count badge -->
                                                                    <Border Grid.Column="0" CornerRadius="4" Padding="8,3" Margin="0,0,8,0">
                                                                        <Border.Style>
                                                                            <Style TargetType="Border">
                                                                                <Setter Property="Background" Value="#5865F230"/>
                                                                                <Style.Triggers>
                                                                                    <DataTrigger Binding="{Binding IsNPlusOne}" Value="True">
                                                                                        <Setter Property="Background" Value="#ED424530"/>
                                                                                    </DataTrigger>
                                                                                </Style.Triggers>
                                                                            </Style>
                                                                        </Border.Style>
                                                                        <TextBlock FontSize="12" FontWeight="SemiBold">
                                                                            <TextBlock.Style>
                                                                                <Style TargetType="TextBlock">
                                                                                    <Setter Property="Foreground" Value="#7B83FF"/>
                                                                                    <Style.Triggers>
                                                                                        <DataTrigger Binding="{Binding IsNPlusOne}" Value="True">
                                                                                            <Setter Property="Foreground" Value="#F87171"/>
                                                                                        </DataTrigger>
                                                                                    </Style.Triggers>
                                                                                </Style>
                                                                            </TextBlock.Style>
                                                                            <Run Text="{Binding CountBadge, Mode=OneWay}"/>
                                                                        </TextBlock>
                                                                    </Border>
                                                                    
                                                                    <!-- N+1 warning -->
                                                                    <TextBlock Grid.Column="1" Text="{Binding NPlusOneBadge}" FontSize="11" 
                                                                               Foreground="#F87171" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                                    
                                                                    <!-- Location -->
                                                                    <TextBlock Grid.Column="2" Text="{Binding Location}" FontSize="11" 
                                                                               Foreground="#72767D" VerticalAlignment="Center" FontFamily="Consolas"/>
                                                                    
                                                                    <!-- Duration -->
                                                                    <TextBlock Grid.Column="3" Text="{Binding TimeDisplay}" FontSize="12" 
                                                                               Foreground="#FBBF24" VerticalAlignment="Center"/>
                                                                </Grid>
                                                                
                                                                <!-- Query text -->
                                                                <TextBlock Grid.Row="1" Text="{Binding Query}" FontSize="11" FontFamily="Consolas" 
                                                                           Foreground="#80848E" TextWrapping="Wrap" MaxHeight="40" TextTrimming="CharacterEllipsis"/>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- ===== TIMING BREAKDOWN (when overhead is significant) ===== -->
                                    <Border Background="#383A40" CornerRadius="6" Padding="16" Margin="0,0,0,16"
                                            Visibility="{Binding ShowTimingBreakdown, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <StackPanel>
                                            <TextBlock Text="⏱️ Timing Breakdown" FontSize="14" FontWeight="SemiBold" Foreground="#DBDEE1" Margin="0,0,0,12"/>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding WallClockMs, StringFormat={}{0:N0}ms}" FontSize="18" FontWeight="Bold" Foreground="#5865F2" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="Total Time" FontSize="10" Foreground="#72767D" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                                
                                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding CpuTimeMs, StringFormat={}{0:N0}ms}" FontSize="18" FontWeight="Bold" Foreground="#3BA55D" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="Your Code (CPU)" FontSize="10" Foreground="#72767D" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                                
                                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                                    <TextBlock Text="{Binding OverheadMs, StringFormat={}{0:N0}ms}" FontSize="18" FontWeight="Bold" Foreground="#FAA61A" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="SF Overhead" FontSize="10" Foreground="#72767D" HorizontalAlignment="Center"/>
                                                </StackPanel>
                                            </Grid>
                                        </StackPanel>
                                    </Border>

                                    <!-- ===== RAW DETAILS (Collapsed by default - for advanced users) ===== -->
                                    <Expander IsExpanded="False" Margin="0,0,0,16"
                                              Visibility="{Binding Issues.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                        <Expander.Header>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="📋" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Raw Technical Details" FontSize="14" FontWeight="SemiBold" Foreground="#B5BAC1" VerticalAlignment="Center"/>
                                                <TextBlock Text="(for developers)" FontSize="11" Foreground="#72767D" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                            </StackPanel>
                                        </Expander.Header>
                                        <StackPanel Margin="0,12,0,0">
                                            <!-- Issues -->
                                            <Border Background="#383A40" CornerRadius="6" Padding="16" Margin="0,0,0,12">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                        <TextBlock Text="🔍" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                        <TextBlock Text="Issues Detected" FontSize="13" FontWeight="SemiBold" Foreground="#ED4245" VerticalAlignment="Center"/>
                                                        <Border Background="#ED4245" CornerRadius="10" Padding="8,2" Margin="8,0,0,0">
                                                            <TextBlock Text="{Binding Issues.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                        </Border>
                                                        <Button Content="📋 Copy" 
                                                                HorizontalAlignment="Right" 
                                                                Click="CopyIssues_Click"
                                                                Background="#4E5058" 
                                                                Foreground="#B5BAC1" 
                                                                BorderThickness="0" 
                                                                Padding="10,4" 
                                                                FontSize="12"
                                                                Cursor="Hand"
                                                                Margin="12,0,0,0"
                                                                ToolTip="Copy to clipboard"/>
                                                    </StackPanel>
                                                    <ItemsControl ItemsSource="{Binding Issues}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border CornerRadius="4" Padding="12" Margin="0,0,0,8">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="#2B2D31"/>
                                                                            <Setter Property="BorderBrush" Value="#4E5058"/>
                                                                            <Setter Property="BorderThickness" Value="0,0,0,2"/>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock Text="{Binding}" TextWrapping="Wrap" FontSize="13" Foreground="#B5BAC1"/>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </Border>

                                            <!-- Recommendations -->
                                            <Border Background="#383A40" CornerRadius="6" Padding="16"
                                                    Visibility="{Binding Recommendations.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                                        <TextBlock Text="💡" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                        <TextBlock Text="Recommendations" FontSize="13" FontWeight="SemiBold" Foreground="#3BA55D" VerticalAlignment="Center"/>
                                                        <Border Background="#3BA55D" CornerRadius="10" Padding="8,2" Margin="8,0,0,0">
                                                            <TextBlock Text="{Binding Recommendations.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                        </Border>
                                                        <Button Content="📋 Copy" 
                                                                Click="CopyRecommendations_Click"
                                                                Background="#4E5058" 
                                                                Foreground="#B5BAC1" 
                                                                BorderThickness="0" 
                                                                Padding="10,4" 
                                                                FontSize="12"
                                                                Cursor="Hand"
                                                                Margin="12,0,0,0"
                                                                ToolTip="Copy to clipboard"/>
                                                    </StackPanel>
                                                    <ItemsControl ItemsSource="{Binding Recommendations}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <Border Background="#2B2D31" CornerRadius="4" Padding="12" Margin="0,0,0,8"
                                                                        BorderBrush="#3BA55D33" BorderThickness="1">
                                                                    <TextBlock Text="{Binding}" TextWrapping="Wrap" FontSize="13" Foreground="#B5BAC1"/>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>
                                    </Expander>
                                    
                                </StackPanel>
                            </ScrollViewer>
                            
                            <!-- Tree Tab (Index 1) -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,16"
                                          Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntEqualsToVisibilityConverter}, ConverterParameter=1}">
                                <StackPanel MaxWidth="900">
                                    <!-- Header -->
                                    <Border Background="#383A40" BorderBrush="#5865F2" BorderThickness="0,0,0,3" CornerRadius="6" Padding="16" Margin="0,0,0,12">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <TextBlock Text="🌳" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Execution Tree" FontSize="16" FontWeight="SemiBold" Foreground="#DBDEE1" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <TextBlock Text="Shows the hierarchy of code execution — what called what, and how long each piece took." 
                                                       FontSize="12" Foreground="#80848E" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- Tree Content -->
                                    <Border Visibility="{Binding HasExecutionTree, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <TreeView ItemsSource="{Binding ExecutionTreeNodes}" Background="Transparent" BorderThickness="0"
                                                  Foreground="#DBDEE1">
                                            <TreeView.Resources>
                                                <HierarchicalDataTemplate DataType="{x:Type viewmodels:TreeNodeViewModel}" 
                                                                          ItemsSource="{Binding Children}">
                                                    <Border Background="#2B2D31" CornerRadius="4" Padding="10,6" Margin="0,2">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            
                                                            <!-- Type icon -->
                                                            <TextBlock Grid.Column="0" Text="{Binding TypeIcon}" FontSize="14" 
                                                                       VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                            
                                                            <!-- Name -->
                                                            <TextBlock Grid.Column="1" Text="{Binding Name}" FontSize="12" 
                                                                       Foreground="#DBDEE1" TextTrimming="CharacterEllipsis" 
                                                                       VerticalAlignment="Center" FontFamily="Consolas"/>
                                                            
                                                            <!-- Type badge -->
                                                            <Border Grid.Column="2" CornerRadius="3" Padding="6,2" Margin="8,0">
                                                                <Border.Style>
                                                                    <Style TargetType="Border">
                                                                        <Setter Property="Background" Value="#4E505830"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding TypeName}" Value="Soql">
                                                                                <Setter Property="Background" Value="#5865F230"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding TypeName}" Value="Dml">
                                                                                <Setter Property="Background" Value="#F9731630"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding TypeName}" Value="Exception">
                                                                                <Setter Property="Background" Value="#ED424530"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Border.Style>
                                                                <TextBlock Text="{Binding TypeName}" FontSize="10" Foreground="#B5BAC1"/>
                                                            </Border>
                                                            
                                                            <!-- Duration -->
                                                            <TextBlock Grid.Column="3" Text="{Binding DurationDisplay}" FontSize="12" 
                                                                       FontWeight="SemiBold" VerticalAlignment="Center" MinWidth="50" TextAlignment="Right">
                                                                <TextBlock.Style>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="Foreground" Value="#72767D"/>
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding TypeName}" Value="Soql">
                                                                                <Setter Property="Foreground" Value="#7B83FF"/>
                                                                            </DataTrigger>
                                                                            <DataTrigger Binding="{Binding TypeName}" Value="Dml">
                                                                                <Setter Property="Foreground" Value="#FBBF24"/>
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </TextBlock.Style>
                                                            </TextBlock>
                                                        </Grid>
                                                    </Border>
                                                </HierarchicalDataTemplate>
                                            </TreeView.Resources>
                                            <TreeView.ItemContainerStyle>
                                                <Style TargetType="TreeViewItem">
                                                    <Setter Property="IsExpanded" Value="{Binding IsExpanded}"/>
                                                    <Setter Property="Foreground" Value="#DBDEE1"/>
                                                    <Setter Property="FontSize" Value="12"/>
                                                </Style>
                                            </TreeView.ItemContainerStyle>
                                        </TreeView>
                                    </Border>
                                    
                                    <!-- Empty state -->
                                    <Border Background="#383A40" CornerRadius="6" Padding="20" 
                                            Visibility="{Binding HasExecutionTree, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="🌳" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock Text="No execution tree data" FontSize="14" Foreground="#72767D" HorizontalAlignment="Center"/>
                                            <TextBlock Text="The log may be too short or didn't contain code unit events." 
                                                       FontSize="12" Foreground="#4E5058" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                            
                            <!-- Timeline Tab (Index 2) -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,16"
                                          Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntEqualsToVisibilityConverter}, ConverterParameter=2}">
                                <StackPanel MaxWidth="900">
                                    <!-- Header -->
                                    <Border Background="#383A40" BorderBrush="#FAA61A" BorderThickness="0,0,0,3" CornerRadius="6" Padding="16" Margin="0,0,0,12">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <TextBlock Text="⏱️" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Execution Timeline" FontSize="16" FontWeight="SemiBold" Foreground="#DBDEE1" VerticalAlignment="Center"/>
                                            </StackPanel>
                                            <TextBlock Text="Every phase of execution in chronological order — triggers, flows, validations, DML, and async operations." 
                                                       FontSize="12" Foreground="#80848E" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- Timeline Content -->
                                    <Border Visibility="{Binding HasTimelineDetails, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <ItemsControl ItemsSource="{Binding TimelineDetails}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="{Binding IndentMargin}">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="4"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        
                                                        <!-- Colored timeline bar -->
                                                        <Border Grid.Column="0" CornerRadius="2" Margin="0,2">
                                                            <Border.Style>
                                                                <Style TargetType="Border">
                                                                    <Setter Property="Background" Value="#5865F2"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Trigger">
                                                                            <Setter Property="Background" Value="#8B5CF6"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Flow">
                                                                            <Setter Property="Background" Value="#22D3EE"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Validation">
                                                                            <Setter Property="Background" Value="#F59E0B"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="DML">
                                                                            <Setter Property="Background" Value="#F97316"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Async">
                                                                            <Setter Property="Background" Value="#10B981"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Border.Style>
                                                        </Border>
                                                        
                                                        <!-- Phase content -->
                                                        <Border Grid.Column="1" Background="#2B2D31" CornerRadius="6" Padding="12,8" Margin="8,2,0,2">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                
                                                                <!-- Icon -->
                                                                <TextBlock Grid.Column="0" Text="{Binding Icon}" FontSize="14" 
                                                                           VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                                
                                                                <!-- Type badge -->
                                                                <Border Grid.Column="1" CornerRadius="3" Padding="6,2" Margin="0,0,8,0">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="#4E505830"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding Type}" Value="Trigger">
                                                                                    <Setter Property="Background" Value="#8B5CF630"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding Type}" Value="Flow">
                                                                                    <Setter Property="Background" Value="#22D3EE30"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding Type}" Value="Validation">
                                                                                    <Setter Property="Background" Value="#F59E0B30"/>
                                                                                </DataTrigger>
                                                                                <DataTrigger Binding="{Binding Type}" Value="DML">
                                                                                    <Setter Property="Background" Value="#F9731630"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock Text="{Binding Type}" FontSize="10" FontWeight="SemiBold" Foreground="#B5BAC1"/>
                                                                </Border>
                                                                
                                                                <!-- Name -->
                                                                <TextBlock Grid.Column="2" Text="{Binding Name}" FontSize="12" 
                                                                           Foreground="#DBDEE1" TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                                                                
                                                                <!-- Recursive flag -->
                                                                <TextBlock Grid.Column="3" Text="⚠️ Recursive" FontSize="10" Foreground="#FEE75C" 
                                                                           VerticalAlignment="Center" Margin="8,0"
                                                                           Visibility="{Binding IsRecursive, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                                                
                                                                <!-- Duration + percent -->
                                                                <StackPanel Grid.Column="4" Orientation="Horizontal" VerticalAlignment="Center">
                                                                    <TextBlock Text="{Binding PercentDisplay}" FontSize="11" Foreground="#72767D" Margin="0,0,8,0"/>
                                                                    <Border Background="#5865F230" CornerRadius="4" Padding="8,3" MinWidth="55">
                                                                        <TextBlock Text="{Binding DurationDisplay}" FontSize="12" FontWeight="SemiBold" 
                                                                                   Foreground="#7B83FF" HorizontalAlignment="Center"/>
                                                                    </Border>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Border>
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </Border>
                                    
                                    <!-- Timeline legend -->
                                    <Border Background="#383A40" CornerRadius="6" Padding="12" Margin="0,12,0,0"
                                            Visibility="{Binding HasTimelineDetails, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <WrapPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#8B5CF6" Margin="0,0,6,0"/>
                                                <TextBlock Text="Trigger" FontSize="11" Foreground="#B5BAC1"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#22D3EE" Margin="0,0,6,0"/>
                                                <TextBlock Text="Flow" FontSize="11" Foreground="#B5BAC1"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#F59E0B" Margin="0,0,6,0"/>
                                                <TextBlock Text="Validation" FontSize="11" Foreground="#B5BAC1"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#F97316" Margin="0,0,6,0"/>
                                                <TextBlock Text="DML" FontSize="11" Foreground="#B5BAC1"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,16,0">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#10B981" Margin="0,0,6,0"/>
                                                <TextBlock Text="Async" FontSize="11" Foreground="#B5BAC1"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal">
                                                <Border Width="12" Height="12" CornerRadius="2" Background="#5865F2" Margin="0,0,6,0"/>
                                                <TextBlock Text="Other" FontSize="11" Foreground="#B5BAC1"/>
                                            </StackPanel>
                                        </WrapPanel>
                                    </Border>
                                    
                                    <!-- Empty state -->
                                    <Border Background="#383A40" CornerRadius="6" Padding="20" 
                                            Visibility="{Binding HasTimelineDetails, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="⏱️" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock Text="No timeline data" FontSize="14" Foreground="#72767D" HorizontalAlignment="Center"/>
                                            <TextBlock Text="The log didn't contain enough execution phases to build a timeline." 
                                                       FontSize="12" Foreground="#4E5058" HorizontalAlignment="Center" Margin="0,4,0,0"/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                            
                            <!-- Queries Tab (Index 3) -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20,16"
                                          Visibility="{Binding SelectedTabIndex, Converter={StaticResource IntEqualsToVisibilityConverter}, ConverterParameter=3}">
                                <StackPanel MaxWidth="800">
                                    <!-- Empty state when no database operations -->
                                    <Border Background="#383A40" CornerRadius="6" Padding="20" Margin="0,0,0,12"
                                            Visibility="{Binding DatabaseOperations.Count, Converter={StaticResource ZeroToVisibilityConverter}}">
                                        <StackPanel HorizontalAlignment="Center">
                                            <TextBlock Text="💾" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                            <TextBlock Text="No database operations" FontSize="14" FontWeight="SemiBold" Foreground="#B5BAC1" HorizontalAlignment="Center"/>
                                            <TextBlock Text="This log didn't contain any database reads (SOQL) or writes (DML)." 
                                                       FontSize="12" Foreground="#72767D" HorizontalAlignment="Center" Margin="0,4,0,0"
                                                       TextWrapping="Wrap" TextAlignment="Center"/>
                                            <TextBlock Text="That's actually great — it means this transaction is lightweight!" 
                                                       FontSize="11" Foreground="#3BA55D" HorizontalAlignment="Center" Margin="0,8,0,0"/>
                                        </StackPanel>
                                    </Border>
                                    
                                    <Border Background="#383A40" BorderBrush="#3BA55D" BorderThickness="0,0,0,3" CornerRadius="6" Padding="16" Margin="0,0,0,12"
                                            Visibility="{Binding DatabaseOperations.Count, Converter={StaticResource GreaterThanZeroToVisibilityConverter}}">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                                <TextBlock Text="💾" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Text="Database Operations" FontSize="16" FontWeight="SemiBold" Foreground="#DBDEE1" VerticalAlignment="Center"/>
                                                <Border Background="#5865F2" CornerRadius="10" Padding="8,2" Margin="12,0,0,0">
                                                    <TextBlock Text="{Binding DatabaseOperations.Count}" FontSize="11" Foreground="White" FontWeight="Bold"/>
                                                </Border>
                                            </StackPanel>
                                            <ItemsControl ItemsSource="{Binding DatabaseOperations}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border Background="#2B2D31" CornerRadius="4" Padding="12" Margin="0,0,0,8">
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                </Grid.RowDefinitions>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                </Grid.ColumnDefinitions>
                                                                
                                                                <!-- Operation type badge -->
                                                                <Border Grid.Column="0" CornerRadius="3" Padding="6,2" Margin="0,0,8,0">
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Setter Property="Background" Value="#5865F2"/>
                                                                            <Style.Triggers>
                                                                                <DataTrigger Binding="{Binding OperationType}" Value="DML">
                                                                                    <Setter Property="Background" Value="#FAA61A"/>
                                                                                </DataTrigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Border.Style>
                                                                    <TextBlock Text="{Binding OperationType}" FontSize="10" FontWeight="Bold" Foreground="White"/>
                                                                </Border>
                                                                
                                                                <!-- Object name -->
                                                                <TextBlock Grid.Column="1" Text="{Binding ObjectType}" FontSize="13" FontWeight="SemiBold" Foreground="White"/>
                                                                
                                                                <!-- Duration -->
                                                                <TextBlock Grid.Column="2" FontSize="11" Foreground="#72767D">
                                                                    <Run Text="{Binding DurationMs, StringFormat={}{0:N0}}"/><Run Text="ms"/>
                                                                </TextBlock>
                                                                
                                                                <!-- Query/Statement -->
                                                                <TextBlock Grid.Row="1" Grid.ColumnSpan="3" Text="{Binding Query}" 
                                                                           TextWrapping="Wrap" FontSize="11" Foreground="#B5BAC1" 
                                                                           FontFamily="Consolas" Margin="0,6,0,0"
                                                                           MaxHeight="60" TextTrimming="CharacterEllipsis"/>
                                                                
                                                                <!-- Row count -->
                                                                <TextBlock Grid.Row="2" Grid.ColumnSpan="3" FontSize="10" Foreground="#72767D" Margin="0,4,0,0">
                                                                    <Run Text="{Binding RowsAffected}"/><Run Text=" rows"/>
                                                                </TextBlock>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                        </Grid>
                    </Grid>

                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>
